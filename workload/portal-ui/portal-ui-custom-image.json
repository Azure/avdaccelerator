{
    "$schema": "<relative path to createFormUI.schema.json>",
    "view": {
        "kind": "Form",
        "properties": {
            "isWizard": false,
            "title": "AVD Landing Zone Accelerator - Custom Image Build",
            "steps": [
                {
                    "name": "basics",
                    "label": "Deployment Basics",
                    "elements": [
                        {
                            "name": "deploymentInfo",
                            "type": "Microsoft.Common.Section",
                            "visible": true,
                            "label": "Important Information",
                            "elements": [
                                {
                                    "name": "infoPreReq",
                                    "type": "Microsoft.Common.InfoBox",
                                    "options": {
                                        "text": "PREREQUISITES REQUIRED \n\nThere are prerequisites that must be setup in your Azure environment to successfully deploy this AVD Landing Zone Accelerator. Click here to review the prerequisites in the Getting Started guide.",
                                        "uri": "https://github.com/Azure/avdaccelerator/blob/main/workload/docs/getting-started-custom-image-build.md",
                                        "style": "Warning"
                                    }
                                },
                                {
                                    "name": "deploymentInfo",
                                    "type": "Microsoft.Common.InfoBox",
                                    "options": {
										"style": "Info",
                                        "text": "The subscription and region selected below will be used for most of the resources deployed in this solution. The replication regions for the image version will be the only exception and those regions will be defined in the next step. The regions listed in the menu below are the only regions that support Azure Image Builder image templates. Please ensure to select the appropriate options for your environment.",
                                        "uri": "https://learn.microsoft.com/azure/virtual-machines/image-builder-overview?tabs=azure-powershell#regions"										
                                    }
                                }
                            ]
                        },
                        {
                            "name": "resourceScope",
                            "type": "Microsoft.Common.ResourceScope",
                            "location": {
                                "resourceTypes": [
                                    "Microsoft.VirtualMachineImages/imageTemplates"
                                ]
                            }
                        },
                        {
                            "name": "computeApi",
                            "type": "Microsoft.Solutions.ArmApiControl",
                            "request": {
                                "method": "GET",
                                "path": "[concat(steps('basics').resourceScope.subscription.id,'/providers/Microsoft.Compute/resourceTypes?api-version=2021-04-01')]"
                            }
                        },
                        {
                            "name": "locationsApi",
                            "type": "Microsoft.Solutions.ArmApiControl",
                            "request": {
                                "method": "GET",
                                "path": "[concat(steps('basics').resourceScope.subscription.id,'/locations?api-version=2020-01-01')]"
                            }
                        },
                        {
                            "name": "storageApi",
                            "type": "Microsoft.Solutions.ArmApiControl",
                            "request": {
                                "method": "GET",
                                "path": "[concat(steps('basics').resourceScope.subscription.id,'/providers/Microsoft.Storage/resourceTypes?api-version=2021-04-01')]"
                            }
                        }
                    ]
                },
                {
                    "name": "imageManagement",
                    "label": "Image Management",
                    "elements": [
                        {
                            "name": "info",
                            "type": "Microsoft.Common.TextBlock",
                            "visible": true,
                            "options": {
                                "text": "For image management, this solution will deploy a compute gallery, image definition, and image version.",
                                "link": {
                                    "label": "Learn more about managing images with an Azure Compute Gallery.",
                                    "uri": "https://learn.microsoft.com/en-us/azure/virtual-machines/windows/image-builder-gallery"
                                }
                            }
                        },
                        {
                            "name": "imageVersion",
                            "type": "Microsoft.Common.Section",
                            "visible": true,
                            "label": "Image version",
                            "elements": [
                                {
                                    "name": "info2",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": true,
                                    "options": {
                                        "text": "Image Versions distributed by the AIB Image Template support different redundancy options through the Storage Account Type property. Click here for more information.",
                                        "uri": "https://learn.microsoft.com/azure/virtual-machines/azure-compute-gallery#high-availability",
                                        "style": "Info"
                                    }
                                },
                                {
                                    "name": "storageAccountType",
                                    "type": "Microsoft.Common.DropDown",
                                    "label": "Storage account type",
                                    "defaultValue": "Standard Zone-Redundant Storage",
                                    "toolTip": "Determine the performance and redundancy for the Image Version.",
                                    "constraints": {
                                        "required": true,
                                        "allowedValues": [
                                            {
                                                "label": "Standard Locally-Redundant Storage",
                                                "value": "Standard_LRS"
                                            },
                                            {
                                                "label": "Standard Zone-Redundant Storage",
                                                "value": "Standard_ZRS"
                                            }
                                        ]
                                    }
                                },
                                {
                                    "name": "primaryLocation",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": true,
                                    "filter": true,
                                    "label": "Primary storage location",
                                    "defaultValue": "[steps('basics').resourceScope.location.displayName]",
                                    "toolTip": "Select the primary location to store the Image Version. This location should coincide with your AVD session hosts.",
                                    "constraints": {
                                        "allowedValues": "[if(equals(steps('imageManagement').imageVersion.storageAccountType, 'Standard_LRS'), map(first(map(filter(steps('basics').computeApi.value, (resourceTypes) => equals(resourceTypes.resourceType, 'galleries/images/versions')), (item) => item.locations)), (item) => parse(concat('{\"label\":\"', item, '\",\"value\":\"', toLower(replace(item, ' ', '')), '\"}'))), map(filter(first(map(filter(steps('basics').storageApi.value, (resourceTypes) => equals(resourceTypes.resourceType, 'storageAccounts')), (item) => item.zoneMappings)), (item) => equals(length(item.zones), 3)), (item) => parse(concat('{\"label\":\"', item.location, '\",\"value\":\"', toLower(replace(item.location, ' ', '')), '\"}'))))]",
                                        "required": true
                                    }
                                },
                                {
                                    "name": "info3",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": true,
                                    "options": {
                                        "text": "Image Versions distributed by the AIB Image Template support replication to different Azure locations, enabling disaster recovery. Click here for more information.",
                                        "uri": "https://learn.microsoft.com/en-us/azure/cloud-adoption-framework/scenarios/wvd/eslz-business-continuity-and-disaster-recovery#golden-image-availability",
                                        "style": "Info"
                                    }
                                },
                                {
                                    "name": "disasterRecovery",
                                    "type": "Microsoft.Common.CheckBox",
                                    "visible": true,
                                    "label": "Enable replication to disaster recovery location",
                                    "defaultValue": true,
                                    "toolTip": "Determine whether to replicate the Image Version to your disaster recovery location."
                                },
                                {
                                    "name": "disasterRecoveryLocation",
                                    "type": "Microsoft.Common.DropDown",
                                    "label": "Disaster recovery location",
                                    "defaultValue": "[first(map(filter(steps('basics').locationsApi.value, (item) => equals(item.name, first(map(first(map(filter(steps('basics').locationsApi.value, (item) => equals(item.name, steps('imageManagement').imageVersion.primaryLocation)), (item) => item.metadata.pairedRegion)), (item) => item.name)))), (item) => item.displayName))]",
                                    "filter": true,
                                    "toolTip": "Select the disaster recovery location to store the Image Version. This location should coincide with your disaster recovery location for your AVD session hosts.",
                                    "constraints": {
                                        "allowedValues": "[if(equals(steps('imageManagement').imageVersion.storageAccountType, 'Standard_LRS'), filter(map(first(map(filter(steps('basics').computeApi.value, (resourceTypes) => equals(resourceTypes.resourceType, 'galleries/images/versions')), (item) => item.locations)), (item) => parse(concat('{\"label\":\"', item, '\",\"value\":\"', toLower(replace(item, ' ', '')), '\"}'))), (item) => not(equals(item.value, steps('imageManagement').imageVersion.primaryLocation))), filter(map(filter(first(map(filter(steps('basics').storageApi.value, (resourceTypes) => equals(resourceTypes.resourceType, 'storageAccounts')), (item) => item.zoneMappings)), (item) => equals(length(item.zones), 3)), (item) => parse(concat('{\"label\":\"', item.location, '\",\"value\":\"', toLower(replace(item.location, ' ', '')), '\"}'))), (item) => not(equals(item.value, steps('imageManagement').imageVersion.primaryLocation))))]",
                                        "required": true
                                    },
                                    "visible": "[equals(steps('imageManagement').imageVersion.disasterRecovery, true)]"
                                }
                            ]
                        },
                        {
                            "name": "operatingSystem",
                            "type": "Microsoft.Common.Section",
                            "visible": true,
                            "label": "Operating system",
                            "elements": [
                                {
                                    "name": "versionSelection",
                                    "type": "Microsoft.Common.DropDown",
                                    "label": "Version",
                                    "filter": true,
                                    "defaultValue": "Windows 11 22H2 (Gen2)",
                                    "toolTip": "Select the operating system version for the source image.",
                                    "constraints": {
                                        "required": true,
                                        "allowedValues": [
                                            {
                                                "label": "Windows 10 21H2 (Gen1)",
                                                "value": "win10_21h2"
                                            },
                                            {
                                                "label": "Windows 10 21H2 - Office 365 (Gen1)",
                                                "value": "win10_21h2_office"
                                            },
                                            {
                                                "label": "Windows 10 22H2 (Gen2)",
                                                "value": "win10_22h2_g2"
                                            },
                                            {
                                                "label": "Windows 10 22H2 - Office 365 (Gen2)",
                                                "value": "win10_22h2_office_g2"
                                            },
                                            {
                                                "label": "Windows 11 21H2 (Gen2)",
                                                "value": "win11_21h2"
                                            },
                                            {
                                                "label": "Windows 11 21H2 - Office 365 (Gen2)",
                                                "value": "win11_21h2_office"
                                            },
                                            {
                                                "label": "Windows 11 22H2 (Gen2)",
                                                "value": "win11_22h2"
                                            },
                                            {
                                                "label": "Windows 11 22H2 - Office 365 (Gen2)",
                                                "value": "win11_22h2_office"
                                            },
                                            {
                                                "label": "Windows 11 23H2 (Gen2)",
                                                "value": "win11_23h2"
                                            },
                                            {
                                                "label": "Windows 11 23H2 - Office 365 (Gen2)",
                                                "value": "win11_23h2_office"
                                            }
                                        ]
                                    }
                                }
                            ]
                        },
                        {
                            "name": "imageDefinitionFeatures",
                            "type": "Microsoft.Common.Section",
                            "visible": true,
                            "label": "Image definition features",
                            "elements": [
                                {
                                    "name": "supportsAcceleratedNetworking",
                                    "type": "Microsoft.Common.CheckBox",
                                    "visible": true,
                                    "label": "Supports network acceleration.",
                                    "defaultValue": true,
                                    "toolTip": "Accelerated networking enables single root I/O virtualization (SR-IOV) to a VM, greatly improving its networking performance. This high-performance path bypasses the host from the data path, which reduces latency, jitter, and CPU utilization for the most demanding network workloads on supported VM types."
                                },
                                {
                                    "name": "supportsHibernation",
                                    "type": "Microsoft.Common.CheckBox",
                                    "visible": true,
                                    "label": "Supports hibernation.",
                                    "defaultValue": false,
                                    "toolTip": "This is currently a preview feature and is only supported on Dsv5 series VMs."
                                },
                                {
                                    "name": "securityType",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": "[or(contains(steps('imageManagement').operatingSystem.versionSelection, 'g2'), contains(steps('imageManagement').operatingSystem.versionSelection, 'win11'))]",
                                    "label": "Security type",
                                    "defaultValue": "Standard",
                                    "toolTip": "Security type refers to the different security features available for a virtual machine. Security features like Trusted launch and Confidential Virtual Machines help to improve the security of Azure generation 2 virtual machines. However, additional security features have some limitations, which include not supporting back up, managed disks, and ephemeral OS disks. Learn more about Trusted launch virtual machines at https://learn.microsoft.com/en-us/azure/virtual-machines/trusted-launch and Confidential virtual machines at https://learn.microsoft.com/en-us/azure/confidential-computing/confidential-vm-overview.",
                                    "constraints": {
                                        "required": true,
                                        "allowedValues": [
                                            {
                                                "label": "Standard",
                                                "value": "Standard"
                                            },
                                            {
                                                "label": "Trusted Launch",
                                                "value": "TrustedLaunch"
                                            },
                                            {
                                                "label": "Confidential Virtual Machine",
                                                "value": "ConfidentialVM"
                                            },
                                            {
                                                "label": "Confidential Virtual Machine Supported",
                                                "value": "ConfidentialVMSupported"
                                            }
                                        ]
                                    }
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "aib",
                    "label": "Azure Image Builder (AIB)",
                    "elements": [
                        {
                            "name": "description",
                            "type": "Microsoft.Common.TextBlock",
                            "visible": true,
                            "options": {
                              "text": "The AIB service allows the use of scripts and customizers to automatically create images on demand. This solution will deploy a managed identity and custom RBAC roles to enable AIB.",
                              "link": {
                                "label": "Learn more",
                                "uri": "https://learn.microsoft.com/azure/virtual-machines/image-builder-overview?tabs=azure-powershell"
                              }
                            }
                          },
                        {
                            "name": "buildSchedule",
                            "type": "Microsoft.Common.OptionsGroup",
                            "visible": true,
                            "label": "Build schedule",
                            "defaultValue": "Recurring",
                            "toolTip": "Select a schedule for the image template builds. A recurring schedule will check for a new marketplace image daily and will initiate a new build when found.",
                            "constraints": {
                                "required": true,
                                "allowedValues": [
                                    {
                                        "label": "OneTime",
                                        "value": "OneTime"
                                    },
                                    {
                                        "label": "Recurring",
                                        "value": "Recurring"
                                    }
                                ]
                            }
                        },
                        {
                            "name": "virtualNetwork",
                            "type": "Microsoft.Common.CheckBox",
                            "visible": true,
                            "label": "Existing virtual network",
                            "defaultValue": false,
                            "toolTip": "Select an existing virtual network and subnet for the AIB build virtual machines. This enables the use of Private Link and prevents the deployment of public IP addresses."
                        },
                        {
                            "name": "virtualNetworkSelection",
                            "type": "Microsoft.Solutions.ResourceSelector",
                            "visible": "[steps('aib').virtualNetwork]",
                            "label": "Virtual network",
                            "resourceType": "Microsoft.Network/virtualNetworks",
                            "options": {
                                "filter": {
                                    "subscription": "onBasics",
                                    "location": "onBasics"
                                }
                            }
                        },
                        {
                            "name": "subnetsApi",
                            "type": "Microsoft.Solutions.ArmApiControl",
                            "request": {
                                "method": "GET",
                                "path": "[concat(steps('aib').virtualNetworkSelection.id, '/subnets?api-version=2022-05-01')]"
                            }
                        },
                        {
                            "name": "subnet",
                            "type": "Microsoft.Common.DropDown",
                            "visible": "[steps('aib').virtualNetwork]",
                            "label": "Subnet",
                            "defaultValue": "",
                            "toolTip": "Select an existing subnet for AIB build virtual machines. This enables the use of Private Link and prevents the deployment of public IP addresses.",
                            "constraints": {
                                "allowedValues": "[map(steps('aib').subnetsApi.value, (item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.name, '\"}')))]"
                            }
                        },
                        {
                            "name": "customizers",
                            "type": "Microsoft.Common.Section",
                            "label": "Customizers",
                            "elements": [
                                {
                                    "name": "rdpShortPathInfo",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": true,
                                    "options": {
                                        "text": "RDP Shortpath is a feature of AVD that establishes a direct UDP-based transport between a supported Windows Remote Desktop client and AVD session host, this UDP-based transport offers better connection reliability and more consistent latency. It can be configured to used managed networks or to go over public network (default).",
                                        "uri": "https://learn.microsoft.com/azure/virtual-desktop/rdp-shortpath?tabs=managed-networks",
                                        "style": "Info"
                                    }
                                },
                                {
                                    "name": "rdpShortPathSelection",
                                    "type": "Microsoft.Common.OptionsGroup",
                                    "visible": true,
                                    "label": "RDP shortpath for",
                                    "defaultValue": "Public networks",
                                    "toolTip": "Determine whether to enable RDP short path for managed networks on the AVD session hosts.",
                                    "constraints": {
                                        "required": true,
                                        "allowedValues": [
                                            {
                                                "label": "Managed networks",
                                                "value": true
                                            },
                                            {
                                                "label": "Public networks",
                                                "value": false
                                            }
                                        ]
                                    }
                                },
                                {
                                    "name": "screenCaptureProtectionInfo",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": true,
                                    "options": {
                                        "text": "Screen Capture Protection is a beneficial feature under specific conditions. Click here for more information.",
                                        "uri": "https://learn.microsoft.com/en-us/azure/virtual-desktop/screen-capture-protection",
                                        "style": "Info"
                                    }
                                },
                                {
                                    "name": "screenCaptureProtectionSelection",
                                    "type": "Microsoft.Common.CheckBox",
                                    "visible": true,
                                    "label": "Enable screen capture protection",
                                    "defaultValue": false,
                                    "toolTip": "Determine whether to enable Screen Capture Protection for the AVD session hosts."
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "monitoring",
                    "label": "Monitoring",
                    "type": "Microsoft.Common.Section",
                    "visible": true,
                    "elements": [
                        {
                            "name": "monitoringAndAlerting",
                            "type": "Microsoft.Common.CheckBox",
                            "visible": true,
                            "label": "Enable monitoring & alerting",
                            "defaultValue": false,
                            "toolTip": "Determine whether to enable monitoring and alerting for the Azure Image Builder builds."
                        },
                        {
                            "name": "distributionGroup",
                            "type": "Microsoft.Common.TextBox",
                            "visible": "[steps('monitoring').monitoringAndAlerting]",
                            "label": "Distribution group",
                            "toolTip": "Input the distribution group for receiving alerts on the build status.",
                            "placeholder": "Example: operations@contoso.com",
                            "constraints": {
                                "required": true,
                                "regex": "^[a-z0-9A-Z_.-]+@(?:[a-z0-9]+\\.)+[a-z]+$",
                                "validationMessage": "The value must be a valid email address."
                            }
                        },
                        {
                            "name": "existingLogAnalyticsWorkspace",
                            "type": "Microsoft.Common.CheckBox",
                            "visible": "[steps('monitoring').monitoringAndAlerting]",
                            "label": "Existing log analytics workspace",
                            "defaultValue": false,
                            "toolTip": "Determine whether to select an existing Log Analytics Workspace to capture the monitoring data."
                        },
                        {
                            "name": "logAnalyticsWorkspaceSelection",
                            "type": "Microsoft.Solutions.ResourceSelector",
                            "visible": "[steps('monitoring').existingLogAnalyticsWorkspace]",
                            "label": "Log analytics workspace",
                            "resourceType": "Microsoft.OperationalInsights/workspaces",
                            "options": {}
                        }
                    ]
                },
                {
                    "name": "naming",
                    "label": "Resource Naming",
                    "type": "Microsoft.Common.Section",
                    "visible": true,
                    "elements": [
                        {
                            "name": "info1",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": true,
                            "options": {
                                "text": "The AVD accelerator provides automated resource naming based on Microsoft best practices, default resource organization and naming is shown in the diagram.",
                                "uri": "https://github.com/Azure/avdaccelerator/blob/main/workload/docs/diagrams/avd-accelerator-resource-organization-naming.png",
                                "style": "Info"
                            }
                        },
                        {
                            "name": "customNamingSelection",
                            "type": "Microsoft.Common.CheckBox",
                            "visible": true,
                            "label": "Custom resource naming",
                            "defaultValue": false,
                            "toolTip": "When selected, the information will be used to name resources, otherwise the deployment will use the AVD accelerator naming standard."
                        },
                        {
                            "name": "namingWarning",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": "[steps('naming').customNamingSelection]",
                            "options": {
                                "text": "When using custom names, please follow the guidance on the Naming Rules and Restrictions for Azure Resources webpage.",
                                "uri": "https://docs.microsoft.com/azure/azure-resource-manager/management/resource-name-rules",
                                "style": "Warning"
                            }
                        },
                        {
                            "name": "customNaming",
                            "type": "Microsoft.Common.Section",
                            "label": "Custom names:",
                            "visible": "[steps('naming').customNamingSelection]",
                            "elements": [
                                {
                                    "name": "resourceGroup",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Resource group",
                                    "toolTip": "Input a custom name for the shared services resource group.",
                                    "placeholder": "Example: rg-avd-shared-services",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^(?!.*[\\.]$)[a-zA-Z0-9_\\.()-]{1,90}$",
                                        "validationMessage": "The value must be alphanumerics, underscores, hyphens, periods, and parentheses. The value must not end with a period. The length must be 1 to 90 characters."
                                    }
                                },
                                {
                                    "name": "computeGallery",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Compute gallery",
                                    "toolTip": "Input a custom name for the Azure Compute Gallery.",
                                    "placeholder": "Example: gal_avd",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^(?:[a-zA-Z0-9]|[a-z0-9A-Z][a-z0-9A-Z_\\.]{0,78}[a-z0-9A-Z])$",
                                        "validationMessage": "The value must be alphanumerics, underscores, and periods. The value must begin and end with alphanumerics. The length must be 1 to 80 characters."
                                    }
                                },
                                {
                                    "name": "imageDefinition",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Image definition",
                                    "toolTip": "Input a custom name for the Image Definition in the Compute Gallery.",
                                    "placeholder": "Example: avd_win11_21h2",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^(?:[a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9_\\.-]{0,78}[a-zA-Z0-9])$",
                                        "validationMessage": "The value must be alphanumerics, underscores, hyphens, and periods. The value must start and end with an alphanumeric. The length must be 1 to 80 characters."
                                    }
                                },
                                {
                                    "name": "imageTemplate",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Image template",
                                    "toolTip": "Input a custom name for the AIB Image Template.",
                                    "placeholder": "Example: it-avd-win11-21h2",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^(?!.*[\\. ]).{1,260}$",
                                        "validationMessage": "The must not end with a period or space. The length must be 1 to 260 characters."
                                    }
                                },
                                {
                                    "name": "automationAccount",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Automation account",
                                    "toolTip": "Input a custom name for the Automation Account.",
                                    "placeholder": "Example: aa-aib",
                                    "constraints": {
                                        "required": true,
                                        "regex": "[a-zA-Z][a-zA-Z0-9-]{4,48}[a-zA-Z0-9]$",
                                        "validationMessage": "The value must be alphanumerics and hyphens. The value must start with a letter and end with an alphanumeric. The length must be 6 to 50 characters."
                                    }
                                },
                                {
                                    "name": "logAnalyticsWorkspace",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Log analytics workspace",
                                    "toolTip": "Input a custom name for the Log Analytics Workspace.",
                                    "placeholder": "Example: log-avd",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z][a-z0-9A-Z-]{4,61}[a-z0-9A-Z]$",
                                        "validationMessage": "The value must be alphanumerics and hyphens. The value must start and end with an alphanumeric. The length must be 4 to 63 characters."
                                    }
                                },
                                {
                                    "name": "actionGroup",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Action group",
                                    "toolTip": "Input a custom name for the Action Group.",
                                    "placeholder": "Example: ag-aib",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^(?!.*[\\.]$)(?!.* $)[^:<>+/&%\\?]{1,260}$",
                                        "validationMessage": "The value must not contain: :<>+/&%\\?. The value must not end with a space or period. The length must be 1 to 260 characters."
                                    }
                                },
                                {
                                    "name": "userAssignedManagedIdentity",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "User assigned identity",
                                    "toolTip": "Input a custom name for the User Assigned Identity.",
                                    "placeholder": "Example: id-aib",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-zA-Z0-9][a-zA-Z0-9_-]{2,127}$",
                                        "validationMessage": "The value must contain alphanumerics, hyphens, and underscores. The value must start with a letter or number. The length must be 3 to 128 characters."
                                    }
                                }
                            ]
                        },
                        {
                            "name": "info2",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": true,
                            "options": {
                                "text": "AVD accelerator has built-in resource naming automation based and best practices Microsoft Cloud Adoption Framework (CAF) naming convention.",
                                "uri": "https://docs.microsoft.com/azure/cloud-adoption-framework/ready/azure-best-practices/resource-naming",
                                "style": "Info"
                            }
                        },
                        {
                            "name": "info3",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": true,
                            "options": {
                                "text": "And abbreviations recommendations for Azure resource types.",
                                "uri": "https://docs.microsoft.com/azure/cloud-adoption-framework/ready/azure-best-practices/resource-abbreviations",
                                "style": "Info"
                            }
                        }
                    ]
                },
                {
                    "name": "tags",
                    "label": "Resource Tags",
                    "type": "Microsoft.Common.Section",
                    "visible": true,
                    "elements": [
                        {
                            "name": "selection",
                            "type": "Microsoft.Common.CheckBox",
                            "visible": true,
                            "label": "Custom resource tags",
                            "defaultValue": false,
                            "toolTip": "When selected, the information provided will be used to create tags on resources and resource groups."
                        },
                        {
                            "name": "customTags",
                            "type": "Microsoft.Common.Section",
                            "label": "Custom Tags:",
                            "visible": "[steps('tags').selection]",
                            "elements": [
                                {
                                    "name": "imageBuild",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Image build",
                                    "toolTip": "Input the value for the tag key 'ImageBuildName'.",
                                    "placeholder": "Example: AVD-Image",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,256}$",
                                        "validationMessage": "Value must be 1-256 characters."
                                    }
                                },
                                {
                                    "name": "workload",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Workload",
                                    "toolTip": "Input the value for the tag key 'WorkloadName'.",
                                    "placeholder": "Example: AVD",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,256}$",
                                        "validationMessage": "Value must be 1-256 characters."
                                    }
                                },
                                {
                                    "name": "dataClassification",
                                    "type": "Microsoft.Common.DropDown",
                                    "label": "Data classification",
                                    "filter": true,
                                    "defaultValue": "Non-business",
                                    "toolTip": "Select the value for the tag key 'DataClassification', in reference to the sensitivity of the data hosted.",
                                    "constraints": {
                                        "required": true,
                                        "allowedValues": [
                                            {
                                                "label": "Non-business",
                                                "description": "",
                                                "value": "Non-business"
                                            },
                                            {
                                                "label": "Public",
                                                "description": "",
                                                "value": "Public"
                                            },
                                            {
                                                "label": "General",
                                                "description": "",
                                                "value": "General"
                                            },
                                            {
                                                "label": "Confidential",
                                                "description": "",
                                                "value": "Confidential"
                                            },
                                            {
                                                "label": "Highly Confidential",
                                                "description": "",
                                                "value": "Highly Confidential"
                                            }
                                        ]
                                    }
                                },
                                {
                                    "name": "department",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Department",
                                    "toolTip": "Input the value for the tag key 'Department', in reference to the department that owns the deployment.",
                                    "placeholder": "Example: Contoso-AVD",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,256}$",
                                        "validationMessage": "Value must be 1-256 characters."
                                    }
                                },
                                {
                                    "name": "criticality",
                                    "type": "Microsoft.Common.DropDown",
                                    "label": "Criticality",
                                    "filter": true,
                                    "defaultValue": "Low",
                                    "toolTip": "Select the value for the tag key named 'Criticality', in reference to the criticality of the workload.",
                                    "constraints": {
                                        "required": true,
                                        "allowedValues": [
                                            {
                                                "label": "Low",
                                                "description": "",
                                                "value": "Low"
                                            },
                                            {
                                                "label": "Medium",
                                                "description": "",
                                                "value": "Medium"
                                            },
                                            {
                                                "label": "High",
                                                "description": "",
                                                "value": "High"
                                            },
                                            {
                                                "label": "Mission-critical",
                                                "description": "",
                                                "value": "Mission-critical"
                                            },
                                            {
                                                "label": "Custom",
                                                "description": "",
                                                "value": "Custom"
                                            }
                                        ]
                                    }
                                },
                                {
                                    "name": "customCriticality",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Custom criticality",
                                    "visible": "[equals(steps('tags').customTags.criticality, 'Custom')]",
                                    "toolTip": "Input the value for the tag key 'Criticality', in reference to a custom criticality for the workload.",
                                    "placeholder": "Example: Contoso-Criticality",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,256}$",
                                        "validationMessage": "Value must be 1-256 characters."
                                    }
                                },
                                {
                                    "name": "application",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Application name",
                                    "toolTip": "Input the value for the tag key 'ApplicationName', in reference to the details about the application.",
                                    "placeholder": "Example: Contoso-App",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,256}$",
                                        "validationMessage": "Value must be 1-256 characters."
                                    }
                                },
                                {
                                    "name": "operationsTeam",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Operations team",
                                    "toolTip": "Input the value for the tag key 'OpsTeam', in reference to the team accountable for day-to-day operations.",
                                    "placeholder": "Example: workload-admins@Contoso.com",
                                    "constraints": {
                                        "required": true
                                    }
                                },
                                {
                                    "name": "owner",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Owner",
                                    "toolTip": "Input the value for the tag key 'Owner', in reference to the organizational owner of the AVD deployment.",
                                    "placeholder": "Example: workload-owner@Contoso.com",
                                    "constraints": {
                                        "required": true
                                    }
                                },
                                {
                                    "name": "costCenter",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Cost center",
                                    "toolTip": "Input the value for the tag key 'CostCenter', in reference to the cost center of the owning team.",
                                    "placeholder": "Example: Contoso-CC",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,256}$",
                                        "validationMessage": "Value must be 1-256 characters."
                                    }
                                },
                                {
                                    "name": "environment",
                                    "type": "Microsoft.Common.DropDown",
                                    "label": "Environment",
                                    "filter": true,
                                    "defaultValue": "Dev",
                                    "toolTip": "Select the value for the tag key 'Environment', in reference to the environment type of the workload.",
                                    "constraints": {
                                        "required": true,
                                        "allowedValues": [
                                            {
                                                "label": "Dev",
                                                "description": "",
                                                "value": "Dev"
                                            },
                                            {
                                                "label": "Staging",
                                                "description": "",
                                                "value": "Staging"
                                            },
                                            {
                                                "label": "Prod",
                                                "description": "",
                                                "value": "Prod"
                                            }
                                        ]
                                    }
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        "outputs": {
            "parameters": {
                "alertsActionGroupCustomName": "[if(equals(steps('naming').customNamingSelection, true), steps('naming').customNaming.actionGroup, 'none')]",
                "alertsDistributionGroup": "[if(equals(steps('monitoring').monitoringAndAlerting, true), steps('monitoring').distributionGroup, '')]",
                "applicationNameTag": "[if(equals(steps('tags').selection, true), steps('tags').customTags.application, 'none')]",
                "automationAccountCustomName": "[if(equals(steps('naming').customNamingSelection, true), steps('naming').customNaming.automationAccount, 'none')]",
                "buildSchedule": "[steps('aib').buildSchedule]",
                "costCenterTag": "[if(equals(steps('tags').selection, true), steps('tags').customTags.costCenter, 'none')]",
                "criticalityCustomTag": "[if(equals(steps('tags').customTags.criticality, 'Custom'), steps('tags').customTags.customCriticality, 'Low')]",
                "criticalityTag": "[if(equals(steps('tags').selection, true), steps('tags').customTags.criticality, 'Low')]",
                "customNaming": "[steps('naming').customNamingSelection]",
                "dataClassificationTag": "[if(equals(steps('tags').selection, true), steps('tags').customTags.dataClassification, 'Non-business')]",
                "departmentTag": "[if(equals(steps('tags').selection, true), steps('tags').customTags.department, 'none')]",
                "deploymentLocation": "[steps('basics').resourceScope.location.name]",
                "enableMonitoringAlerts": "[steps('monitoring').monitoringAndAlerting]",
                "enableResourceTags": "[steps('tags').selection]",
                "environmentTag": "[if(equals(steps('tags').selection, true), steps('tags').customTags.environment, 'Dev')]",
                "existingLogAnalyticsWorkspaceResourceId": "[if(equals(steps('monitoring').existingLogAnalyticsWorkspace, true), steps('monitoring').logAnalyticsWorkspaceSelection.id, '')]",
                "existingSubnetName": "[if(equals(steps('aib').virtualNetwork, true), steps('aib').subnet, '')]",
                "existingVirtualNetworkResourceId": "[if(equals(steps('aib').virtualNetwork, true), steps('aib').virtualNetworkSelection.id, '')]",
                "imageBuildNameTag": "[if(equals(steps('tags').selection, true), steps('tags').customTags.imageBuild, 'none')]",
                "imageDefinitionCustomName": "[if(equals(steps('naming').customNamingSelection, true), steps('naming').customNaming.imageDefinition, 'none')]",
                "imageDefinitionAcceleratedNetworkSupported": "[if(equals(steps('imageManagement').imageDefinitionFeatures.supportsAcceleratedNetworking, true), 'true', 'false')]",
                "imageDefinitionHibernateSupported": "[if(equals(steps('imageManagement').imageDefinitionFeatures.supportsHibernation, true), 'true', 'false')]",
                "imageDefinitionSecurityType": "[steps('imageManagement').imageDefinitionFeatures.securityType]",
                "imageGalleryCustomName": "[if(equals(steps('naming').customNamingSelection, true), steps('naming').customNaming.computeGallery, 'none')]",
                "imageTemplateCustomName": "[if(equals(steps('naming').customNamingSelection, true), steps('naming').customNaming.imageTemplate, 'none')]",
                "imageVersionDisasterRecoveryLocation": "[if(equals(steps('imageManagement').imageVersion.disasterRecovery, true), steps('imageManagement').imageVersion.disasterRecoveryLocation, '')]",
                "imageVersionPrimaryLocation": "[steps('imageManagement').imageVersion.primaryLocation]",
                "imageVersionStorageAccountType": "[steps('imageManagement').imageVersion.storageAccountType]",
                "logAnalyticsWorkspaceCustomName": "[if(equals(steps('naming').customNamingSelection, true), steps('naming').customNaming.logAnalyticsWorkspace, 'none')]",
                "operatingSystemImage": "[steps('imageManagement').operatingSystem.versionSelection]",
                "operationsTeamTag": "[if(equals(steps('tags').selection, true), steps('tags').customTags.operationsTeam, 'none')]",
                "ownerTag": "[if(equals(steps('tags').selection, true), steps('tags').customTags.owner, 'none')]",
                "rdpShortPathManagedNetworks": "[steps('aib').customizers.rdpShortPathSelection]",
                "resourceGroupCustomName": "[if(equals(steps('naming').customNamingSelection, true), steps('naming').customNaming.resourceGroup, 'none')]",
                "screenCaptureProtection": "[steps('aib').customizers.screenCaptureProtectionSelection]",
                "sharedServicesSubId": "[steps('basics').resourceScope.subscription.subscriptionId]",
                "useExistingVirtualNetwork": "[steps('aib').virtualNetwork]",
                "userAssignedManagedIdentityCustomName": "[if(equals(steps('naming').customNamingSelection, true), steps('naming').customNaming.userAssignedManagedIdentity, 'none')]",
                "workloadNameTag": "[if(equals(steps('tags').selection, true), steps('tags').customTags.workload, 'none')]"
            },
            "kind": "Subscription",
            "location": "[steps('basics').resourceScope.location.name]",
            "subscriptionId": "[steps('basics').resourceScope.subscription.id]"
        }
    }
}