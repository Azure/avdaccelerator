{
    "$schema": "<relative path to createFormUI.schema.json>",
    "view": {
        "kind": "Form",
        "properties": {
            "isWizard": false,
            "title": "Azure Virtual Desktop - Landing Zone Accelerator (LZA) - Baseline",
            "steps": [
                {
                    "name": "basics",
                    "label": "Deployment Basics",
                    "elements": [
                        {
                            "name": "infoPreReq",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": true,
                            "options": {
                                "text": "PREREQUISITES REQUIRED \n\nThere are prerequisites that must be setup in your Azure environment to successfully deploy this Azure Virtual Desktop Landing Zone Accelerator. Click here to review the prerequisites in the Getting Started guide.",
                                "uri": "https://github.com/Azure/avdaccelerator/blob/main/workload/docs/getting-started-baseline.md",
                                "style": "Warning"
                            }
                        },
                        {
                            "name": "infoPreReqCheckbox",
                            "type": "Microsoft.Common.CheckBox",
                            "visible": true,
                            "label": "I have read and understand the Azure Virtual Desktop LZA deployment pre-requisites",
                            "defaultValue": false,
                            "toolTip": "I have read and understand the Azure Virtual Desktop LZA deployment pre-requisites.",
                            "constraints": {
                                "required": true
                            }
                        },
                        {
                            "name": "deploymentInfo",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": true,
                            "options": {
                                "style": "Info",
                                "text": "The subscription selected in the 'Project details' section below will be used to deploy all resources. \n\nThe region selected in 'Instance details' section below will be used to deploy the Azure Virtual Desktop management plane resources (workspace, host pool, and application group, etc.). These resource types are not available in all regions, but they are globally replicated.\n\nThe session hosts do not have to be deployed to the same region, therefore you will have the option to select that region on the 'Session Hosts' blade.",
                                "uri": "https://docs.microsoft.com/azure/virtual-desktop/data-locations"
                            }
                        },
                        {
                            "name": "resourceScope",
                            "type": "Microsoft.Common.ResourceScope",
                            "location": {
                                "resourceTypes": [
                                    "Microsoft.DesktopVirtualization/workspaces"
                                ]
                            }
                        },
                        {
                            "name": "resourceGroupsApi",
                            "type": "Microsoft.Solutions.ArmApiControl",
                            "request": {
                                "method": "GET",
                                "path": "[concat(steps('basics').resourceScope.subscription.id, '/resourceGroups?api-version=2021-04-01')]"
                            }
                        },
                        {
                            "name": "ComputeResourceGroup",
                            "type": "Microsoft.Common.DropDown",
                            "label": "Pool compute resource group",
                            "multiselect": false,
                            "defaultValue": "",
                            "toolTip": "Select the name of the existing resource group where the host pool compute resources will be deployed.",
                            "constraints": {
                                "allowedValues": "[map(steps('basics').resourceGroupsApi.value, (item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.name, '\"}')))]",
                                "required": true
                            },
                            "infoMessages": [],
                            "visible": true
                        },
                        {
                            "name": "infoResourceGroupNaming",
                            "type": "Microsoft.Common.TextBlock",
                            "visible": true,
                            "options": {
                                "text": "Azure Virtual Desktop Landing Zones will create the resource group hierarchy under the subscriptions with the prefix provided in this step.",
                                "link": {
                                    "label": "Learn more",
                                    "uri": "https://docs.microsoft.com/azure/cloud-adoption-framework/ready/enterprise-scale/management-group-and-subscription-organization"
                                }
                            }
                        },
                        {
                            "name": "deploymentSpecs",
                            "type": "Microsoft.Common.Section",
                            "visible": true,
                            "label": "Deployment Specs",
                            "elements": [
                                {
                                    "name": "deploymentPrefix",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Prefix",
                                    "toolTip": "Provide a prefix (max 4 characters) for the resource groups and resources created as part of Azure Virtual Desktop landing zones.",
                                    "placeholder": "Example: app1",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,4}$",
                                        "validationMessage": "The prefix must be 1-4 characters."
                                    }
                                },
                                {
                                    "name": "deploymentEnvironment",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": true,
                                    "label": "Environment",
                                    "defaultValue": "Development",
                                    "toolTip": "Select the type of environment (Development (d), Test (t), Production (p)) that will be deployed, this information will be use as part of the resources naming.",
                                    "constraints": {
                                        "allowedValues": [
                                            {
                                                "label": "Development",
                                                "value": "Dev"
                                            },
                                            {
                                                "label": "Test",
                                                "value": "Test"
                                            },
                                            {
                                                "label": "Production",
                                                "value": "Prod"
                                            }
                                        ]
                                    }
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "identity",
                    "label": "Identity",
                    "elements": [
                        {
                            "name": "identityInfo",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": true,
                            "options": {
                                "text": "Azure Virtual Desktop LZA deployment expects identity service to be already available in the current Azure estate.",
                                "uri": "https://docs.microsoft.com/azure/virtual-desktop/authentication#identities",
                                "style": "Info"
                            }
                        },
                        {
                            "name": "identityDomainInformation",
                            "type": "Microsoft.Common.Section",
                            "visible": true,
                            "label": "Domain to join",
                            "elements": [
                                {
                                    "name": "identityServiceProvider",
                                    "type": "Microsoft.Common.OptionsGroup",
                                    "visible": true,
                                    "label": "Identity service provider",
                                    "defaultValue": "Active Directory (AD DS)",
                                    "toolTip": "Identity service provider (ADDS or AADDS) that already exist and will be used for Azure Virtual Desktop.",
                                    "constraints": {
                                        "required": true,
                                        "allowedValues": [
                                            {
                                                "label": "Microsoft Entra ID",
                                                "value": "AAD"
                                            },
                                            {
                                                "label": "Active Directory (AD DS)",
                                                "value": "ADDS"
                                            },
                                            {
                                                "label": "Microsoft Entra Domain Services",
                                                "value": "AADDS"
                                            }
                                        ]
                                    }
                                },
                                {
                                    "name": "identityServiceProviderIntuneEnrollment",
                                    "type": "Microsoft.Common.CheckBox",
                                    "visible": "[equals(steps('identity').identityDomainInformation.identityServiceProvider, 'AAD')]",
                                    "label": "Intune enrollment",
                                    "defaultValue": false,
                                    "toolTip": "If Intune is configured in your Microsoft Entra ID tenant, you can choose to have the VM automatically enrolled during the deployment by selecting this box."
                                },
                                {
                                    "name": "identityServiceProviderInfo",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": "[not(equals(steps('identity').identityDomainInformation.identityServiceProvider, 'AAD'))]",
                                    "options": {
                                        "text": "Identity service provider must already exist, as they are a prerequisite for the Azure Virtual Desktop LZA deployment.",
                                        "uri": "https://github.com/Azure/avdaccelerator/blob/main/workload/docs/getting-started.md",
                                        "style": "Info"
                                    }
                                }
                            ]
                        },
                        {
                            "name": "identityAvdAccess",
                            "type": "Microsoft.Common.Section",
                            "visible": true,
                            "label": "Azure Virtual Desktop access assignment",
                            "elements": [
                                {
                                    "name": "groupsApi",
                                    "type": "Microsoft.Solutions.GraphApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "/v1.0/groups?$top=999"
                                    }
                                },
                                {
                                    "name": "identityAvdUserAccessGroupDropDown",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": "[not(steps('identity').identityAvdAccess.identityAvdUserAccessGroupCheckBox)]",
                                    "label": "Groups",
                                    "defaultValue": "",
                                    "filter": true,
                                    "toolTip": "Select the desired group to give access to Azure Virtual Desktop resources and if applicable to FSLogix file share",
                                    "multiselect": false,
                                    "constraints": {
                                        "allowedValues": "[map(steps('identity').identityAvdAccess.groupsApi.value, (item) => parse(concat('{\"label\":\"', item.displayName, '\",\"value\": {\"name\":\"', item.displayName, '\",\"id\":\"', item.id, '\"}}')))]"
                                    }
                                },
                                {
                                    "name": "identityAvdUserAccessGroupCheckBox",
                                    "type": "Microsoft.Common.CheckBox",
                                    "visible": true,
                                    "label": "Provide group details",
                                    "defaultValue": false,
                                    "toolTip": "When the desired group is not listed in the drop down, selecting this box will allow for entering the group's ObjectID and name. this information will be used to setup AVD access and FSLogix's file share NTFS permissions."
                                },
                                {
                                    "name": "identityAvdUserAccessGroupTextBox1",
                                    "type": "Microsoft.Common.TextBox",
                                    "visible": "[steps('identity').identityAvdAccess.identityAvdUserAccessGroupCheckBox]",
                                    "label": "Name",
                                    "toolTip": "Group name to be granted access to Azure Virtual Desktop published items and FSLogix NTFS permissions.",
                                    "placeholder": "Example: AVD-users"
                                },
                                {
                                    "name": "identityAvdUserAccessGroupTextBox2",
                                    "type": "Microsoft.Common.TextBox",
                                    "visible": "[steps('identity').identityAvdAccess.identityAvdUserAccessGroupCheckBox]",
                                    "label": "Object ID",
                                    "toolTip": "Group objectID to be granted access to Azure Virtual Desktop published items and FSLogix NTFS permissions.",
                                    "placeholder": "Example: XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX"
                                }
                            ]
                        },
                        {
                            "name": "identityCredentials",
                            "type": "Microsoft.Common.Section",
                            "visible": true,
                            "label": "Credentials",
                            "elements": [
                                {
                                    "name": "secretsKeyvault",
                                    "type": "Microsoft.Solutions.ResourceSelector",
                                    "label": "Key vault",
                                    "toolTip": "Select the AVD LZA deployed keyvault that contains the local user and domain join credentials.",
                                    "resourceType": "Microsoft.KeyVault/vaults",
                                    "constraints": {
                                        "required": true
                                    }
                                },
                                {
                                    "name": "identityDomainJoinUserName",
                                    "type": "Microsoft.Common.TextBox",
                                    "visible": "[not(equals(steps('identity').identityDomainInformation.identityServiceProvider, 'AAD'))]",
                                    "label": "Domain join principal name",
                                    "placeholder": "Example: avdadmin@contoso.com",
                                    "defaultValue": "",
                                    "toolTip": "Provide username with permissions to join session host to the domain.",
                                    "constraints": {
                                        "required": true
                                    }
                                },
                                {
                                    "name": "identityDomainJoinUserPassword",
                                    "type": "Microsoft.Common.TextBox",
                                    "visible": "[not(equals(steps('identity').identityDomainInformation.identityServiceProvider, 'AAD'))]",
                                    "label": "Domain Join Password secret name",
                                    "toolTip": "Provide keyvault secret name for domain join password.",
                                    "defaultValue": "domainJoinUserPassword",
                                    "constraints": {
                                        "required": true
                                    }
                                },
                                {
                                    "name": "identityLocalUserName",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "VM local admin username",
                                    "toolTip": "Provide username for session host local admin account. Administrator can't be used as username, it is reserved by the system.",
                                    "placeholder": "Example: avdadmin",
                                    "defaultValue": "",
                                    "constraints": {
                                        "regex": "^(?!.*[aA]dministrator).*$",
                                        "validationMessage": "This username can't be used, it is a reserved word.",
                                        "required": true
                                    }
                                },
                                {
                                    "name": "identityLocalUserPassword",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "VM local admin password secret name",
                                    "toolTip": "Provide keyvault secret name for VM local admin password.",
                                    "defaultValue": "vmLocalUserPassword",
                                    "constraints": {
                                        "required": true
                                    }
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "sessionHosts",
                    "label": "Session hosts",
                    "elements": [
                        {
                            "name": "sessionHostsRegionSection",
                            "type": "Microsoft.Common.Section",
                            "visible": "[steps('sessionHosts').deploySessionHosts]",
                            "label": "Region Settings",
                            "tooltip": "The section allows you to specify the region where the compute, storage, and key vault resources are deployed.",
                            "elements": [
                                {
                                    "name": "computeApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "[concat(steps('basics').resourceScope.subscription.id,'/providers/Microsoft.Compute/resourceTypes?api-version=2021-04-01')]"
                                    }
                                },
                                {
                                    "name": "infoAvailZones",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": true,
                                    "options": {
                                        "text": "If you select 'Use availability zones' below, some regions may not be available for deployment of session hosts because not all regions support Availability Zones. \n\nThe 'Session hosts region' drop down will automatically update based on this selection. If the value changes to blank, select an alternate region or set 'Use availability zones' to 'No'.",
                                        "uri": "https://learn.microsoft.com/azure/reliability/availability-zones-service-support#azure-regions-with-availability-zone-support",
                                        "style": "Info"
                                    }
                                },
                                {
                                    "name": "sessionHostsAvailabilitySettings",
                                    "type": "Microsoft.Common.CheckBox",
                                    "visible": true,
                                    "label": "Availability zones",
                                    "defaultValue": true,
                                    "toolTip": "Distribute compute resources across availability zones. If 'No' is selected then an availability set will be created to host the VMs."
                                },
                                {
                                    "name": "sessionHostsRegion",
                                    "type": "Microsoft.Common.DropDown",
                                    "label": "Session hosts region",
                                    "defaultValue": "[steps('basics').resourceScope.location.displayName]",
                                    "filter": true,
                                    "toolTip": "Select the region where the session hosts and required resources are to be deployed.",
                                    "constraints": {
                                        "required": true,
                                        "allowedValues": "[if(equals(steps('sessionHosts').sessionHostsRegionSection.sessionHostsAvailabilitySettings, false), map(first(map(filter(steps('sessionHosts').sessionHostsRegionSection.computeApi.value, (resourceTypes) => equals(resourceTypes.resourceType, 'virtualMachines')), (item) => item.locations)), (item) => parse(concat('{\"label\":\"', item, '\",\"value\":\"', toLower(replace(item, ' ', '')), '\"}'))), map(filter(first(map(filter(steps('sessionHosts').sessionHostsRegionSection.computeApi.value, (resourceTypes) => equals(resourceTypes.resourceType, 'virtualMachines')), (item) => item.zoneMappings)), (item) => equals(length(item.zones), 3)), (item) => parse(concat('{\"label\":\"', item.location, '\",\"value\":\"', toLower(replace(item.location, ' ', '')), '\"}'))))]"
                                    }
                                }
                            ]
                        },
                        {
                            "name": "sessionHostsComputeStorageSection",
                            "type": "Microsoft.Common.Section",
                            "visible": "[steps('sessionHosts').deploySessionHosts]",
                            "label": "General settings",
                            "tooltip": "This settings apply to compute, storage, image management and key vault resources.",
                            "elements": [
                                {
                                    "name": "identityDomainOuPath",
                                    "type": "Microsoft.Common.TextBox",
                                    "visible": "[not(equals(steps('identity').identityDomainInformation.identityServiceProvider, 'AAD'))]",
                                    "label": "Custom OU path (Optional)",
                                    "toolTip": "Provide OU where to locate session hosts, if not provided session hosts will be placed on the default (computers) OU.",
                                    "placeholder": "Example: OU=session-hosts,OU=avd,DC=contoso,DC=com",
                                    "constraints": {}
                                }
                            ]
                        },
                        {
                            "name": "sessionHostsSettingsSection",
                            "type": "Microsoft.Common.Section",
                            "visible": "[steps('sessionHosts').deploySessionHosts]",
                            "label": "Session hosts settings",
                            "elements": [
                                {
                                    "name": "sessionHostSize",
                                    "type": "Microsoft.Compute.SizeSelector",
                                    "label": "VM Size",
                                    "toolTip": "",
                                    "recommendedSizes": [
                                        "Standard_D4ads_v5"
                                    ],
                                    "constraints": {
                                        "allowedSizes": [],
                                        "excludedSizes": [],
                                        "required": true
                                    },
                                    "options": {
                                        "hideDiskTypeFilter": true
                                    },
                                    "osPlatform": "Windows",
                                    "imageReference": {
                                        "publisher": "MicrosoftWindowsDesktop",
                                        "offer": "Windows-11",
                                        "sku": "21h2-avd"
                                    }
                                },
                                {
                                    "name": "sessionHostSizeInfobox",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": "[steps('sessionHosts').deploySessionHosts]",
                                    "options": {
                                        "text": "Session host virtual machine sizing guidelines.",
                                        "uri": "https://learn.microsoft.com/windows-server/remote/remote-desktop-services/virtual-machine-recs",
                                        "style": "Info"
                                    }
                                },
                                {
                                    "name": "sessionHostsCount",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "VM count",
                                    "toolTip": "Provide the number of session hosts to deploy (1-100).",
                                    "defaultValue": 1,
                                    "constraints": {
                                        "required": true,
                                        "regex": "^([1-9]|[1-9][0-9]|[1][0][0])$",
                                        "validationMessage": "The count must be between 1-100 session hosts."
                                    }
                                },
                                {
                                    "name": "sessionHostDiskType",
                                    "type": "Microsoft.Common.DropDown",
                                    "label": "OS Disk type",
                                    "filter": true,
                                    "defaultValue": "Premium",
                                    "toolTip": "Select session host disk type to host the OS.",
                                    "constraints": {
                                        "required": true,
                                        "allowedValues": [
                                            {
                                                "label": "Standard",
                                                "value": "Standard_LRS"
                                            },
                                            {
                                                "label": "Premium",
                                                "value": "Premium_LRS"
                                            }
                                        ]
                                    }
                                },
                                {
                                    "name": "sessionHostDiskZeroTrust",
                                    "type": "Microsoft.Common.CheckBox",
                                    "label": "Zero trust disk configuration",
                                    "defaultValue": false,
                                    "toolTip": "Enables disk encryption and Zero trust settings on management VM and session hosts disks"
                                },
                                {
                                    "name": "ssessionHostDiskZeroTrustWarning",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": "[steps('sessionHosts').sessionHostsSettingsSection.sessionHostDiskZeroTrust]",
                                    "options": {
                                        "text": "Zero trust disk encryption requires feature EncryptionAtHost of resource provider Microsoft.Compute to be registered in the subscription.",
                                        "uri": "https://learn.microsoft.com/azure/virtual-machines/disks-enable-host-based-encryption-portal?tabs=azure-powershell",
                                        "style": "Warning"
                                    }
                                },
                                {
                                    "name": "acceleratedNetworking",
                                    "type": "Microsoft.Common.CheckBox",
                                    "label": "Enable accelerated networking",
                                    "defaultValue": true,
                                    "toolTip": "Enables low latency and high throughput on the network interface."
                                },
                                {
                                    "name": "warningAcceleratedNetworkingSupport",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": "[steps('sessionHosts').sessionHostsOsSection.sessionHostsImageSource]",
                                    "options": {
                                        "text": "The Compute Gallery Image definition selected must have the 'isAcceleratedNetworkSupported' feature property set to 'true' if you enable accelerated networking on the session hosts.",
                                        "uri": "https://github.com/Azure/avdaccelerator/blob/main/workload/docs/getting-started-baseline.md",
                                        "style": "Warning"
                                    }
                                }
                            ]
                        },
                        {
                            "name": "sessionHostsOsSection",
                            "type": "Microsoft.Common.Section",
                            "visible": "[steps('sessionHosts').deploySessionHosts]",
                            "label": "OS selection",
                            "elements": [
                                {
                                    "name": "sessionHostsImageSource",
                                    "type": "Microsoft.Common.DropDown",
                                    "label": "OS image source",
                                    "filter": true,
                                    "defaultValue": "Marketplace",
                                    "toolTip": "Select marketplace or build custom image to deploy the session hosts.",
                                    "constraints": {
                                        "required": true,
                                        "allowedValues": [
                                            {
                                                "label": "Marketplace",
                                                "value": false
                                            },
                                            {
                                                "label": "Compute Gallery",
                                                "value": true
                                            }
                                        ]
                                    }
                                },
                                {
                                    "name": "sessionHostsOsImage",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": "[not(steps('sessionHosts').sessionHostsOsSection.sessionHostsImageSource)]",
                                    "label": "OS version",
                                    "filter": true,
                                    "defaultValue": "Windows 11 22H2 (Gen2)",
                                    "toolTip": "Select the operating system version of the session hosts.",
                                    "constraints": {
                                        "required": true,
                                        "allowedValues": [
                                            {
                                                "label": "Windows 10 21H2",
                                                "value": "win10_21h2"
                                            },
                                            {
                                                "label": "Windows 10 21H2 - Office 365",
                                                "value": "win10_21h2_office"
                                            },
                                            {
                                                "label": "Windows 10 22H2 (Gen2)",
                                                "value": "win10_22h2_g2"
                                            },
                                            {
                                                "label": "Windows 10 22H2 - Office 365 (Gen2)",
                                                "value": "win10_22h2_office_g2"
                                            },
                                            {
                                                "label": "Windows 11",
                                                "value": "win11_21h2"
                                            },
                                            {
                                                "label": "Windows 11 - Office 365",
                                                "value": "win11_21h2_office"
                                            },
                                            {
                                                "label": "Windows 11 22H2 (Gen2)",
                                                "value": "win11_22h2"
                                            },
                                            {
                                                "label": "Windows 11 22H2 - Office 365 (Gen2)",
                                                "value": "win11_22h2_office"
                                            }
                                        ]
                                    }
                                },
                                {
                                    "name": "sessionHostsComputeGalleryImage",
                                    "type": "Microsoft.Solutions.ResourceSelector",
                                    "visible": "[steps('sessionHosts').sessionHostsOsSection.sessionHostsImageSource]",
                                    "label": "Image",
                                    "resourceType": "Microsoft.Compute/galleries/images",
                                    "constraints": {
                                        "required": true
                                    }
                                }
                            ]
                        },
                        {
                            "name": "sessionHostsSecuritySection",
                            "type": "Microsoft.Common.Section",
                            "visible": "[and(equals(steps('sessionHosts').deploySessionHosts, true), or(contains(steps('sessionHosts').sessionHostsOsSection.sessionHostsOsImage, 'win11'), contains(steps('sessionHosts').sessionHostsOsSection.sessionHostsOsImage, 'g2'), not(empty(steps('sessionHosts').sessionHostsOsSection.sessionHostsComputeGalleryImage))))]",
                            "label": "Security profile",
                            "elements": [
                                {
                                    "name": "sessionHostSecurityTypeWarning",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": "[not(empty(steps('sessionHosts').sessionHostsOsSection.sessionHostsComputeGalleryImage))]",
                                    "options": {
                                        "text": "Setting the Security Type to anything other than 'Standard' requires that the Azure Compute Gallery Image Definition be configured with the Security Type feature set to the appropriate value. You can determine if the image definition supports the required feature by reviewing the 'Properties' tab on the 'Overview' node of the Gallery Image Definition in the portal. If the image definition does not contain these feature options, then the deployment will fail.",
                                        "uri": "https://learn.microsoft.com/azure/templates/microsoft.compute/galleries/images?pivots=deployment-language-bicep",
                                        "style": "Warning"
                                    }
                                },
                                {
                                    "name": "securityType",
                                    "type": "Microsoft.Common.DropDown",
                                    "label": "Security type",
                                    "filter": true,
                                    "defaultValue": "Trusted Launch Virtual Machines",
                                    "toolTip": "Choose a type of security that matches your needs: Standard includes basic protections at no additional cost. Trusted launch virtual machines provide additional security features on Gen2 virtual machines to protect against persistent and advanced attacks.",
                                    "constraints": {
                                        "required": true,
                                        "allowedValues": [
                                            {
                                                "label": "Standard",
                                                "value": "Standard"
                                            },
                                            {
                                                "label": "Trusted Launch Virtual Machines",
                                                "value": "TrustedLaunch"
                                            },
                                            {
                                                "label": "Confidential Virtual Machines",
                                                "value": "ConfidentialVM"
                                            }
                                        ]
                                    }
                                },
                                {
                                    "name": "secureBootEnabled",
                                    "type": "Microsoft.Common.CheckBox",
                                    "visible": "[or(equals(steps('sessionHosts').sessionHostsSecuritySection.securityType, 'TrustedLaunch'), equals(steps('sessionHosts').sessionHostsSecuritySection.securityType, 'ConfidentialVM'))]",
                                    "label": "Enable secure boot",
                                    "defaultValue": true,
                                    "toolTip": "Secure boot helps protect your VMs against boot kits, rootkits, and kernel-level malware."
                                },
                                {
                                    "name": "vTpmEnabled",
                                    "type": "Microsoft.Common.CheckBox",
                                    "visible": "[or(equals(steps('sessionHosts').sessionHostsSecuritySection.securityType, 'TrustedLaunch'), equals(steps('sessionHosts').sessionHostsSecuritySection.securityType, 'ConfidentialVM'))]",
                                    "label": "Enable vTPM",
                                    "defaultValue": true,
                                    "toolTip": "Virtual Trusted Platform Module (vTPM) is TPM2.0 compliant and validates your VM boot integrity apart from securely storing keys and secrets."
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "storage",
                    "label": "Storage",
                    "elements": [
                        {
                            "name": "fslogixConfiguration",
                            "type": "Microsoft.Common.CheckBox",
                            "label": "Configure FSLogix",
                            "defaultValue": true,
                            "toolTip": "Configure session host to use FSLogix."
                        },
                        {
                            "name": "storageFslogix",
                            "type": "Microsoft.Common.Section",
                            "label": "Settings:",
                            "visible": "[steps('storage').fslogixConfiguration]",
                            "elements": [
                                {
                                    "name": "identityDomainName",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "AD Domain name",
                                    "visible": "[equals(steps('identity').identityDomainInformation.identityServiceProvider, 'AAD')]",
                                    "toolTip": "The full qualified domain name of the on-premises domain where the hybrid identities originated from, this information is used for Azure files authentication setup.",
                                    "placeholder": "Example: contoso.com",
                                    "constraints": {
                                        "required": true
                                    }
                                },
                                {
                                    "name": "fslogixStorageAccountSelector",
                                    "type": "Microsoft.Solutions.ResourceSelector",
                                    "label": "Storage account",
                                    "toolTip": "The name of the Storage account created and configured to host FSLogix user profile containers.",
                                    "resourceType": "Microsoft.Storage/storageAccounts",
                                    "constraints": {
                                        "required": true
                                    }
                                },
                                {
                                    "name": "fslogixStorageAccountFileShare",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "File share name",
                                    "toolTip": "The name of the file share created and configured to host FSLogix user profile containers.",
                                    "placeholder": "Example: fslogix-pc-avd1-dev-use2-001",
                                    "constraints": {
                                        "required": true
                                    }
                                }
                            ]
                        },
                        {
                            "name": "StorageConfigurationRequirements1",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": "[and(steps('storage').fslogixConfiguration, not(equals(steps('identity').identityDomainInformation.identityServiceProvider, 'AAD')))]",
                            "options": {
                                "text": "FSLogix configuration requires the storage account and file share to be already configured for authentication with ADDS or Microsoft Entra Domain Services.",
                                "uri": "https://learn.microsoft.com/azure/virtual-desktop/fslogix-profile-container-configure-azure-files-active-directory?tabs=adds",
                                "style": "Info"
                            }
                        },
                        {
                            "name": "StorageConfigurationRequirements2",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": "[and(steps('storage').fslogixConfiguration, equals(steps('identity').identityDomainInformation.identityServiceProvider, 'AAD'))]",
                            "options": {
                                "text": "FSLogix configuration requires the storage account and file share to be already configured for authentication with Microsoft Entra ID.",
                                "uri": "https://learn.microsoft.com/azure/virtual-desktop/create-profile-container-azure-ad",
                                "style": "Info"
                            }
                        },
                        {
                            "name": "StorageConfigurationAad",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": "[and(steps('storage').fslogixConfiguration, equals(steps('identity').identityDomainInformation.identityServiceProvider, 'AAD'))]",
                            "options": {
                                "text": "FSLogix storage for Microsoft Entra ID joined session hosts is currently only available for hybrid identities.",
                                "uri": "https://learn.microsoft.com/azure/virtual-desktop/create-profile-container-azure-ad",
                                "style": "Info"
                            }
                        }
                    ]
                },
                {
                    "name": "network",
                    "label": "Networking",
                    "type": "Microsoft.Common.Section",
                    "visible": true,
                    "elements": [
                        {
                            "name": "networkSettings",
                            "type": "Microsoft.Common.Section",
                            "label": "Settings:",
                            "visible": true,
                            "elements": [
                                {
                                    "name": "avdVirtualNetworkSelectorId",
                                    "type": "Microsoft.Solutions.ResourceSelector",
                                    "label": "Virtual network",
                                    "resourceType": "Microsoft.Network/virtualNetworks",
                                    "constraints": {
                                        "required": true
                                    },
                                    "options": {
                                        "filter": {
                                            "subscription": "onBasics",
                                            "location": "[steps('SessionHosts').SessionHostsRegionSection.SessionHostsRegion.location.name]"
                                        }
                                    }
                                },
                                {
                                    "name": "avdSubnetApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "[concat(steps('network').avdVirtualNetworkSelectorId.id, '/subnets?api-version=2021-03-01')]"
                                    }
                                },
                                {
                                    "name": "virtualNetworkAvdSubnetSelectorName",
                                    "label": "Subnet",
                                    "type": "Microsoft.Common.DropDown",
                                    "defaultValue": "",
                                    "toolTip": "Select the subnet.",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(steps('network').avdSubnetApi.value,(item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.id, '\",\"description\":\"', 'Resource Group: ', last(take(split(item.id, '/'), 5)), '\"}')))]",
                                        "required": true
                                    }
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "monitoring",
                    "label": "Monitoring",
                    "type": "Microsoft.Common.Section",
                    "visible": true,
                    "elements": [
                        {
                            "name": "deployMonitoring",
                            "type": "Microsoft.Common.CheckBox",
                            "visible": true,
                            "label": "Deploy monitoring",
                            "defaultValue": false,
                            "toolTip": "Deploy monitoring settings and if selected deploy Azure log analytics workspace."
                        },
                        {
                            "name": "deployMonitoringAlaWorkspace",
                            "type": "Microsoft.Common.OptionsGroup",
                            "visible": "[steps('monitoring').deployMonitoring]",
                            "label": "Log analytics workspace",
                            "defaultValue": "New",
                            "toolTip": "Deploy monitoring settings and if selected deploy Azure log analytics workspace.",
                            "constraints": {
                                "required": true,
                                "allowedValues": [
                                    {
                                        "label": "New",
                                        "value": true
                                    },
                                    {
                                        "label": "Existing",
                                        "value": false
                                    }
                                ]
                            }
                        },
                        {
                            "name": "deployMonitoringNewAlaWorkspaceRetention",
                            "type": "Microsoft.Common.TextBox",
                            "visible": "[and(steps('monitoring').deployMonitoring, steps('monitoring').deployMonitoringAlaWorkspace)]",
                            "label": "Retention policy (Days)",
                            "toolTip": "Number of days data will be retained in the workspace.",
                            "defaultValue": 90,
                            "constraints": {
                                "required": true,
                                "regex": "^[a-z0-9A-Z-]{1,90}$",
                                "validationMessage": "Value must be 1-90 characters."
                            }
                        },
                        {
                            "name": "alaWorkspaceExistingWorkspacesSelection",
                            "type": "Microsoft.Solutions.ResourceSelector",
                            "visible": "[and(steps('monitoring').deployMonitoring, not(steps('monitoring').deployMonitoringAlaWorkspace))]",
                            "label": "Existing workspace",
                            "resourceType": "Microsoft.OperationalInsights/workspaces",
                            "constraints": {
                                "required": true
                            }
                        },
                        {
                            "name": "deployMonitoringPolicies",
                            "type": "Microsoft.Common.CheckBox",
                            "visible": "[steps('monitoring').deployMonitoring]",
                            "label": "Deploy monitoring policies (subscription level)",
                            "defaultValue": false,
                            "toolTip": "Deploy monitoring policy and policy set definitions to set diagnostic settings on new deployed resources."
                        },
                        {
                            "name": "deployMonitoringInfo1",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": "[steps('monitoring').deployMonitoring]",
                            "options": {
                                "text": "Azure Virtual Desktop monitoring requires an existing Azure Log Analytics Workspace or the creation of a new one.",
                                "uri": "https://docs.microsoft.com/azure/virtual-desktop/azure-monitor",
                                "style": "Info"
                            }
                        },
                        {
                            "name": "deployMonitoringInfo2",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": "[steps('monitoring').deployMonitoring]",
                            "options": {
                                "text": "Deployment will configured all required settings to use the Azure Virtual Desktop insights workbook.",
                                "uri": "https://learn.microsoft.com/azure/virtual-desktop/azure-monitor?WT.mc_id=Portal-AppInsightsExtension",
                                "style": "Info"
                            }
                        }
                    ]
                },
                {
                    "name": "resourceNaming",
                    "label": "Resource naming",
                    "type": "Microsoft.Common.Section",
                    "visible": true,
                    "elements": [
                        {
                            "name": "resourceNamingInfo1",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": true,
                            "options": {
                                "text": "Azure Virtual Desktop LZA default naming scheme is shown in this diagram.",
                                "uri": "https://github.com/Azure/avdaccelerator/blob/main/workload/docs/diagrams/avd-accelerator-resource-organization-naming.png",
                                "style": "Info"
                            }
                        },
                        {
                            "name": "resourceNamingSelection",
                            "type": "Microsoft.Common.CheckBox",
                            "visible": true,
                            "label": "Custom resource naming",
                            "defaultValue": false,
                            "toolTip": "When selected, the information provided will be used to name resources. When set to 'No' deployment will use the Azure Virtual Desktop LZA naming standard."
                        },
                        {
                            "name": "resourceNamingWarning",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": "[steps('resourceNaming').resourceNamingSelection]",
                            "options": {
                                "text": "When using custom naming for resources, please make sure to follow naming rules and restrictions for Azure resources.",
                                "uri": "https://docs.microsoft.com/azure/azure-resource-manager/management/resource-name-rules",
                                "style": "Warning"
                            }
                        },
                        {
                            "name": "resourceNamingAvdManagementPlane",
                            "type": "Microsoft.Common.Section",
                            "label": "Azure Virtual Desktop Management plane naming:",
                            "visible": "[steps('resourceNaming').resourceNamingSelection]",
                            "elements": [
                                {
                                    "name": "serviceObjectsRgCustomName",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Resource group",
                                    "toolTip": "Azure Virtual Desktop management plane resources (Workspace, Host pool, Application groups, Key vault) resource group custom name.",
                                    "placeholder": "Example: rg-avd-app1-dev-use2-service-objects",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,90}$",
                                        "validationMessage": "Value must be 1-90 characters."
                                    }
                                },
                                {
                                    "name": "workSpaceCustomName",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Workspace",
                                    "toolTip": "Workspace custom name.",
                                    "placeholder": "Example: vdws-app1-dev-use2-001",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,64}$",
                                        "validationMessage": "Value must be 1-64 characters."
                                    }
                                },
                                {
                                    "name": "workSpaceCustomFriendlyName",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Workspace (Friendly name)",
                                    "toolTip": "Workspace custom friendly name.",
                                    "placeholder": "Example: App1 - Dev - East US 2 - 001",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,64}$",
                                        "validationMessage": "Value must be 1-64 characters."
                                    }
                                },
                                {
                                    "name": "hostPoolCustomName",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Host pool",
                                    "toolTip": "Host pool custom name.",
                                    "placeholder": "Example: vdpool-app1-dev-use2-001",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,64}$",
                                        "validationMessage": "Value must be 1-64 characters."
                                    }
                                },
                                {
                                    "name": "hostPoolCustomFriendlyName",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Host pool (Friendly name)",
                                    "toolTip": "Host pool custom friendly name.",
                                    "placeholder": "Example: App1 - Dev - East US 2 - 001",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,64}$",
                                        "validationMessage": "Value must be 1-64 characters."
                                    }
                                },
                                {
                                    "name": "scalingPlanCustomName",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Scaling Plan",
                                    "toolTip": "Host pool scaling plan.",
                                    "placeholder": "Example: vdscaling-app1-dev-use2-001",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,64}$",
                                        "validationMessage": "Value must be 1-64 characters."
                                    }
                                },
                                {
                                    "name": "applicationGroupCustomName",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Application group",
                                    "toolTip": "Application group custom name.",
                                    "placeholder": "Example: vdag-desktop-app1-dev-use2-001",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,64}$",
                                        "validationMessage": "Value must be 1-64 characters."
                                    }
                                },
                                {
                                    "name": "applicationGroupCustomFriendlyName",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Application group (Friendly name)",
                                    "toolTip": "Desktop application group custom name.",
                                    "placeholder": "Example: Desktops - App1 - Dev - East US 2 - 001",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,64}$",
                                        "validationMessage": "Value must be 1-64 characters."
                                    }
                                },
                                {
                                    "name": "workloadKvCustomName",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Key vault prefix",
                                    "toolTip": "Key vault prefix custom name.",
                                    "placeholder": "Example: kv-sec",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,6}$",
                                        "validationMessage": "Value must be 1-6 characters."
                                    }
                                }
                            ]
                        },
                        {
                            "name": "resourceNamingCompute",
                            "type": "Microsoft.Common.Section",
                            "label": "Compute naming:",
                            "visible": "[steps('resourceNaming').resourceNamingSelection]",
                            "elements": [
                                {
                                    "name": "computeObjectsRgCustomName",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Resource group",
                                    "toolTip": "Azure Virtual Desktop compute resources (VMs, NICs, Disks, Availability sets) resource group custom name.",
                                    "placeholder": "Example: rg-avd-app1-dev-use2-pool-compute",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,90}$",
                                        "validationMessage": "Value must be 1-90 characters."
                                    }
                                },
                                {
                                    "name": "applicationSecurityGroupCustomName",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Applications security group",
                                    "toolTip": "Azure Virtual Desktop application security custom name.",
                                    "placeholder": "Example: asg-app1-dev-use2-001",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,80}$",
                                        "validationMessage": "Value must be 1-80 characters."
                                    }
                                },
                                {
                                    "name": "sessionHostCustomNamePrefix",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Session host prefix",
                                    "visible": "[steps('sessionHosts').deploySessionHosts]",
                                    "toolTip": "Azure Virtual Desktop session host prefix custom name.",
                                    "placeholder": "Example: vmapp1deus2",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,11}$",
                                        "validationMessage": "Value must be 1-11 characters."
                                    }
                                },
                                {
                                    "name": "availabilitySetCustomNamePrefix",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Availability set prefix",
                                    "visible": "[not(steps('sessionHosts').sessionHostsRegionSection.sessionHostsAvailabilitySettings)]",
                                    "toolTip": "Azure Virtual Desktop availability set custom name.",
                                    "placeholder": "Example: avail",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,9}$",
                                        "validationMessage": "Value must be 1-9 characters."
                                    }
                                }
                            ]
                        },
                        {
                            "name": "resourceNamingStorage",
                            "type": "Microsoft.Common.Section",
                            "label": "Storage naming:",
                            "visible": "[steps('resourceNaming').resourceNamingSelection]",
                            "elements": [
                                {
                                    "name": "resourceNamingStorageInfo1",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": "[not(steps('storage').storageFslogix.fslogixDeployment)]",
                                    "options": {
                                        "text": "Current deployment configuration is not creating storage resources for FSLogix.",
                                        "style": "Info"
                                    }
                                },
                                {
                                    "name": "resourceNamingStorageInfo2",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": "[not(steps('storage').storageMsix.msixDeployment)]",
                                    "options": {
                                        "text": "Current deployment configuration is not creating storage resources for MSIX App Attach.",
                                        "style": "Info"
                                    }
                                },
                                {
                                    "name": "resourceNamingStorageInfo3",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": "[not(steps('sessionHosts').deploySessionHosts)]",
                                    "options": {
                                        "text": "Current deployment configuration is not creating storage resources.",
                                        "style": "Info"
                                    }
                                },
                                {
                                    "name": "storageObjectsRgCustomName",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Resource group",
                                    "visible": "[or(equals(steps('storage').storageFslogix.fslogixDeployment, true), equals(steps('storage').storageMsix.msixDeployment, true))]",
                                    "toolTip": "Azure Virtual Desktop storage resources (Storage account, file shares, files private endpoints, temporary domain join VM) resource group custom name.",
                                    "placeholder": "Example: rg-avd-app1-dev-use2-storage",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,90}$",
                                        "validationMessage": "Value must be 1-90 characters."
                                    }
                                },
                                {
                                    "name": "storageAccountPrefixCustomName",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Storage account prefix",
                                    "visible": "[or(equals(steps('storage').storageFslogix.fslogixDeployment, true), equals(steps('storage').storageMsix.msixDeployment, true))]",
                                    "toolTip": "Azure Virtual Desktop storage account prefix custom name.",
                                    "placeholder": "Example: st",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,2}$",
                                        "validationMessage": "Value must be 1-2 characters."
                                    }
                                },
                                {
                                    "name": "fslogixFileShareCustomName",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "FSLogix Profile container file share",
                                    "visible": "[steps('storage').storageFslogix.fslogixDeployment]",
                                    "toolTip": "Azure Virtual Desktop fslogix storage account profile container file share prefix custom name.",
                                    "placeholder": "Example: fslogix-pc-app1-dev-use2-001",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,64}$",
                                        "validationMessage": "Value must be 1-64 characters."
                                    }
                                },
                                {
                                    "name": "msixFileShareCustomName",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "MSIX App Attach container file share",
                                    "visible": "[steps('storage').storageMsix.msixDeployment]",
                                    "toolTip": "Azure Virtual Desktop MSIX App Attach storage account container file share prefix custom name.",
                                    "placeholder": "Example: msix-app1-dev-use2-001",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,64}$",
                                        "validationMessage": "Value must be 1-64 characters."
                                    }
                                }
                            ]
                        },
                        {
                            "name": "resourceNamingNetwork",
                            "type": "Microsoft.Common.Section",
                            "label": "Network naming:",
                            "visible": "[steps('resourceNaming').resourceNamingSelection]",
                            "elements": [
                                {
                                    "name": "resourceNamingNetworkInfo",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": "[not(steps('network').createAvdVirtualNetwork)]",
                                    "options": {
                                        "text": "Current deployment configuration is not creating network resources.",
                                        "style": "Info"
                                    }
                                },
                                {
                                    "name": "networkObjectsRgCustomName",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Resource group",
                                    "visible": "[steps('network').createAvdVirtualNetwork]",
                                    "toolTip": "Azure Virtual Desktop network resources (vNet, NSG, Route table) resource group custom name.",
                                    "placeholder": "Example: rg-avd-app1-dev-use2-network",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,90}$",
                                        "validationMessage": "Value must be 1-90 characters."
                                    }
                                },
                                {
                                    "name": "virtualNetworkCustomName",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Virtual network",
                                    "visible": "[steps('network').createAvdVirtualNetwork]",
                                    "toolTip": "Azure Virtual Desktop virtual network custom name.",
                                    "placeholder": "Example: vnet-app1-dev-use2-001",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,64}$",
                                        "validationMessage": "Value must be 1-64 characters."
                                    }
                                },
                                {
                                    "name": "virtualNetworkAvdSubnetCustomName",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Azure Virtual Desktop Subnet",
                                    "visible": "[steps('network').createAvdVirtualNetwork]",
                                    "toolTip": "Azure Virtual Desktop virtual network subnet custom name.",
                                    "placeholder": "Example: snet-avd-app1-dev-use2-001",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,80}$",
                                        "validationMessage": "Value must be 1-80 characters."
                                    }
                                },
                                {
                                    "name": "avdNetworkSecurityGroupCustomName",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Azure Virtual Desktop Network security group",
                                    "visible": "[steps('network').createAvdVirtualNetwork]",
                                    "toolTip": "Azure Virtual Desktop network security group custom name.",
                                    "placeholder": "Example: nsg-avd-app1-dev-use2-001",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,80}$",
                                        "validationMessage": "Value must be 1-80 characters."
                                    }
                                },
                                {
                                    "name": "avdRouteTableCustomName",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Azure Virtual Desktop Route table",
                                    "visible": "[steps('network').createAvdVirtualNetwork]",
                                    "toolTip": "Azure Virtual Desktop route table custom name.",
                                    "placeholder": "Example: route-avd-app1-dev-use2-001",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,80}$",
                                        "validationMessage": "Value must be 1-80 characters."
                                    }
                                },
                                {
                                    "name": "virtualNetworkPrivateEndpointSubnetCustomName",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Private endpoint subnet",
                                    "visible": "[steps('network').createAvdVirtualNetwork]",
                                    "toolTip": "Azure Virtual Desktop virtual network subnet custom name.",
                                    "placeholder": "Example: snet-pe-app1-dev-use2-001",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,80}$",
                                        "validationMessage": "Value must be 1-80 characters."
                                    }
                                },
                                {
                                    "name": "privateEndpointNetworkSecurityGroupCustomName",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Private endpoint network security group",
                                    "visible": "[steps('network').createAvdVirtualNetwork]",
                                    "toolTip": "Private endpoint network security group custom name.",
                                    "placeholder": "Example: nsg-pe-app1-dev-use2-001",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,80}$",
                                        "validationMessage": "Value must be 1-80 characters."
                                    }
                                },
                                {
                                    "name": "privateEndpointRouteTableCustomName",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Private endpoint route table",
                                    "visible": "[steps('network').createAvdVirtualNetwork]",
                                    "toolTip": "Private endpoint route table custom name.",
                                    "placeholder": "Example: route-pe-app1-dev-use2-001",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,80}$",
                                        "validationMessage": "Value must be 1-80 characters."
                                    }
                                }
                            ]
                        },
                        {
                            "name": "resourceNamingMonitoring",
                            "type": "Microsoft.Common.Section",
                            "visible": "[steps('resourceNaming').resourceNamingSelection]",
                            "label": "Monitoring naming:",
                            "elements": [
                                {
                                    "name": "resourceNamingMonitoringInfo",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": "[not(steps('monitoring').deployMonitoring)]",
                                    "options": {
                                        "text": "Current deployment configuration is not creating monitoring resources.",
                                        "style": "Info"
                                    }
                                },
                                {
                                    "name": "monitoringObjectsRgCustomName",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Resource group",
                                    "visible": "[and(equals(steps('resourceNaming').resourceNamingSelection, true), equals(steps('monitoring').deployMonitoring, true))]",
                                    "toolTip": "Azure Virtual Desktop monitoring resources (log analytics workspace) resource group custom name.",
                                    "placeholder": "Example: rg-avd-dev-use2-monitoring",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,90}$",
                                        "validationMessage": "Value must be 1-90 characters."
                                    }
                                },
                                {
                                    "name": "monitoringLogAnalyticsWorkspaceName",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Log analytics workspace name",
                                    "visible": "[and(equals(steps('resourceNaming').resourceNamingSelection, true), equals(steps('monitoring').deployMonitoring, true), equals(steps('monitoring').deployMonitoringAlaWorkspace, true))]",
                                    "toolTip": "Azure Virtual Desktop monitoring log analytics workspace custom name.",
                                    "placeholder": "Example: log-avd-dev-use2",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,90}$",
                                        "validationMessage": "Value must be 1-90 characters."
                                    }
                                }
                            ]
                        },
                        {
                            "name": "resourceNamingZeroTrust",
                            "type": "Microsoft.Common.Section",
                            "label": "Zero Trust naming:",
                            "visible": "[steps('resourceNaming').resourceNamingSelection]",
                            "elements": [
                                {
                                    "name": "resourceNamingZeroTrustInfo",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": "[not(steps('sessionHosts').sessionHostsSettingsSection.sessionHostDiskZeroTrust)]",
                                    "options": {
                                        "text": "Current deployment configuration is not creating zero trust resources.",
                                        "style": "Info"
                                    }
                                },
                                {
                                    "name": "zeroTrustObjectsDiskEncryptionSetCustomName",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Disk encryption set",
                                    "visible": "[and(steps('resourceNaming').resourceNamingSelection, steps('sessionHosts').sessionHostsSettingsSection.sessionHostDiskZeroTrust)]",
                                    "toolTip": "Disk encryption set resource for double encryption of session host disks.",
                                    "placeholder": "Example: des-zt",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,6}$",
                                        "validationMessage": "Value must be 1-90 characters."
                                    }
                                },
                                {
                                    "name": "zeroTrustObjectsKeyVaultCustomPrefix",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Key vault prefix",
                                    "visible": "[and(steps('resourceNaming').resourceNamingSelection, steps('sessionHosts').sessionHostsSettingsSection.sessionHostDiskZeroTrust)]",
                                    "toolTip": "Key Vault that stores the encryption key for disk encryption.",
                                    "placeholder": "Example: kv-key",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,6}$",
                                        "validationMessage": "Value must be 1-90 characters."
                                    }
                                },
                                {
                                    "name": "zeroTrustObjectsManagedIdentityCustomName",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "User assigned identity",
                                    "visible": "[and(steps('resourceNaming').resourceNamingSelection, steps('sessionHosts').sessionHostsSettingsSection.sessionHostDiskZeroTrust)]",
                                    "toolTip": "User assigned identity that enables server-side encryption and disables network access.",
                                    "placeholder": "Example: id-zt",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,5}$",
                                        "validationMessage": "Value must be 1-90 characters."
                                    }
                                }
                            ]
                        },
                        {
                            "name": "resourceNamingInfo2",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": "[steps('resourceNaming').resourceNamingSelection]",
                            "options": {
                                "text": "It is recommended to follow Microsoft Cloud Adoption Framework (CAF) naming convention.",
                                "uri": "https://docs.microsoft.com/azure/cloud-adoption-framework/ready/azure-best-practices/resource-naming",
                                "style": "Info"
                            }
                        }
                    ]
                },
                {
                    "name": "resourceTagging",
                    "label": "Resource tagging",
                    "type": "Microsoft.Common.Section",
                    "visible": true,
                    "elements": [
                        {
                            "name": "resourceTaggingSelection",
                            "type": "Microsoft.Common.CheckBox",
                            "visible": true,
                            "label": "Create resource tags",
                            "defaultValue": false,
                            "toolTip": "When selected, the information provided will be used to create tags on resources and resource groups."
                        },
                        {
                            "name": "resourceTaggingParentCostInfo",
                            "type": "Microsoft.Common.InfoBox",
                            "options": {
                                "text": "By default, the following tags will be created: <br/> - Parent resource cost management tag (cm-resource-parent): reports all resources cost to the host pool (ResourceID). <br/> - Environment (Environment): environment selected during deployment (Dev/Test/prod). <br/> - Service Workload (ServiceWorkload): defaults to Azure Virtual Desktop. <br/> - Creation time (CreationTimeUTC): deployment time in UTC. <br/> - Domain Name (DomainName): identity service domain name (applied only to compute and storage). <br/> - Identity service provider (IdentityServiceProvider): identity provider selected (ADDS/AADDS/AAD).",
                                "uri": "https://learn.microsoft.com/azure/virtual-desktop/tag-virtual-desktop-resources#use-the-cm-resource-parent-tag-to-automatically-group-costs-by-host-pool",
                                "style": "Info"
                            }
                        },
                        {
                            "name": "resourceTags",
                            "type": "Microsoft.Common.Section",
                            "label": "Resources tags:",
                            "visible": "[steps('resourceTagging').resourceTaggingSelection]",
                            "elements": [
                                {
                                    "name": "tagsWorkloadName",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Workload name:",
                                    "toolTip": "This input will be the value of a tag named WorkloadName.",
                                    "placeholder": "Example: Contoso-Workload",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,256}$",
                                        "validationMessage": "Value must be 1-256 characters."
                                    }
                                },
                                {
                                    "name": "tagsWorkloadType",
                                    "type": "Microsoft.Common.DropDown",
                                    "label": "Workload type:",
                                    "filter": true,
                                    "defaultValue": "Light",
                                    "toolTip": "This input will be the value of a tag named WorkloadType, reference to the size of the VM for your workloads.",
                                    "constraints": {
                                        "required": true,
                                        "allowedValues": [
                                            {
                                                "label": "Light",
                                                "description": "",
                                                "value": "Light"
                                            },
                                            {
                                                "label": "Medium",
                                                "description": "",
                                                "value": "Medium"
                                            },
                                            {
                                                "label": "High",
                                                "description": "",
                                                "value": "High"
                                            },
                                            {
                                                "label": "Power",
                                                "description": "",
                                                "value": "POwer"
                                            }
                                        ]
                                    }
                                },
                                {
                                    "name": "tagsDataClassificationTag",
                                    "type": "Microsoft.Common.DropDown",
                                    "label": "Data classification:",
                                    "filter": true,
                                    "defaultValue": "Non-business",
                                    "toolTip": "This input will be the value of a tag named DataClassification, reference to the sensitivity of data hosted.",
                                    "constraints": {
                                        "required": true,
                                        "allowedValues": [
                                            {
                                                "label": "Non-business",
                                                "description": "",
                                                "value": "Non-business"
                                            },
                                            {
                                                "label": "Public",
                                                "description": "",
                                                "value": "Public"
                                            },
                                            {
                                                "label": "General",
                                                "description": "",
                                                "value": "General"
                                            },
                                            {
                                                "label": "Confidential",
                                                "description": "",
                                                "value": "Confidential"
                                            },
                                            {
                                                "label": "Highly-confidential",
                                                "description": "",
                                                "value": "Highly-confidential"
                                            }
                                        ]
                                    }
                                },
                                {
                                    "name": "tagsDepartmentTag",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Department:",
                                    "toolTip": "This input will be the value of a tag named Department, reference the department that owns the deployment.",
                                    "placeholder": "Example: Contoso-AVD",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,256}$",
                                        "validationMessage": "Value must be 1-256 characters."
                                    }
                                },
                                {
                                    "name": "tagsCriticalityTag",
                                    "type": "Microsoft.Common.DropDown",
                                    "label": "Workload criticality:",
                                    "filter": true,
                                    "defaultValue": "Low",
                                    "toolTip": "This input will be the value of a tag named Criticality, reference to the criticality of the workload.",
                                    "constraints": {
                                        "required": true,
                                        "allowedValues": [
                                            {
                                                "label": "Low",
                                                "description": "",
                                                "value": "Low"
                                            },
                                            {
                                                "label": "Medium",
                                                "description": "",
                                                "value": "Medium"
                                            },
                                            {
                                                "label": "High",
                                                "description": "",
                                                "value": "High"
                                            },
                                            {
                                                "label": "Missin-critical",
                                                "description": "",
                                                "value": "Missin-critical"
                                            },
                                            {
                                                "label": "Custom",
                                                "description": "",
                                                "value": "Custom"
                                            }
                                        ]
                                    }
                                },
                                {
                                    "name": "tagsCustomWorkloadCriticality",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Custom workload criticality:",
                                    "visible": "[equals(steps('resourceTagging').resourceTags.tagsCriticalityTag, 'Custom')]",
                                    "toolTip": "This input will be the value of a tag named Criticality, reference to a custom criticality for the workload.",
                                    "placeholder": "Example: Contoso-Criticality",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,256}$",
                                        "validationMessage": "Value must be 1-256 characters."
                                    }
                                },
                                {
                                    "name": "tagsApplicationNameTag",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Application name:",
                                    "toolTip": "This input will be the value of a tag named ApplicationName, reference details about the application.",
                                    "placeholder": "Example: Contoso-App",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,256}$",
                                        "validationMessage": "Value must be 1-256 characters."
                                    }
                                },
                                {
                                    "name": "tagsWorkloadSlaTag",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Workload SLA:",
                                    "toolTip": "This input will be the value of a tag named ServiceClass, reference to the service level agreement level of the worload.",
                                    "placeholder": "Example: Contoso-SLA",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,256}$",
                                        "validationMessage": "Value must be 1-256 characters."
                                    }
                                },
                                {
                                    "name": "tagsOpsTeamTag",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Operations team:",
                                    "toolTip": "This input will be the value of a tag named OpsTeam, reference to the team accountable for day-to-day operations.",
                                    "placeholder": "Example: workload-admins@Contoso.com",
                                    "constraints": {
                                        "required": true
                                    }
                                },
                                {
                                    "name": "tagsOwnerTag",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Owner:",
                                    "toolTip": "This input will be the value of a tag named Owner, reference to the organizational owner of the Azure Virtual Desktop deployment.",
                                    "placeholder": "Example: workload-owner@Contoso.com",
                                    "constraints": {
                                        "required": true
                                    }
                                },
                                {
                                    "name": "tagsCostCenterTag",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Cost center:",
                                    "toolTip": "This input will be the value of a tag named CostCenter, reference to the cost center of owner team.",
                                    "placeholder": "Example: Contoso-CC",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,256}$",
                                        "validationMessage": "Value must be 1-256 characters."
                                    }
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        "outputs": {
            "parameters": {},
            "kind": "Subscription",
            "location": "[steps('basics').resourceScope.location.name]",
            "subscriptionId": "[steps('basics').resourceScope.subscription.id]"
        }
    }
}