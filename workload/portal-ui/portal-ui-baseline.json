{
    "$schema": "<relative path to createFormUI.schema.json>",
    "view": {
        "kind": "Form",
        "properties": {
            "isWizard": false,
            "title": "Azure Virtual Desktop - Landing Zone Accelerator (LZA) - Baseline",
            "steps": [
                {
                    "name": "basics",
                    "label": "Deployment Basics",
                    "elements": [
                        {
                            "name": "subscriptionsApi",
                            "type": "Microsoft.Solutions.ArmApiControl",
                            "request": {
                                "method": "GET",
                                "path": "subscriptions?api-version=2022-01-01"
                            }
                        },
                        {
                            "name": "infoPreReq",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": true,
                            "options": {
                                "text": "PREREQUISITES REQUIRED \n\nThere are prerequisites that must be setup in your Azure environment to successfully deploy this Azure Virtual Desktop Landing Zone Accelerator. Click here to review the prerequisites in the Getting Started guide.",
                                "uri": "https://github.com/Azure/avdaccelerator/blob/main/workload/docs/getting-started-baseline.md",
                                "style": "Warning"
                            }
                        },
                        {
                            "name": "infoPreReqCheckbox",
                            "type": "Microsoft.Common.CheckBox",
                            "visible": true,
                            "label": "I have read and understand the Azure Virtual Desktop LZA deployment pre-requisites",
                            "defaultValue": false,
                            "toolTip": "I have read and understand the Azure Virtual Desktop LZA deployment pre-requisites.",
                            "constraints": {
                                "required": true
                            }
                        },
                        {
                            "name": "deploymentInfo",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": true,
                            "options": {
                                "style": "Info",
                                "text": "The subscription selected in the 'Project details' section below will be used to deploy all resources. \n\nThe region selected in 'Instance details' section below will be used to deploy the Azure Virtual Desktop management plane resources (workspace, host pool, and application group, etc.). These resource types are not available in all regions, but they are globally replicated.\n\nThe session hosts do not have to be deployed to the same region, therefore you will have the option to select that region on the 'Session Hosts' blade.",
                                "uri": "https://docs.microsoft.com/azure/virtual-desktop/data-locations"
                            }
                        },
                        {
                            "name": "resourceScope",
                            "type": "Microsoft.Common.ResourceScope",
                            "location": {
                                "resourceTypes": [
                                    "Microsoft.DesktopVirtualization/workspaces"
                                ]
                            }
                        },
                        {
                            "name": "infoResourceGroupNaming",
                            "type": "Microsoft.Common.TextBlock",
                            "visible": true,
                            "options": {
                                "text": "Azure Virtual Desktop Landing Zones will create the resource group hierarchy under the subscriptions with the prefix provided in this step.",
                                "link": {
                                    "label": "Learn more",
                                    "uri": "https://docs.microsoft.com/azure/cloud-adoption-framework/ready/enterprise-scale/management-group-and-subscription-organization"
                                }
                            }
                        },
                        {
                            "name": "deploymentSpecs",
                            "type": "Microsoft.Common.Section",
                            "visible": true,
                            "label": "Deployment Specs",
                            "elements": [
                                {
                                    "name": "deploymentPrefix",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Prefix",
                                    "toolTip": "Provide a prefix (max 4 characters) for the resource groups and resources created as part of Azure Virtual Desktop landing zones.",
                                    "placeholder": "Example: app1",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,4}$",
                                        "validationMessage": "The prefix must be 1-4 characters."
                                    }
                                },
                                {
                                    "name": "deploymentEnvironment",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": true,
                                    "label": "Environment",
                                    "defaultValue": "Development",
                                    "toolTip": "Select the type of environment (Development (d), Test (t), Production (p)) that will be deployed, this information will be use as part of the resources naming.",
                                    "constraints": {
                                        "allowedValues": [
                                            {
                                                "label": "Development",
                                                "value": "Dev"
                                            },
                                            {
                                                "label": "Test",
                                                "value": "Test"
                                            },
                                            {
                                                "label": "Production",
                                                "value": "Prod"
                                            }
                                        ]
                                    }
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "identity",
                    "label": "Identity",
                    "elements": [
                        {
                            "name": "identityInfo",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": true,
                            "options": {
                                "text": "Azure Virtual Desktop LZA deployment expects identity service to be already available in the current Azure estate.",
                                "uri": "https://docs.microsoft.com/azure/virtual-desktop/authentication#identities",
                                "style": "Info"
                            }
                        },
                        {
                            "name": "identityDomainInformation",
                            "type": "Microsoft.Common.Section",
                            "visible": true,
                            "label": "Domain to join",
                            "elements": [
                                {
                                    "name": "identityServiceProvider",
                                    "type": "Microsoft.Common.OptionsGroup",
                                    "visible": true,
                                    "label": "Identity service provider",
                                    "defaultValue": "Active Directory (AD DS)",
                                    "toolTip": "Identity service provider (ADDS or EntraDS) that already exist and will be used for Azure Virtual Desktop.",
                                    "constraints": {
                                        "required": true,
                                        "allowedValues": [
                                            {
                                                "label": "Microsoft Entra ID",
                                                "value": "EntraID"
                                            },
                                            {
                                                "label": "Active Directory (AD DS)",
                                                "value": "ADDS"
                                            },
                                            {
                                                "label": "Microsoft Entra Domain Services",
                                                "value": "EntraDS"
                                            }
                                        ]
                                    }
                                },
                                {
                                    "name": "identityServiceProviderIntuneEnrollment",
                                    "type": "Microsoft.Common.CheckBox",
                                    "visible": "[equals(steps('identity').identityDomainInformation.identityServiceProvider, 'EntraID')]",
                                    "label": "Intune enrollment",
                                    "defaultValue": false,
                                    "toolTip": "If Intune is configured in your Microsoft Entra ID tenant, you can choose to have the VM automatically enrolled during the deployment by selecting this box."
                                },
                                {
                                    "name": "identityServiceProviderInfo",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": "[not(equals(steps('identity').identityDomainInformation.identityServiceProvider, 'EntraID'))]",
                                    "options": {
                                        "text": "Identity service provider must already exist, as it is a prerequisite for the Azure Virtual Desktop LZA deployment.",
                                        "uri": "https://github.com/Azure/avdaccelerator/blob/main/workload/docs/getting-started.md",
                                        "style": "Info"
                                    }
                                },
                                {
                                    "name": "identityDomainName",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Domain name",
                                    "visible": true,
                                    "toolTip": "The full qualified domain name of the on-premises domain where the hybrid identities originated from. This requirement also applies to Entra ID + FSLogix deployments, because identities need to be hybrid for storage authenctication to be supported.",
                                    "placeholder": "Example: contoso.com",
                                    "constraints": {
                                        "required": "[if(not(equals(steps('identity').identityDomainInformation.identityServiceProvider, 'EntraID')), true, false)]"
                                    }
                                },
                                {
                                    "name": "identityDomainGuid",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Domain GUID",
                                    "visible": "[equals(steps('identity').identityDomainInformation.identityServiceProvider, 'EntraID')]",
                                    "toolTip": "GUID for the on-premises domain controller.",
                                    "placeholder": "Example: A1B2C3D4-E5F6-7890-1234-56789ABCDEF0",
                                    "constraints": {
                                        "required": false
                                    }
                                },
                                {
                                    "name": "identityDomainEntraIdInfoBox",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": "[equals(steps('identity').identityDomainInformation.identityServiceProvider, 'EntraID')]",
                                    "options": {
                                        "text": "EntraID + FSLogix: to configure directory and file level permissions through Windows File explorer, you also need to specify domain name and domain GUID for your on-premises AD. You can get this information from your domain admin or from an on-premises AD-joined client. If you prefer to configure using icacls, this information is not required.",
                                        "uri": "https://learn.microsoft.com/en-us/azure/storage/files/storage-files-identity-auth-hybrid-identities-enable?tabs=azure-portal%2Cintune#configure-directory-and-file-level-permissions",
                                        "style": "Info"
                                    }
                                }
                            ]
                        },
                        {
                            "name": "identityAvdAccess",
                            "type": "Microsoft.Common.Section",
                            "visible": true,
                            "label": "Azure Virtual Desktop access assignment",
                            "elements": [
                                {
                                    "name": "groupsApi",
                                    "type": "Microsoft.Solutions.GraphApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "/v1.0/groups?$top=999"
                                    }
                                },
                                {
                                    "name": "identityAvdUserAccessGroupDropDown",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": "[not(steps('identity').identityAvdAccess.identityAvdUserAccessGroupCheckBox)]",
                                    "label": "Groups",
                                    "defaultValue": "",
                                    "filter": true,
                                    "toolTip": "Select the desired group to give access to Azure Virtual Desktop resources and if applicable to FSLogix file share",
                                    "multiselect": false,
                                    "constraints": {
                                        "allowedValues": "[map(steps('identity').identityAvdAccess.groupsApi.value, (item) => parse(concat('{\"label\":\"', item.displayName, '\",\"value\": {\"name\":\"', item.displayName, '\",\"id\":\"', item.id, '\"}}')))]"
                                    }
                                },
                                {
                                    "name": "identityAvdUserAccessGroupCheckBox",
                                    "type": "Microsoft.Common.CheckBox",
                                    "visible": true,
                                    "label": "Provide group details",
                                    "defaultValue": false,
                                    "toolTip": "When the desired group is not listed in the drop down, selecting this box will allow for entering the group's ObjectID and name. this information will be used to setup AVD access and FSLogix's file share NTFS permissions."
                                },
                                {
                                    "name": "identityAvdUserAccessGroupTextBox1",
                                    "type": "Microsoft.Common.TextBox",
                                    "visible": "[steps('identity').identityAvdAccess.identityAvdUserAccessGroupCheckBox]",
                                    "label": "Name",
                                    "toolTip": "Group name to be granted access to Azure Virtual Desktop published items and FSLogix NTFS permissions.",
                                    "placeholder": "Example: AVD-users"
                                },
                                {
                                    "name": "identityAvdUserAccessGroupTextBox2",
                                    "type": "Microsoft.Common.TextBox",
                                    "visible": "[steps('identity').identityAvdAccess.identityAvdUserAccessGroupCheckBox]",
                                    "label": "Object ID",
                                    "toolTip": "Group objectID to be granted access to Azure Virtual Desktop published items and FSLogix NTFS permissions.",
                                    "placeholder": "Example: XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX"
                                }
                            ]
                        },
                        {
                            "name": "identityDomainCredentials",
                            "type": "Microsoft.Common.Section",
                            "visible": "[not(equals(steps('identity').identityDomainInformation.identityServiceProvider, 'EntraID'))]",
                            "label": "Domain join credentials",
                            "elements": [
                                {
                                    "name": "identityDomainJoinUserName",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "User principal name",
                                    "toolTip": "Provide username with permissions to join session host to the domain.",
                                    "placeholder": "Example: 'avdadmin@contoso.com'",
                                    "defaultValue": "",
                                    "constraints": {
                                        "required": true
                                    }
                                },
                                {
                                    "name": "identityDomainJoinUserPassword",
                                    "type": "Microsoft.Common.PasswordBox",
                                    "label": {
                                        "password": "Password"
                                    },
                                    "toolTip": "Provide password for domain join account.",
                                    "constraints": {
                                        "required": true
                                    },
                                    "options": {
                                        "hideConfirmation": true
                                    }
                                }
                            ]
                        },
                        {
                            "name": "identityLocalCredentials",
                            "type": "Microsoft.Common.Section",
                            "visible": true,
                            "label": "Session host local admin credentials",
                            "elements": [
                                {
                                    "name": "identityLocalUserName",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Username",
                                    "toolTip": "Provide username for session host local admin account. Administrator can't be used as username, it is reserved by the system.",
                                    "placeholder": "Example: 'localadmin'",
                                    "defaultValue": "",
                                    "constraints": {
                                        "regex": "^(?!.*[aA]dministrator).*$",
                                        "validationMessage": "This username can't be used, it is a reserved word.",
                                        "required": true
                                    }
                                },
                                {
                                    "name": "identityLocalUserPassword",
                                    "type": "Microsoft.Compute.CredentialsCombo",
                                    "visible": true,
                                    "label": {
                                        "password": "Password",
                                        "confirmPassword": "Confirm password"
                                    },
                                    "toolTip": {
                                        "password": "The password must be alphanumeric, contain at least 12 characters, have at least 1 letter,1 number and 1 special character."
                                    },
                                    "constraints": {
                                        "required": true
                                    },
                                    "options": {
                                        "hideConfirmation": false
                                    },
                                    "osPlatform": "Windows"
                                }
                            ]
                        },
                        {
                            "name": "identiyEnableDefOptions",
                            "type": "Microsoft.Common.Section",
                            "visible": true,
                            "label": "Microsoft Defender for Cloud solutions you will enable.",
                            "elements": [
                                {
                                    "name": "enableDef",
                                    "type": "Microsoft.Common.CheckBox",
                                    "label": "Deploy Microsoft Defender for Cloud and enable security monitoring for your platform and resources",
                                    "defaultValue": false,
                                    "toolTip": "Selecting 'Yes' will enable the options to configure individual Microsoft Defender for Cloud components"
                                },
                                {
                                    "name": "enableDefForServers",
                                    "type": "Microsoft.Common.CheckBox",
                                    "label": "Enable Microsoft Defender for Servers",
                                    "defaultValue": true,
                                    "toolTip": "If 'Yes' is selected, Microsoft Defender for Cloud will be enabled for all servers.",
                                    "visible": "[steps('identity').identiyEnableDefOptions.enableDef]"
                                },
                                {
                                    "name": "enableDefForStorage",
                                    "type": "Microsoft.Common.CheckBox",
                                    "label": "Enable Microsoft Defender for Storage",
                                    "defaultValue": true,
                                    "toolTip": "If 'Yes' is selected, Microsoft Defender for Cloud will be enabled for Storage.",
                                    "visible": "[steps('identity').identiyEnableDefOptions.enableDef]"
                                },
                                {
                                    "name": "enableDefForKeyVault",
                                    "type": "Microsoft.Common.CheckBox",
                                    "label": "Enable Microsoft Defender for Key Vault",
                                    "defaultValue": true,
                                    "toolTip": "If 'Yes' is selected, Microsoft Defender for Cloud will be enabled for Key Vault",
                                    "visible": "[steps('identity').identiyEnableDefOptions.enableDef]"
                                },
                                {
                                    "name": "enableDefForArm",
                                    "type": "Microsoft.Common.CheckBox",
                                    "label": "Enable Microsoft Defender for Azure Resource Manager",
                                    "defaultValue": true,
                                    "toolTip": "If 'Yes' is selected, Microsoft Defender for Cloud will be enabled for Resource Manager.",
                                    "visible": "[steps('identity').identiyEnableDefOptions.enableDef]"
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "managementPlane",
                    "label": "Management plane",
                    "elements": [
                        {
                            "name": "managementPlaneHostPoolSettings",
                            "type": "Microsoft.Common.Section",
                            "visible": true,
                            "label": "Host pool settings",
                            "elements": [
                                {
                                    "name": "hostPoolType",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": true,
                                    "label": "Host pool type",
                                    "defaultValue": "Pooled",
                                    "multiLine": true,
                                    "toolTip": "",
                                    "constraints": {
                                        "required": true,
                                        "allowedValues": [
                                            {
                                                "label": "Pooled",
                                                "description": "",
                                                "value": "Pooled"
                                            },
                                            {
                                                "label": "Personal",
                                                "description": "",
                                                "value": "Personal"
                                            }
                                        ]
                                    }
                                },
                                {
                                    "name": "hostPoolWarning",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": true,
                                    "options": {
                                        "icon": "Warning",
                                        "text": "Host pool type can not be changed after deployment.",
                                        "uri": "https://docs.microsoft.com/azure/virtual-desktop/environment-setup"
                                    }
                                },
                                {
                                    "name": "loadBalancerType",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": "[equals(steps('managementPlane').managementPlaneHostPoolSettings.hostPoolType, 'Pooled')]",
                                    "label": "Load balancing algorithm",
                                    "defaultValue": "BreadthFirst",
                                    "multiLine": true,
                                    "toolTip": "Breadth-first load balancing distributes new user sessions across all available session hosts in the host pool. Depth-first load balancing distributes new user sessions to an available session host with the highest number of connections but has not reached its maximum session limit threshold.",
                                    "constraints": {
                                        "required": true,
                                        "allowedValues": [
                                            {
                                                "label": "BreadthFirst",
                                                "description": "Each new user is placed on the next VM. (Performance Optimized)",
                                                "value": "BreadthFirst"
                                            },
                                            {
                                                "label": "DepthFirst",
                                                "description": "Each new user is placed on the same VM until max sessions limit. (Cost Optimized)",
                                                "value": "DepthFirst"
                                            }
                                        ]
                                    }
                                },
                                {
                                    "name": "maxSessions",
                                    "type": "Microsoft.Common.TextBox",
                                    "visible": "[equals(steps('managementPlane').managementPlaneHostPoolSettings.hostPoolType, 'Pooled')]",
                                    "label": "Max session limit",
                                    "defaultValue": "8",
                                    "toolTip": "The maximum number of users that have concurrent sessions on a session host. When setting a host pool to have depth first load balancing or planning to use Autoscaling, you must set an appropriate max session limit according to the configuration of your deployment and capacity of your VMs.",
                                    "constraints": {
                                        "required": false,
                                        "regex": "",
                                        "validationMessage": ""
                                    }
                                },
                                {
                                    "name": "assignmentType",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": "[equals(steps('managementPlane').managementPlaneHostPoolSettings.hostPoolType, 'Personal')]",
                                    "label": "Machine assignment",
                                    "defaultValue": "Automatic (Recommended)",
                                    "multiLine": true,
                                    "toolTip": "Automatic assignment – The service will select an available host and assign it to an user. Direct assignment – Admin selects a specific host to assign to an user.",
                                    "constraints": {
                                        "required": true,
                                        "allowedValues": [
                                            {
                                                "label": "Automatic (Recommended)",
                                                "description": "Users are assigned an available VM the first time they connect.",
                                                "value": "Automatic"
                                            },
                                            {
                                                "label": "Direct",
                                                "description": "An administrator assigns a VM for each individual user.",
                                                "value": "Direct"
                                            }
                                        ]
                                    }
                                }
                            ]
                        },
                        {
                            "name": "managementPlaneAppGroupOptions",
                            "type": "Microsoft.Common.Section",
                            "visible": "[equals(steps('managementPlane').managementPlaneHostPoolSettings.hostPoolType, 'Pooled')]",
                            "label": "",
                            "elements": [
                                {
                                    "name": "preferredAppGroupType",
                                    "type": "Microsoft.Common.OptionsGroup",
                                    "visible": true,
                                    "label": "Preferred app group type",
                                    "defaultValue": "Desktop",
                                    "toolTip": "Select the preferred type of application group for the host pool, the option selected will be used to deploy the default application group of the host pool.",
                                    "constraints": {
                                        "required": true,
                                        "allowedValues": [
                                            {
                                                "label": "Desktop",
                                                "value": "Desktop"
                                            },
                                            {
                                                "label": "Remote App (RAIL)",
                                                "value": "RemoteApp"
                                            }
                                        ]
                                    }
                                }
                            ]
                        },
                        {
                            "name": "managementPlaneHostPoolScaling",
                            "type": "Microsoft.Common.Section",
                            "visible": true,
                            "label": "Session host scaling options",
                            "elements": [
                                {
                                    "name": "scalingPlan",
                                    "type": "Microsoft.Common.CheckBox",
                                    "visible": "[not(contains(steps('basics').resourceScope.location.name, 'china'))]",
                                    "label": "Scaling plan",
                                    "defaultValue": true,
                                    "toolTip": "Will automatically manage session host power state based on usage and schedules (weekdays and weekend schedules will be created)."
                                },
                                {
                                    "name": "startVmOnConnect",
                                    "type": "Microsoft.Common.CheckBox",
                                    "label": "Start VM on connect",
                                    "defaultValue": true,
                                    "toolTip": "If VM is powered off (deallocated), VM will be started automatically once user connects."
                                },
                                {
                                    "name": "avdEnterpriseApplication",
                                    "type": "Microsoft.Solutions.GraphApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "/v1.0/serviceprincipals?$filter=appId eq '9cdead84-a844-4324-93f2-b2e6bb768d07'"
                                    }
                                },
                                {
                                    "name": "startVmOnConnectRoleInfo",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": "[steps('managementPlane').managementPlaneHostPoolScaling.startVmOnConnect]",
                                    "options": {
                                        "text": "Deployment will automatically grant role 'Desktop Virtualization Power On Contributor' to Azure virtual Desktop enterprise application (AppID: 9cdead84-a844-4324-93f2-b2e6bb768d07)",
                                        "uri": "https://learn.microsoft.com/azure/virtual-desktop/start-virtual-machine-connect?tabs=azure-portal",
                                        "style": "Info"
                                    }
                                },
                                {
                                    "name": "scalingPlanRoleInfo",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": "[steps('managementPlane').managementPlaneHostPoolScaling.scalingPlan]",
                                    "options": {
                                        "text": "Deployment will automatically grant role 'Desktop Virtualization Power On Off Contributor' to Azure virtual Desktop enterprise application (AppID: 9cdead84-a844-4324-93f2-b2e6bb768d07)",
                                        "uri": "https://learn.microsoft.com/azure/virtual-desktop/autoscale-scaling-plan",
                                        "style": "Info"
                                    }
                                },
                                {
                                    "name": "scalingPlanInfo",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": "[steps('managementPlane').managementPlaneHostPoolScaling.scalingPlan]",
                                    "options": {
                                        "text": "Session hosts can be excluded from the scaling plan by assigning the tag name exclude-'Scaling-PLan-Name'. When not using custom resource naming, the default exclusion tag name will be exclude-vdscaling-'DeploymentPrefix'-'Environment'-'DeploymentLocation'-001 <br/> - Example: exclude-vdscaling-app1-dev-use2-001",
                                        "uri": "https://docs.microsoft.com/azure/virtual-desktop/autoscale-scenarios#scenario-4-how-do-exclusion-tags-work",
                                        "style": "Info"
                                    }
                                },
                                {
                                    "name": "scalingPlanInfo2",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": "[contains(steps('basics').resourceScope.location.name, 'china')]",
                                    "options": {
                                        "text": "Scaling Plan is NOT SUPPORTED in Azure China Cloud",
                                        "uri": "https://azure.microsoft.com/en-us/explore/global-infrastructure/products-by-region/?products=all&regions=china-non-regional%2Cchina-east%2Cchina-east-2%2Cchina-east-3%2Cchina-north%2Cchina-north-2%2Cchina-north-3&rar=true",
                                        "style": "Warning"
                                    }
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "sessionHosts",
                    "label": "Session hosts",
                    "elements": [
                        {
                            "name": "deploySessionHosts",
                            "type": "Microsoft.Common.CheckBox",
                            "visible": true,
                            "label": "Deploy session hosts",
                            "defaultValue": true,
                            "toolTip": "Create session hosts compute and storage resources."
                        },
                        {
                            "name": "sessionHostsRegionSection",
                            "type": "Microsoft.Common.Section",
                            "visible": "[steps('sessionHosts').deploySessionHosts]",
                            "label": "Region Settings",
                            "tooltip": "The section allows you to specify the region where the compute, storage, and key vault resources are deployed.",
                            "elements": [
                                {
                                    "name": "computeApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "[concat(steps('basics').resourceScope.subscription.id,'/providers/Microsoft.Compute/resourceTypes?api-version=2022-01-01')]"
                                    }
                                },
                                {
                                    "name": "infoAvailZones",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": true,
                                    "options": {
                                        "text": "If you select 'Use availability zones' below, some regions may not be available for deployment of session hosts because not all regions support Availability Zones. \n\nThe 'Session hosts region' drop down will automatically update based on this selection. If the value changes to blank, select an alternate region or set 'Use availability zones' to 'No'.",
                                        "uri": "https://learn.microsoft.com/azure/reliability/availability-zones-service-support#azure-regions-with-availability-zone-support",
                                        "style": "Info"
                                    }
                                },
                                {
                                    "name": "sessionHostsAvailabilitySettings",
                                    "type": "Microsoft.Common.CheckBox",
                                    "visible": true,
                                    "label": "Availability zones",
                                    "defaultValue": true,
                                    "toolTip": "Distribute compute resources across availability zones. If 'No' is selected then the VMs will be deployed at a regional level."
                                },
                                {
                                    "name": "sessionHostsRegion",
                                    "type": "Microsoft.Common.DropDown",
                                    "label": "Session hosts region",
                                    "defaultValue": "[steps('basics').resourceScope.location.displayName]",
                                    "filter": true,
                                    "toolTip": "Select the region where the session hosts and required resources are to be deployed.",
                                    "constraints": {
                                        "required": true,
                                        "allowedValues": "[if(equals(steps('sessionHosts').sessionHostsRegionSection.sessionHostsAvailabilitySettings, false), map(first(map(filter(steps('sessionHosts').sessionHostsRegionSection.computeApi.value, (resourceTypes) => equals(resourceTypes.resourceType, 'virtualMachines')), (item) => item.locations)), (item) => parse(concat('{\"label\":\"', item, '\",\"value\":\"', toLower(replace(item, ' ', '')), '\"}'))), map(filter(first(map(filter(steps('sessionHosts').sessionHostsRegionSection.computeApi.value, (resourceTypes) => equals(resourceTypes.resourceType, 'virtualMachines')), (item) => item.zoneMappings)), (item) => equals(length(item.zones), 3)), (item) => parse(concat('{\"label\":\"', item.location, '\",\"value\":\"', toLower(replace(item.location, ' ', '')), '\"}'))))]"
                                    }
                                }
                            ]
                        },
                        {
                            "name": "sessionHostsComputeStorageSection",
                            "type": "Microsoft.Common.Section",
                            "visible": "[steps('sessionHosts').deploySessionHosts]",
                            "label": "General settings",
                            "tooltip": "This settings apply to compute, storage, image management and key vault resources.",
                            "elements": [
                                {
                                    "name": "identityDomainOuPath",
                                    "type": "Microsoft.Common.TextBox",
                                    "visible": "[not(equals(steps('identity').identityDomainInformation.identityServiceProvider, 'EntraID'))]",
                                    "label": "Custom OU path (Optional)",
                                    "toolTip": "Provide OU where to locate session hosts, if not provided session hosts will be placed on the default (computers) OU.",
                                    "placeholder": "Example: OU=session-hosts,OU=avd,DC=contoso,DC=com",
                                    "constraints": {}
                                }
                            ]
                        },
                        {
                            "name": "sessionHostsSettingsSection",
                            "type": "Microsoft.Common.Section",
                            "visible": "[steps('sessionHosts').deploySessionHosts]",
                            "label": "Session hosts settings",
                            "elements": [
                                {
                                    "name": "sessionHostSize",
                                    "type": "Microsoft.Compute.SizeSelector",
                                    "label": "VM Size",
                                    "toolTip": "",
                                    "recommendedSizes": [
                                        "Standard_D4ads_v5"
                                    ],
                                    "constraints": {
                                        "allowedSizes": [],
                                        "excludedSizes": [],
                                        "required": true
                                    },
                                    "options": {
                                        "hideDiskTypeFilter": true
                                    },
                                    "osPlatform": "Windows",
                                    "imageReference": {
                                        "publisher": "MicrosoftWindowsDesktop",
                                        "offer": "Windows-11",
                                        "sku": "23h2-avd"
                                    },
                                    "scope": {
                                        "location": "[steps('sessionHosts').sessionHostsRegionSection.sessionHostsRegion]",
                                        "subscriptionId": "[steps('basics').resourceScope.subscription.subscriptionId]"
                                    }
                                },
                                {
                                    "name": "sessionHostSizeInfobox",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": "[steps('sessionHosts').deploySessionHosts]",
                                    "options": {
                                        "text": "Session host virtual machine sizing guidelines.",
                                        "uri": "https://learn.microsoft.com/windows-server/remote/remote-desktop-services/virtual-machine-recs",
                                        "style": "Info"
                                    }
                                },
                                {
                                    "name": "sessionHostsCount",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "VM count",
                                    "toolTip": "Provide the number of session hosts to deploy (1-100).",
                                    "defaultValue": 1,
                                    "constraints": {
                                        "required": true,
                                        "regex": "^([1-9]|[1-9][0-9]|[1][0][0])$",
                                        "validationMessage": "The count must be between 1-100 session hosts."
                                    }
                                },
                                {
                                    "name": "sessionHostDiskType",
                                    "type": "Microsoft.Common.DropDown",
                                    "label": "OS Disk type",
                                    "filter": true,
                                    "defaultValue": "Premium",
                                    "toolTip": "Select session host disk type to host the OS.",
                                    "constraints": {
                                        "required": true,
                                        "allowedValues": [
                                            {
                                                "label": "Standard",
                                                "value": "Standard_LRS"
                                            },
                                            {
                                                "label": "Premium",
                                                "value": "Premium_LRS"
                                            }
                                        ]
                                    }
                                },
                                {
                                    "name": "sessionHostDiskZeroTrust",
                                    "type": "Microsoft.Common.CheckBox",
                                    "label": "Zero trust disk configuration",
                                    "defaultValue": false,
                                    "toolTip": "Enables disk encryption and Zero trust settings on management VM and session hosts disks"
                                },
                                {
                                    "name": "ssessionHostDiskZeroTrustWarning",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": "[steps('sessionHosts').sessionHostsSettingsSection.sessionHostDiskZeroTrust]",
                                    "options": {
                                        "text": "Zero trust disk encryption requires feature EncryptionAtHost of resource provider Microsoft.Compute to be registered in the subscription.",
                                        "uri": "https://learn.microsoft.com/azure/virtual-machines/disks-enable-host-based-encryption-portal?tabs=azure-powershell",
                                        "style": "Warning"
                                    }
                                },
                                {
                                    "name": "acceleratedNetworking",
                                    "type": "Microsoft.Common.CheckBox",
                                    "label": "Enable accelerated networking",
                                    "defaultValue": true,
                                    "toolTip": "Enables low latency and high throughput on the network interface."
                                },
                                {
                                    "name": "gpuExtensionPolicy",
                                    "type": "Microsoft.Common.CheckBox",
                                    "label": "Deploy GPU extension policies (AMD and Nvidia)",
                                    "defaultValue": false,
                                    "toolTip": "Deploy policies and assign policies at pool compute resource group to automatically apply GPU extension policies for AMD and/or Nvidia SKUs."
                                },
                                {
                                    "name": "warningAcceleratedNetworkingSupport",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": "[steps('sessionHosts').sessionHostsOsSection.sessionHostsImageSource]",
                                    "options": {
                                        "text": "The Compute Gallery Image definition selected must have the 'isAcceleratedNetworkSupported' feature property set to 'true' if you enable accelerated networking on the session hosts.",
                                        "uri": "https://github.com/Azure/avdaccelerator/blob/main/workload/docs/getting-started-baseline.md",
                                        "style": "Warning"
                                    }
                                }
                            ]
                        },
                        {
                            "name": "sessionHostsOsSection",
                            "type": "Microsoft.Common.Section",
                            "visible": "[steps('sessionHosts').deploySessionHosts]",
                            "label": "OS selection",
                            "elements": [
                                {
                                    "name": "sessionHostsImageSource",
                                    "type": "Microsoft.Common.DropDown",
                                    "label": "OS image source",
                                    "filter": true,
                                    "defaultValue": "Marketplace",
                                    "toolTip": "Select marketplace or build custom image to deploy the session hosts.",
                                    "constraints": {
                                        "required": true,
                                        "allowedValues": [
                                            {
                                                "label": "Marketplace",
                                                "value": false
                                            },
                                            {
                                                "label": "Compute Gallery",
                                                "value": true
                                            }
                                        ]
                                    }
                                },
                                {
                                    "name": "sessionHostsOsImage",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": "[not(steps('sessionHosts').sessionHostsOsSection.sessionHostsImageSource)]",
                                    "label": "OS version",
                                    "filter": true,
                                    "defaultValue": "Windows 11 23H2",
                                    "toolTip": "Select the operating system version of the session hosts.",
                                    "constraints": {
                                        "required": true,
                                        "allowedValues": [
                                            {
                                                "label": "Windows 10 22H2 (Gen2)",
                                                "value": "win10_22h2_g2"
                                            },
                                            {
                                                "label": "Windows 10 22H2 - Office 365 (Gen2)",
                                                "value": "win10_22h2_office_g2"
                                            },
                                            {
                                                "label": "Windows 11 22H2",
                                                "value": "win11_22h2"
                                            },
                                            {
                                                "label": "Windows 11 22H2 - Office 365",
                                                "value": "win11_22h2_office"
                                            },
                                            {
                                                "label": "Windows 11 23H2",
                                                "value": "win11_23h2"
                                            },
                                            {
                                                "label": "Windows 11 23H2 - Office 365",
                                                "value": "win11_23h2_office"
                                            },
                                            {
                                                "label": "Windows 11 24H2",
                                                "value": "win11_24h2"
                                            },
                                            {
                                                "label": "Windows 11 24H2 - Office 365",
                                                "value": "win11_24h2_office"
                                            }
                                        ]
                                    }
                                },
                                {
                                    "name": "sessionHostsComputeGalleryImage",
                                    "type": "Microsoft.Solutions.ResourceSelector",
                                    "visible": "[steps('sessionHosts').sessionHostsOsSection.sessionHostsImageSource]",
                                    "label": "Image",
                                    "resourceType": "Microsoft.Compute/galleries/images",
                                    "constraints": {
                                        "required": true
                                    }
                                }
                            ]
                        },
                        {
                            "name": "sessionHostsSecuritySection",
                            "type": "Microsoft.Common.Section",
                            "visible": "[and(equals(steps('sessionHosts').deploySessionHosts, true), or(contains(steps('sessionHosts').sessionHostsOsSection.sessionHostsOsImage, 'win11'), contains(steps('sessionHosts').sessionHostsOsSection.sessionHostsOsImage, 'g2'), not(empty(steps('sessionHosts').sessionHostsOsSection.sessionHostsComputeGalleryImage))))]",
                            "label": "Security profile",
                            "elements": [
                                {
                                    "name": "sessionHostSecurityTypeWarning",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": "[not(empty(steps('sessionHosts').sessionHostsOsSection.sessionHostsComputeGalleryImage))]",
                                    "options": {
                                        "text": "Setting the Security Type to anything other than 'Standard' requires that the Azure Compute Gallery Image Definition be configured with the Security Type feature set to the appropriate value. You can determine if the image definition supports the required feature by reviewing the 'Properties' tab on the 'Overview' node of the Gallery Image Definition in the portal. If the image definition does not contain these feature options, then the deployment will fail.",
                                        "uri": "https://learn.microsoft.com/azure/templates/microsoft.compute/galleries/images?pivots=deployment-language-bicep",
                                        "style": "Warning"
                                    }
                                },
                                {
                                    "name": "securityType",
                                    "type": "Microsoft.Common.DropDown",
                                    "label": "Security type",
                                    "filter": true,
                                    "defaultValue": "Trusted Launch Virtual Machines",
                                    "toolTip": "Choose a type of security that matches your needs: Standard includes basic protections at no additional cost. Trusted launch virtual machines provide additional security features on Gen2 virtual machines to protect against persistent and advanced attacks.",
                                    "constraints": {
                                        "required": true,
                                        "allowedValues": [
                                            {
                                                "label": "Standard",
                                                "value": "Standard"
                                            },
                                            {
                                                "label": "Trusted Launch Virtual Machines",
                                                "value": "TrustedLaunch"
                                            },
                                            {
                                                "label": "Confidential Virtual Machines",
                                                "value": "ConfidentialVM"
                                            }
                                        ]
                                    }
                                },
                                {
                                    "name": "secureBootEnabled",
                                    "type": "Microsoft.Common.CheckBox",
                                    "visible": "[or(equals(steps('sessionHosts').sessionHostsSecuritySection.securityType, 'TrustedLaunch'), equals(steps('sessionHosts').sessionHostsSecuritySection.securityType, 'ConfidentialVM'))]",
                                    "label": "Enable secure boot",
                                    "defaultValue": true,
                                    "toolTip": "Secure boot helps protect your VMs against boot kits, rootkits, and kernel-level malware."
                                },
                                {
                                    "name": "vTpmEnabled",
                                    "type": "Microsoft.Common.CheckBox",
                                    "visible": "[or(equals(steps('sessionHosts').sessionHostsSecuritySection.securityType, 'TrustedLaunch'), equals(steps('sessionHosts').sessionHostsSecuritySection.securityType, 'ConfidentialVM'))]",
                                    "label": "Enable vTPM",
                                    "defaultValue": true,
                                    "toolTip": "Virtual Trusted Platform Module (vTPM) is TPM2.0 compliant and validates your VM boot integrity apart from securely storing keys and secrets."
                                },
                                {
                                    "name": "enableAntiMalwareExt",
                                    "type": "Microsoft.Common.CheckBox",
                                    "visible": true,
                                    "label": "Enable Antimalware extension",
                                    "defaultValue": true,
                                    "toolTip": "Enables Azure VM antimalware extension on session hosts."
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "storage",
                    "label": "Storage",
                    "elements": [
                        {
                            "name": "StorageDeploymentLocationAndAvailability",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": true,
                            "options": {
                                "text": "Storage resources will be deployed on the same location on the Session Hosts section.",
                                "uri": "https://learn.microsoft.com/azure/reliability/availability-zones-service-support#azure-regions-with-availability-zone-support",
                                "style": "Info"
                            }
                        },
                        {
                            "name": "storageGeneralSettings",
                            "type": "Microsoft.Common.Section",
                            "label": "General settings:",
                            "visible": "[or(steps('storage').storageFslogix.fslogixDeployment, steps('storage').storageAppAttach.appAttachStorageDeployment)]",
                            "elements": [
                                {
                                    "name": "identityDomainOuPathStorageExisting",
                                    "type": "Microsoft.Common.TextBox",
                                    "visible": "[not(equals(steps('identity').identityDomainInformation.identityServiceProvider, 'EntraID'))]",
                                    "label": "Custom OU path (Optional)",
                                    "toolTip": "Provide OU where to locate storage account file share. If not provided, file share will be placed on the default (computers) OU.",
                                    "placeholder": "Example: OU=storage,OU=avd,DC=contoso,DC=com",
                                    "constraints": {}
                                },
                                {
                                    "name": "storageApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "[concat(steps('basics').resourceScope.subscription.id,'/providers/Microsoft.Storage/resourceTypes?api-version=2022-01-01')]"
                                    }
                                },
                                {
                                    "name": "storageGeneralSettingsZoneRedundancy",
                                    "type": "Microsoft.Common.DropDown",
                                    "label": "Storage account type",
                                    "defaultValue": "[if(equals(steps('sessionHosts').sessionHostsRegionSection.sessionHostsAvailabilitySettings, true), 'Zone-Redundant Storage', 'Locally Redundant Storage')]",
                                    "toolTip": "Select to replicate storage across availability zones or only use local redundancy.",
                                    "constraints": {
                                        "required": true,
                                        "allowedValues": "[if(not(empty(filter(filter(first(map(filter(steps('storage').storageGeneralSettings.storageApi.value, (resourceTypes) => equals(resourceTypes.resourceType, 'storageAccounts')), (item) => item.zoneMappings)), (item) => equals(length(item.zones), 3)), (item) => equals(toLower(replace(item.location, ' ', '')), if(steps('sessionHosts').deploySessionHosts, steps('sessionHosts').sessionHostsRegionSection.sessionHostsRegion, steps('basics').resourceScope.location.name))))), parse('[{\"label\":\"Locally Redundant Storage\",\"value\":\"false\"},{\"label\":\"Zone-Redundant Storage\",\"value\":\"true\"}]'), parse('[{\"label\":\"Locally Redundant Storage\",\"value\":\"false\"}]'))]"
                                    }
                                }
                            ]
                        },
                        {
                            "name": "storageFslogix",
                            "type": "Microsoft.Common.Section",
                            "label": "FSLogix settings:",
                            "visible": true,
                            "elements": [
                                {
                                    "name": "fslogixDeployment",
                                    "type": "Microsoft.Common.CheckBox",
                                    "label": "FSLogix profile management",
                                    "defaultValue": true,
                                    "toolTip": "Deploys FSLogix containers and session host setup for user's profiles."
                                },
                                {
                                    "name": "fslogixStorageAccountSku",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": "[steps('storage').storageFslogix.fslogixDeployment]",
                                    "label": "File share peformance",
                                    "filter": true,
                                    "defaultValue": "Premium",
                                    "toolTip": "Storage account performance for FSLogix storage. Recommended tier is Premium.",
                                    "constraints": {
                                        "required": true,
                                        "allowedValues": [
                                            {
                                                "label": "Premium",
                                                "description": "",
                                                "value": "Premium"
                                            },
                                            {
                                                "label": "Standard",
                                                "description": "",
                                                "value": "Standard"
                                            }
                                        ]
                                    }
                                },
                                {
                                    "name": "sessionHostsFslogixFileShareQuota",
                                    "type": "Microsoft.Common.Slider",
                                    "visible": "[steps('storage').storageFslogix.fslogixDeployment]",
                                    "label": "File share size",
                                    "subLabel": "x 100GB",
                                    "toolTip": "Size of Azure File share quota, the maximum sizes are 5TB for standard SKU and 100TB for premium SKU",
                                    "min": 1,
                                    "max": 100,
                                    "defaultValue": 1,
                                    "showStepMarkers": true,
                                    "constraints": {
                                        "required": true
                                    }
                                },
                                {
                                    "name": "StorageDeploymentDisabledEntraId1",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": "[equals(steps('identity').identityDomainInformation.identityServiceProvider, 'EntraID')]",
                                    "options": {
                                        "text": "Granting admin consent to the storage account service principal (your-storage-account-name.file.core.windows.net) is a requirememt, the link in this box contains the steps to grant the consent.",
                                        "uri": "https://learn.microsoft.com/azure/storage/files/storage-files-identity-auth-azure-active-directory-enable?tabs=azure-portal#grant-admin-consent-to-the-new-service-principal",
                                        "style": "Warning"
                                    }
                                }
                            ]
                        },
                        {
                            "name": "storageAppAttach",
                            "type": "Microsoft.Common.Section",
                            "label": "App Attach settings:",
                            "visible": true,
                            "elements": [
                                {
                                    "name": "appAttachStorageDeployment",
                                    "type": "Microsoft.Common.CheckBox",
                                    "visible": "[not(contains(steps('basics').resourceScope.location.name, 'china'))]",
                                    "label": "Create App Attach storage",
                                    "defaultValue": false,
                                    "toolTip": "Deploys App Attach containers and permissions setup."
                                },
                                {
                                    "name": "appAttachStorageAccountSku",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": "[and(equals(steps('storage').storageAppAttach.appAttachStorageDeployment, true), not(contains(steps('basics').resourceScope.location.name, 'china')))]",
                                    "label": "File share performance",
                                    "filter": true,
                                    "defaultValue": "Premium",
                                    "toolTip": "Storage account performance for App Attach storage. Recommended tier is Premium.",
                                    "constraints": {
                                        "required": true,
                                        "allowedValues": [
                                            {
                                                "label": "Premium",
                                                "description": "",
                                                "value": "Premium"
                                            },
                                            {
                                                "label": "Standard",
                                                "description": "",
                                                "value": "Standard"
                                            }
                                        ]
                                    }
                                },
                                {
                                    "name": "sessionHostsAppAttachFileShareQuota",
                                    "type": "Microsoft.Common.Slider",
                                    "visible": "[and(equals(steps('storage').storageAppAttach.appAttachStorageDeployment, true), not(contains(steps('basics').resourceScope.location.name, 'china')))]",
                                    "label": "File share size",
                                    "subLabel": "x 100GB",
                                    "toolTip": "Size of Azure File share quota, the maximum sizes are 5TB for standard SKU and 100TB for premium SKU",
                                    "min": 1,
                                    "max": 100,
                                    "defaultValue": 1,
                                    "showStepMarkers": true,
                                    "constraints": {
                                        "required": true
                                    }
                                },
                                {
                                    "name": "appAttachStorageInfo",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": "[contains(steps('basics').resourceScope.location.name, 'china')]",
                                    "options": {
                                        "text": "App Attach is currently NOT SUPPORTED in Azure China Cloud",
                                        "style": "Warning"
                                    }
                                }
                            ]
                        },
                        {
                            "name": "StorageDeploymentDisabledEntraId2",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": "[equals(steps('identity').identityDomainInformation.identityServiceProvider, 'EntraID')]",
                            "options": {
                                "text": "FSLogix storage for Microsoft Entra ID joined session hosts is currently only available for hybrid identities.",
                                "uri": "https://learn.microsoft.com/azure/virtual-desktop/create-profile-container-azure-ad",
                                "style": "Warning"
                            }
                        }
                    ]
                },
                {
                    "name": "network",
                    "label": "Networking",
                    "type": "Microsoft.Common.Section",
                    "visible": true,
                    "elements": [
                        {
                            "name": "virtualNetworklInfoBox",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": "[not(equals(steps('identity').identityDomainInformation.identityServiceProvider, 'EntraID'))]",
                            "options": {
                                "text": "Azure Virtual Desktop LZA requires connectivity to identity services (ADDS, EntraDS or EntraID).",
                                "uri": "https://docs.microsoft.com/azure/virtual-desktop/authentication",
                                "style": "info"
                            }
                        },
                        {
                            "name": "createAvdVirtualNetwork",
                            "type": "Microsoft.Common.OptionsGroup",
                            "visible": true,
                            "label": "Virtual network",
                            "defaultValue": "New",
                            "toolTip": "",
                            "constraints": {
                                "required": true,
                                "allowedValues": [
                                    {
                                        "label": "New",
                                        "value": true
                                    },
                                    {
                                        "label": "Existing",
                                        "value": false
                                    }
                                ]
                            }
                        },
                        {
                            "name": "virtualNetworkSize",
                            "type": "Microsoft.Common.TextBox",
                            "visible": "[steps('network').createAvdVirtualNetwork]",
                            "label": "vNet address range",
                            "toolTip": "Virtual network CIDR for Azure Virtual Desktop virtual machines and PaaS private endpoints",
                            "placeholder": "Example: 10.10.0.0/16",
                            "constraints": {
                                "required": true,
                                "regex": "^(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:\/(1[0-9]|2[0-4]))$",
                                "validationMessage": "Invalid CIDR range. The address prefix must be in the range 10 to 24."
                            }
                        },
                        {
                            "name": "virtualNetworkAvdSubnetSize",
                            "type": "Microsoft.Common.TextBox",
                            "visible": "[steps('network').createAvdVirtualNetwork]",
                            "label": "Azure Virtual Desktop subnet address prefix",
                            "toolTip": "Virtual network subnet CIDR for Azure Virtual Desktop virtual machines",
                            "placeholder": "Example: 10.10.1.0/24",
                            "constraints": {
                                "required": true,
                                "regex": "^(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:\/(1[0-9]|2[0-4]))$",
                                "validationMessage": "Invalid CIDR range. The address prefix must be in the range 10 to 24."
                            }
                        },
                        {
                            "name": "virtualNetworkDns",
                            "type": "Microsoft.Common.TextBox",
                            "visible": "[and(steps('network').createAvdVirtualNetwork, not(equals(steps('identity').identityDomainInformation.identityServiceProvider, 'EntraID')))]",
                            "label": "Custom DNS servers",
                            "defaultValue": "",
                            "placeholder": "Example: 10.10.100.4,10.10.100.5",
                            "toolTip": "Enter multiple IPs separated by a comma, if not provided Azure provided DNS will be used. Azure default DNS server (168.63.129.16) will be added as a last resort.",
                            "constraints": {
                                "regex": ""
                            }
                        },
                        {
                            "name": "existingVirtualNetworkInfoBox",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": "[not(steps('network').createAvdVirtualNetwork)]",
                            "options": {
                                "text": "Existing network must has connectivity to identity and DNS services.",
                                "uri": "https://docs.microsoft.com/azure/architecture/example-scenario/wvd/windows-virtual-desktop?context=/azure/virtual-desktop/context/context",
                                "style": "info"
                            }
                        },
                        {
                            "name": "avdVirtualNetworkSelectorId",
                            "type": "Microsoft.Solutions.ResourceSelector",
                            "visible": "[not(steps('network').createAvdVirtualNetwork)]",
                            "label": "Azure Virtual Desktop virtual network",
                            "resourceType": "Microsoft.Network/virtualNetworks",
                            "constraints": {
                                "required": true
                            },
                            "options": {
                                "filter": {
                                    "subscription": "onBasics"
                                }
                            },
                            "scope": {
                                "location": "[if(steps('sessionHosts').deploySessionHosts, steps('sessionHosts').sessionHostsRegionSection.sessionHostsRegion, steps('basics').resourceScope.location.name)]"
                            }
                        },
                        {
                            "name": "avdSubnetApi",
                            "type": "Microsoft.Solutions.ArmApiControl",
                            "request": {
                                "method": "GET",
                                "path": "[concat(steps('network').avdVirtualNetworkSelectorId.id, '/subnets?api-version=2022-01-01')]"
                            }
                        },
                        {
                            "name": "virtualNetworkAvdSubnetSelectorName",
                            "label": "Azure Virtual Desktop subnet",
                            "type": "Microsoft.Common.DropDown",
                            "visible": "[not(steps('network').createAvdVirtualNetwork)]",
                            "defaultValue": "",
                            "toolTip": "Select the subnet.",
                            "multiselect": false,
                            "selectAll": false,
                            "filter": true,
                            "filterPlaceholder": "Filter items ...",
                            "multiLine": true,
                            "constraints": {
                                "allowedValues": "[map(steps('network').avdSubnetApi.value,(item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.id, '\",\"description\":\"', 'Resource Group: ', last(take(split(item.id, '/'), 5)), '\"}')))]",
                                "required": true
                            }
                        },
                        {
                            "name": "deployDDoSNetworkProtection",
                            "type": "Microsoft.Common.CheckBox",
                            "visible": "[steps('network').createAvdVirtualNetwork]",
                            "label": "Enable DDoS Network Protection",
                            "defaultValue": false,
                            "toolTip": "Enables DDoS Network Protection for the virtual network."
                        },
                        {
                            "name": "deployPrivateEndpointKeyvaultStorage",
                            "type": "Microsoft.Common.CheckBox",
                            "visible": true,
                            "label": "Private endpoints for Key vault and Storage account",
                            "defaultValue": true,
                            "toolTip": "Enables Private Endpoints for Key Vault and Storage Resources. It is recommended to use Azure Private Endpoints to keep all traffic to PaaS services on the Azure backbone."
                        },
                        {
                            "name": "deployAvdPrivateLinkService",
                            "type": "Microsoft.Common.CheckBox",
                            "label": "Private endpoints for AVD (Requires registration of resource provider)",
                            "defaultValue": false,
                            "toolTip": "Enables Private Endpoints for AVD Discovery and Connection. It is recommended to use Azure Private Endpoints to keep all traffic to PaaS services on the Azure backbone. <br/> Private Link Resource Provider Registration: <br/> <a href='https://learn.microsoft.com/en-us/azure/virtual-desktop/private-link-setup'>https://learn.microsoft.com/en-us/azure/virtual-desktop/private-link-setup</a>"
                        },
                        {
                            "name": "hostPoolPrivateEndpointNetworkAccessSelector",
                            "type": "Microsoft.Common.DropDown",
                            "visible": "[steps('network').deployAvdPrivateLinkService]",
                            "defaultValue": "Enabled For Clients Only",
                            "toolTip": "<b>- Disabled:</b> Blocks public access and requires both clients and session hosts to use the private endpoints. <br/> <b>- Enabled:</b> Allow Clients and session hosts to communicate over the public network. <br/> <b>- Enabled for Clients Only:</b> Allow Clients to access AVD over public network and blocks Session Hosts from accessing AVD services over public network. <br/> <b>- Enabled For Session Hosts Only:</b> Allow Session Hosts to communicate over the public network and blocks clients from accessing AVD over public network.",
                            "label": "Host Pool Private Endpoint Public Network Access",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "Disabled",
                                        "value": "Disabled"
                                    },
                                    {
                                        "label": "Enabled",
                                        "value": "Enabled"
                                    },
                                    {
                                        "label": "Enabled For Clients Only",
                                        "value": "EnabledForClientsOnly"
                                    },
                                    {
                                        "label": "Enabled For Session Hosts Only",
                                        "value": "EnabledForSessionHostsOnly"
                                    }
                                ]
                            }
                        },
                        {
                            "name": "workspacePrivateEndpointNetworkAccessSelector",
                            "type": "Microsoft.Common.DropDown",
                            "visible": "[steps('network').deployAvdPrivateLinkService]",
                            "defaultValue": "Enabled",
                            "toolTip": "<b>- Disabled:</b> Workspace feed requests are denied from public routes, but allowed from private routes. <br/> <b>- Enabled:</b> Workspace feed requests are allowed from public and private routes.",
                            "label": "Workspace Private Endpoint Public Network Access",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "Disabled",
                                        "value": "Disabled"
                                    },
                                    {
                                        "label": "Enabled",
                                        "value": "Enabled"
                                    }
                                ]
                            }
                        },
                        {
                            "name": "hostPoolPrivateEndpointNetworkAccessSelectorWarning1",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": "[or(equals(steps('network').hostPoolPrivateEndpointNetworkAccessSelector, 'Disabled'), equals(steps('network').workspacePrivateEndpointNetworkAccessSelector, 'Disabled'), equals(steps('network').hostPoolPrivateEndpointNetworkAccessSelector, 'EnabledForSessionHostsOnly'))]",
                            "options": {
                                "text": "When setting the AVD Private Link service to 'Disabled' or 'EnabledForSessionHostsOnly', all communication to AVD services will be restricted to use private endpoints. If you do not have a VPN or Express route configured in your environment, you will not be able to connect to your AVD instance.",
                                "uri": "https://learn.microsoft.com/en-us/azure/virtual-desktop/private-link-overview#configuration-outcomes",
                                "style": "Warning"
                            }
                        },
                        {
                            "name": "virtualNetworkPrivateEndpointSubnetSize",
                            "type": "Microsoft.Common.TextBox",
                            "visible": "[and(equals(steps('network').createAvdVirtualNetwork, true), or(equals(steps('network').deployPrivateEndpointKeyvaultStorage, true), equals(steps('network').deployAvdPrivateLinkService, true)))]",
                            "label": "Private endpoint subnet address prefix",
                            "toolTip": "Virtual network subnet CIDR for private endpoints",
                            "placeholder": "Example: 10.10.2.0/27",
                            "constraints": {
                                "required": true,
                                "regex": "^(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:\/(1[0-9]|2[0-7]))$",
                                "validationMessage": "Invalid CIDR range. The address prefix must be in the range 10 to 27."
                            }
                        },
                        {
                            "name": "privateEndpointVirtualNetworkSelectorId",
                            "type": "Microsoft.Solutions.ResourceSelector",
                            "visible": "[and(equals(steps('network').createAvdVirtualNetwork, false), or(equals(steps('network').deployPrivateEndpointKeyvaultStorage, true), equals(steps('network').deployAvdPrivateLinkService, true)))]",
                            "label": "Private endpoint virtual network",
                            "resourceType": "Microsoft.Network/virtualNetworks",
                            "constraints": {
                                "required": true
                            },
                            "options": {
                                "filter": {
                                    "subscription": "onBasics",
                                    "location": "[steps('SessionHosts').SessionHostsRegionSection.SessionHostsRegion.location.displayName]"
                                }
                            }
                        },
                        {
                            "name": "privateEndpointSubnetApi",
                            "type": "Microsoft.Solutions.ArmApiControl",
                            "request": {
                                "method": "GET",
                                "path": "[concat(steps('network').privateEndpointVirtualNetworkSelectorId.id, '/subnets?api-version=2022-01-01')]"
                            }
                        },
                        {
                            "name": "virtualNetworkPrivateEndpointSubnetSelectorName",
                            "label": "Private endpoint subnet",
                            "type": "Microsoft.Common.DropDown",
                            "visible": "[and(equals(steps('network').createAvdVirtualNetwork, false), or(equals(steps('network').deployPrivateEndpointKeyvaultStorage, true), equals(steps('network').deployAvdPrivateLinkService, true)))]",
                            "defaultValue": "",
                            "toolTip": "Select the subnet.",
                            "multiselect": false,
                            "selectAll": false,
                            "filter": true,
                            "filterPlaceholder": "Filter items ...",
                            "multiLine": true,
                            "constraints": {
                                "allowedValues": "[map(steps('network').privateEndpointSubnetApi.value,(item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.id, '\",\"description\":\"', 'Resource Group: ', last(take(split(item.id, '/'), 5)), '\"}')))]",
                                "required": true
                            }
                        },
                        {
                            "name": "existingVirtualNetworkInfoBoxPrivateEndpointWarning",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": "[and(equals(steps('network').createAvdVirtualNetwork, false), or(equals(steps('network').deployPrivateEndpointKeyvaultStorage, true), equals(steps('network').deployAvdPrivateLinkService, true)))]",
                            "options": {
                                "text": "Private endpoint network policy will need to be disabled on the existing subnet before deploying Azure Virtual Desktop LZA.",
                                "uri": "https://docs.microsoft.com/azure/private-link/disable-private-endpoint-network-policy",
                                "style": "Warning"
                            }
                        },
                        {
                            "name": "virtualNetworkPrivateDnsZone",
                            "type": "Microsoft.Common.OptionsGroup",
                            "visible": "[or(steps('network').deployPrivateEndpointKeyvaultStorage, steps('network').deployAvdPrivateLinkService)]",
                            "label": "Azure private DNS zones",
                            "defaultValue": "Use existing",
                            "toolTip": "It is recommended to use Azure private DNS zones for private endpoint name spaces, private endpoints will be automatically created for PaaS services (Azure Files and Key Vault) if enabled, but the private DNS zones are required for name resolution of private endpoint DNS records.",
                            "constraints": {
                                "required": true,
                                "allowedValues": [
                                    {
                                        "label": "Create new",
                                        "value": true
                                    },
                                    {
                                        "label": "Use existing",
                                        "value": false
                                    }
                                ]
                            }
                        },
                        {
                            "name": "privateDnsZoneSelectionWarning1",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": "[and(equals(steps('network').createAvdVirtualNetwork, true), or(equals(steps('network').deployPrivateEndpointKeyvaultStorage, true), equals(steps('network').deployAvdPrivateLinkService, true)), equals(steps('network').virtualNetworkPrivateDnsZone, false))]",
                            "options": {
                                "text": "When using private endpoints, creating a new Azure Virtual Desktop vNet, and providing custom DNS servers, existing Azure private DNS Zones MUST be linked to the vNet where the custom DNS servers are located, this is needed for the end-to-end setup of FSLogix and App Attach file shares to be successful. The DNS resolution requests will be sent to the custom DNS servers and its vNet is the one that needs to resolve private endpoint DNS records.",
                                "uri": "https://learn.microsoft.com/azure/private-link/private-endpoint-dns",
                                "style": "Warning"
                            }
                        },
                        {
                            "name": "privateDnsZoneSelectionWarning2",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": "[and(equals(steps('network').createAvdVirtualNetwork, true), or(equals(steps('network').deployPrivateEndpointKeyvaultStorage, true), equals(steps('network').deployAvdPrivateLinkService, true)), equals(steps('network').virtualNetworkPrivateDnsZone, true))]",
                            "options": {
                                "text": "When using private endpoints and creating a new Azure Virtual Desktop vNet and new private DNS zones, custom DNS servers may NOT be used in the new vNet as this will cause FSLogix and/or App Attach file shares deployments to fail. This happens because the private DNS zones will be linked to the newly created vNet and only this vNet will be able to resolve the private endpoints DNS records.",
                                "uri": "https://learn.microsoft.com/azure/private-link/private-endpoint-dns",
                                "style": "Warning"
                            }
                        },
                        {
                            "name": "privateDnsZoneSelectionWarning3",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": "[and(equals(steps('network').createAvdVirtualNetwork, false), or(equals(steps('network').deployPrivateEndpointKeyvaultStorage, true), equals(steps('network').deployAvdPrivateLinkService, true)), equals(steps('network').virtualNetworkPrivateDnsZone, false))]",
                            "options": {
                                "text": "When using private endpoints and an existing Azure Virtual Desktop vNet with custom DNS servers configured, existing private DNS zones MUST be linked to the vNet containing the custom DNS servers for FSLogix and/or App Attach file shares deployments to be successful, given DNS name resolution requests will go to custom DNS servers and their vNet will need to resolve private endpoints DNS records.",
                                "uri": "https://learn.microsoft.com/azure/private-link/private-endpoint-dns",
                                "style": "Warning"
                            }
                        },
                        {
                            "name": "privateDnsZoneSelectionWarning4",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": "[and(equals(steps('network').createAvdVirtualNetwork, false), equals(steps('network').deployPrivateEndpointKeyvaultStorage, true), equals(steps('network').virtualNetworkPrivateDnsZone, true))]",
                            "options": {
                                "text": "When using private endpoints, an existing Azure Virtual Desktop vNet, and creating new private DNS zones, custom DNS servers may NOT be used (unless they are connected to the same vNet used for the Azure Virtual Desktop deployment) in order for FSlogix/App Attach deployment to be successful, given that the private DNS zone will be linked to the existing vNet and this will be the only network able to resolve private endpoint DNS records. <br/> ***Note: selected options (existing vNet and create DNS zones) are only recommended when using Microsoft Entra ID as identity service provider.",
                                "uri": "https://learn.microsoft.com/azure/private-link/private-endpoint-dns",
                                "style": "Warning"
                            }
                        },
                        {
                            "name": "privateDnsZoneSelectionWarning5",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": "[and(equals(steps('network').createAvdVirtualNetwork, false), equals(steps('network').deployAvdPrivateLinkService, true), equals(steps('network').virtualNetworkPrivateDnsZone, true))]",
                            "options": {
                                "text": "When using private endpoints, an existing Azure Virtual Desktop vNet, and creating new private DNS zones, custom DNS servers may NOT be used (unless they are connected to the same vNet used for the Azure Virtual Desktop deployment) in order for FSlogix/App Attach deployment to be successful, given that the private DNS zone will be linked to the existing vNet and this will be the only network able to resolve private endpoint DNS records. <br/> ***Note: selected options (existing vNet and create DNS zones) are only recommended when using Microsoft Entra ID as identity service provider.",
                                "uri": "https://learn.microsoft.com/azure/private-link/private-endpoint-dns",
                                "style": "Warning"
                            }
                        },
                        {
                            "name": "virtualNetworkPrivateDnsZoneInfo1",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": "[and(steps('network').deployPrivateEndpointKeyvaultStorage, steps('network').virtualNetworkPrivateDnsZone)]",
                            "options": {
                                "text": "The following private DNS zones will be created and linked to the new Azure Virtual Desktop vNet: <br/> Azure Files: <br/> - Azure Commercial: privatelink.file.core.windows.net <br/> - Azure Government: privatelink.file.core.usgovcloudapi.net <br/> - Azure China: privatelink.file.core.chinacloudapi.cn <br/> Key vault: <br/> - Azure Commercial: privatelink.vaultcore.azure.net <br/> - Azure Government: privatelink.vaultcore.usgovcloudapi.net <br/> - Azure China: privatelink.vaultcore.azure.cn",
                                "style": "info"
                            }
                        },
                        {
                            "name": "virtualNetworkPrivateDnsZoneInfo2",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": "[and(steps('network').deployAvdPrivateLinkService, steps('network').virtualNetworkPrivateDnsZone)]",
                            "options": {
                                "text": "The following private DNS zones will be created and linked to the new Azure Virtual Desktop vNet: <br/> AVD Discovery: <br/> - Azure Commercial: privatelink-global.wvd.microsoft.com <br/> - Azure Government: privatelink-global.wvd.azure.us <br/> - Azure China: privatelink-global.wvd.azure.cn <br/> AVD Connection/Feed: <br/> - Azure Commercial: privatelink.wvd.microsoft.com <br/> - Azure Government: privatelink.wvd.azure.us <br/> - Azure China: privatelink.wvd.azure.cn",
                                "style": "info"
                            }
                        },
                        {
                            "name": "virtualNetworkPrivateDnsZoneSelection",
                            "type": "Microsoft.Common.Section",
                            "visible": "[and(not(steps('network').virtualNetworkPrivateDnsZone), or(steps('network').deployPrivateEndpointKeyvaultStorage, steps('network').deployAvdPrivateLinkService))]",
                            "elements": [
                                {
                                    "name": "virtualNetworkPrivateDnsZoneFilesSelector",
                                    "type": "Microsoft.Solutions.ResourceSelector",
                                    "visible": "[and(steps('network').deployPrivateEndpointKeyvaultStorage, not(steps('network').virtualNetworkPrivateDnsZone), or(steps('storage').storageFslogix.fslogixDeployment, steps('storage').storageAppAttach.appAttachStorageDeployment, true))]",
                                    "label": "Azure files",
                                    "resourceType": "Microsoft.Network/privateDnsZones",
                                    "constraints": {
                                        "required": true
                                    }
                                },
                                {
                                    "name": "virtualNetworkPrivateDnsZoneKeyvaultSelector",
                                    "type": "Microsoft.Solutions.ResourceSelector",
                                    "visible": "[and(steps('network').deployPrivateEndpointKeyvaultStorage, not(steps('network').virtualNetworkPrivateDnsZone))]",
                                    "label": "Key vault",
                                    "resourceType": "Microsoft.Network/privateDnsZones",
                                    "constraints": {
                                        "required": true
                                    }
                                },
                                {
                                    "name": "virtualNetworkPrivateDnsZoneAvdDiscoverySelector",
                                    "type": "Microsoft.Solutions.ResourceSelector",
                                    "visible": "[and(steps('network').deployAvdPrivateLinkService, not(steps('network').virtualNetworkPrivateDnsZone))]",
                                    "label": "Azure Virtual Desktop (Discovery)",
                                    "resourceType": "Microsoft.Network/privateDnsZones",
                                    "constraints": {
                                        "required": true
                                    }
                                },
                                {
                            
                                    "name": "virtualNetworkPrivateDnsZoneAvdConnectionSelector",
                                    "type": "Microsoft.Solutions.ResourceSelector",
                                    "visible": "[and(steps('network').deployAvdPrivateLinkService, not(steps('network').virtualNetworkPrivateDnsZone))]",
                                    "label": "Azure Virtual Desktop (Connection/Feed)",
                                    "resourceType": "Microsoft.Network/privateDnsZones",
                                    "constraints": {
                                        "required": true
                                    }
                                },
                                {
                                    "name": "infoAzureDNSzones1",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": "[and(steps('network').deployPrivateEndpointKeyvaultStorage, not(steps('network').virtualNetworkPrivateDnsZone))]",
                                    "options": {
                                        "text": "Private DNS zone name spaces: <br/> Azure Files: <br/> - Azure Commercial: privatelink.file.core.windows.net <br/> - Azure Government: privatelink.file.core.usgovcloudapi.net <br/> - Azure China: privatelink.file.core.chinacloudapi.cn <br/> Key vault: <br/> - Azure Commercial: privatelink.vaultcore.azure.net <br/> - Azure Government: privatelink.vaultcore.usgovcloudapi.net <br/> - Azure China: privatelink.vaultcore.azure.cn",
                                        "style": "info"
                                    }
                                },
                                {
                                    "name": "infoAzureDNSzones2",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": "[and(steps('network').deployAvdPrivateLinkService, not(steps('network').virtualNetworkPrivateDnsZone))]",
                                    "options": {
                                        "text": "Private DNS zone name spaces: <br/> AVD Discovery: <br/> - Azure Commercial: privatelink-global.wvd.microsoft.com <br/> - Azure Government: privatelink-global.wvd.azure.us <br/> - Azure China: privatelink-global.wvd.azure.cn <br/> AVD Connection/Feed: <br/> - Azure Commercial: privatelink.wvd.microsoft.com <br/> - Azure Government: privatelink.wvd.azure.us <br/> - Azure China: privatelink.wvd.azure.cn",
                                        "style": "info"
                                    }
                                }
                            ]
                        },
                        {
                            "name": "hubVirtualNetworkPeering",
                            "type": "Microsoft.Common.Section",
                            "visible": "[steps('network').createAvdVirtualNetwork]",
                            "label": "Existing hub vNet peering information",
                            "elements": [
                                {
                                    "name": "virtualNetworkPeeringInfoBox1",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": "[and(equals(steps('network').createAvdVirtualNetwork, true),not(equals(steps('identity').identityDomainInformation.identityServiceProvider, 'EntraID')))]",
                                    "options": {
                                        "text": "vNet peering will be created to existing vNet hub with access to identity and DNS services .",
                                        "uri": "https://docs.microsoft.com/azure/architecture/example-scenario/wvd/windows-virtual-desktop?context=/azure/virtual-desktop/context/context",
                                        "style": "info"
                                    }
                                },
                                {
                                    "name": "hubVirtualNetworkPeeringInfoBox2",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": "[equals(steps('identity').identityDomainInformation.identityServiceProvider, 'EntraID')]",
                                    "options": {
                                        "text": "vNet peering to identity services is not required when Microsoft Entra ID as identity service provider .",
                                        "uri": "https://learn.microsoft.com/azure/architecture/example-scenario/wvd/azure-virtual-desktop-azure-active-directory-join",
                                        "style": "info"
                                    }
                                },
                                {
                                    "name": "hubVirtualNetworkSub",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": "[not(equals(steps('identity').identityDomainInformation.identityServiceProvider, 'EntraID'))]",
                                    "label": "Hub vNet Subscription",
                                    "toolTip": "",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(steps('basics').subscriptionsApi.value, (sub) => parse(concat('{\"label\":\"', sub.displayName, '\",\"description\":\"', sub.subscriptionId, '\",\"value\":\"', toLower(sub.subscriptionId), '\"}')) )]",
                                        "required": true
                                    }
                                },
                                {
                                    "name": "existingHubVirtualNetworks",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "[concat('subscriptions/', steps('network').hubVirtualNetworkPeering.hubVirtualNetworkSub, '/providers/Microsoft.Network/virtualNetworks?api-version=2022-01-01')]"
                                    }
                                },
                                {
                                    "name": "existingHubVirtualNetwork",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": "[not(equals(steps('identity').identityDomainInformation.identityServiceProvider, 'EntraID'))]",
                                    "label": "Hub vNet",
                                    "toolTip": "",
                                    "multiselect": false,
                                    "selectAll": true,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(steps('network').hubVirtualNetworkPeering.existingHubVirtualNetworks.value, (vnet) => parse(concat('{\"label\":\"', vnet.name, '\",\"description\":\"', vnet.location, '\",\"value\":\"', toLower(vnet.id), '\"}')) )]",
                                        "required": true
                                    }
                                },
                                {
                                    "name": "hubVirtualNetworkGateway",
                                    "type": "Microsoft.Common.CheckBox",
                                    "visible": "[not(equals(steps('identity').identityDomainInformation.identityServiceProvider, 'EntraID'))]",
                                    "label": "Gateway on hub",
                                    "defaultValue": false,
                                    "toolTip": "This information will be used to set remote gateway settings on vNet peering."
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "monitoring",
                    "label": "Monitoring",
                    "type": "Microsoft.Common.Section",
                    "visible": true,
                    "elements": [
                        {
                            "name": "deployMonitoring",
                            "type": "Microsoft.Common.CheckBox",
                            "visible": true,
                            "label": "Deploy monitoring",
                            "defaultValue": true,
                            "toolTip": "Deploy monitoring settings and if selected deploy Azure log analytics workspace."
                        },
                        {
                            "name": "deployMonitoringAlaWorkspace",
                            "type": "Microsoft.Common.OptionsGroup",
                            "visible": "[steps('monitoring').deployMonitoring]",
                            "label": "Log analytics workspace",
                            "defaultValue": "New",
                            "toolTip": "Deploy monitoring settings and if selected deploy Azure log analytics workspace.",
                            "constraints": {
                                "required": true,
                                "allowedValues": [
                                    {
                                        "label": "New",
                                        "value": true
                                    },
                                    {
                                        "label": "Existing",
                                        "value": false
                                    }
                                ]
                            }
                        },
                        {
                            "name": "deployMonitoringNewAlaWorkspaceRetention",
                            "type": "Microsoft.Common.TextBox",
                            "visible": "[and(steps('monitoring').deployMonitoring, steps('monitoring').deployMonitoringAlaWorkspace)]",
                            "label": "Retention policy (Days)",
                            "toolTip": "Number of days data will be retained in the workspace.",
                            "defaultValue": 90,
                            "constraints": {
                                "required": true,
                                "regex": "^[a-z0-9A-Z-]{1,90}$",
                                "validationMessage": "Value must be 1-90 characters."
                            }
                        },
                        {
                            "name": "alaWorkspaceExistingWorkspacesSelection",
                            "type": "Microsoft.Solutions.ResourceSelector",
                            "visible": "[and(steps('monitoring').deployMonitoring, not(steps('monitoring').deployMonitoringAlaWorkspace))]",
                            "label": "Existing workspace",
                            "resourceType": "Microsoft.OperationalInsights/workspaces",
                            "constraints": {
                                "required": true
                            }
                        },
                        {
                            "name": "deployMonitoringPolicies",
                            "type": "Microsoft.Common.CheckBox",
                            "visible": "[steps('monitoring').deployMonitoring]",
                            "label": "Deploy monitoring policies (subscription level)",
                            "defaultValue": false,
                            "toolTip": "Deploy monitoring policy and policy set definitions to set diagnostic settings on new deployed resources."
                        },
                        {
                            "name": "deployMonitoringInfo1",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": "[steps('monitoring').deployMonitoring]",
                            "options": {
                                "text": "Azure Virtual Desktop monitoring requires an existing Azure Log Analytics Workspace or the creation of a new one.",
                                "uri": "https://docs.microsoft.com/azure/virtual-desktop/azure-monitor",
                                "style": "Info"
                            }
                        },
                        {
                            "name": "deployMonitoringInfo2",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": "[steps('monitoring').deployMonitoring]",
                            "options": {
                                "text": "Deployment will configured all required settings to use the Azure Virtual Desktop insights workbook.",
                                "uri": "https://learn.microsoft.com/azure/virtual-desktop/azure-monitor?WT.mc_id=Portal-AppInsightsExtension",
                                "style": "Info"
                            }
                        },
                        {
                            "name": "deployMonitoringInfo3",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": "[contains(steps('basics').resourceScope.location.name, 'china')]",
                            "options": {
                                "text": "For Azure China deployment, Monitoring and Diagnostics is only supported in Chinaeast2 and Chinanorth3 regions",
                                "uri": "https://azure.microsoft.com/en-us/explore/global-infrastructure/products-by-region/?products=all&regions=china-non-regional%2Cchina-east%2Cchina-east-2%2Cchina-east-3%2Cchina-north%2Cchina-north-2%2Cchina-north-3&rar=true",
                                "style": "Warning"
                            }
                        }
                    ]
                },
                {
                    "name": "resourceNaming",
                    "label": "Resource naming",
                    "type": "Microsoft.Common.Section",
                    "visible": true,
                    "elements": [
                        {
                            "name": "resourceNamingInfo1",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": true,
                            "options": {
                                "text": "Azure Virtual Desktop LZA default naming scheme is shown in this diagram.",
                                "uri": "https://github.com/Azure/avdaccelerator/blob/main/workload/docs/diagrams/avd-accelerator-resource-organization-naming.png",
                                "style": "Info"
                            }
                        },
                        {
                            "name": "resourceNamingSelection",
                            "type": "Microsoft.Common.CheckBox",
                            "visible": true,
                            "label": "Custom resource naming",
                            "defaultValue": false,
                            "toolTip": "When selected, the information provided will be used to name resources. When set to 'No' deployment will use the Azure Virtual Desktop LZA naming standard."
                        },
                        {
                            "name": "resourceNamingWarning",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": "[steps('resourceNaming').resourceNamingSelection]",
                            "options": {
                                "text": "When using custom naming for resources, please make sure to follow naming rules and restrictions for Azure resources.",
                                "uri": "https://docs.microsoft.com/azure/azure-resource-manager/management/resource-name-rules",
                                "style": "Warning"
                            }
                        },
                        {
                            "name": "resourceNamingAvdManagementPlane",
                            "type": "Microsoft.Common.Section",
                            "label": "Azure Virtual Desktop Management plane naming:",
                            "visible": "[steps('resourceNaming').resourceNamingSelection]",
                            "elements": [
                                {
                                    "name": "serviceObjectsRgCustomName",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Resource group",
                                    "toolTip": "Azure Virtual Desktop management plane resources (Workspace, Host pool, Application groups, Key vault) resource group custom name.",
                                    "placeholder": "Example: rg-avd-app1-dev-use2-service-objects",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,90}$",
                                        "validationMessage": "Value must be 1-90 characters."
                                    }
                                },
                                {
                                    "name": "workSpaceCustomName",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Workspace",
                                    "toolTip": "Workspace custom name.",
                                    "placeholder": "Example: vdws-app1-dev-use2-001",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,64}$",
                                        "validationMessage": "Value must be 1-64 characters."
                                    }
                                },
                                {
                                    "name": "workSpaceCustomFriendlyName",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Workspace (Friendly name)",
                                    "toolTip": "Workspace custom friendly name.",
                                    "placeholder": "Example: App1 - Dev - East US 2 - 001",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,64}$",
                                        "validationMessage": "Value must be 1-64 characters."
                                    }
                                },
                                {
                                    "name": "hostPoolCustomName",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Host pool",
                                    "toolTip": "Host pool custom name.",
                                    "placeholder": "Example: vdpool-app1-dev-use2-001",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,64}$",
                                        "validationMessage": "Value must be 1-64 characters."
                                    }
                                },
                                {
                                    "name": "hostPoolCustomFriendlyName",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Host pool (Friendly name)",
                                    "toolTip": "Host pool custom friendly name.",
                                    "placeholder": "Example: App1 - Dev - East US 2 - 001",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,64}$",
                                        "validationMessage": "Value must be 1-64 characters."
                                    }
                                },
                                {
                                    "name": "scalingPlanCustomName",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Scaling Plan",
                                    "toolTip": "Host pool scaling plan.",
                                    "placeholder": "Example: vdscaling-app1-dev-use2-001",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,64}$",
                                        "validationMessage": "Value must be 1-64 characters."
                                    }
                                },
                                {
                                    "name": "applicationGroupCustomName",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Application group",
                                    "toolTip": "Application group custom name.",
                                    "placeholder": "Example: vdag-desktop-app1-dev-use2-001",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,64}$",
                                        "validationMessage": "Value must be 1-64 characters."
                                    }
                                },
                                {
                                    "name": "applicationGroupCustomFriendlyName",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Application group (Friendly name)",
                                    "toolTip": "Desktop application group custom name.",
                                    "placeholder": "Example: Desktops - App1 - Dev - East US 2 - 001",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,64}$",
                                        "validationMessage": "Value must be 1-64 characters."
                                    }
                                },
                                {
                                    "name": "workloadKvCustomName",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Key vault prefix",
                                    "toolTip": "Key vault prefix custom name.",
                                    "placeholder": "Example: kv-sec",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,6}$",
                                        "validationMessage": "Value must be 1-6 characters."
                                    }
                                }
                            ]
                        },
                        {
                            "name": "resourceNamingCompute",
                            "type": "Microsoft.Common.Section",
                            "label": "Compute naming:",
                            "visible": "[steps('resourceNaming').resourceNamingSelection]",
                            "elements": [
                                {
                                    "name": "computeObjectsRgCustomName",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Resource group",
                                    "toolTip": "Azure Virtual Desktop compute resources (VMs, NICs, Disks) resource group custom name.",
                                    "placeholder": "Example: rg-avd-app1-dev-use2-pool-compute",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,90}$",
                                        "validationMessage": "Value must be 1-90 characters."
                                    }
                                },
                                {
                                    "name": "applicationSecurityGroupCustomName",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Applications security group",
                                    "toolTip": "Azure Virtual Desktop application security custom name.",
                                    "placeholder": "Example: asg-app1-dev-use2-001",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,80}$",
                                        "validationMessage": "Value must be 1-80 characters."
                                    }
                                },
                                {
                                    "name": "sessionHostCustomNamePrefix",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Session host prefix",
                                    "visible": "[steps('sessionHosts').deploySessionHosts]",
                                    "toolTip": "Azure Virtual Desktop session host prefix custom name.",
                                    "placeholder": "Example: vmapp1deus2",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,11}$",
                                        "validationMessage": "Value must be 1-11 characters."
                                    }
                                }
                            ]
                        },
                        {
                            "name": "resourceNamingStorage",
                            "type": "Microsoft.Common.Section",
                            "label": "Storage naming:",
                            "visible": "[steps('resourceNaming').resourceNamingSelection]",
                            "elements": [
                                {
                                    "name": "resourceNamingStorageInfo1",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": "[not(steps('storage').storageFslogix.fslogixDeployment)]",
                                    "options": {
                                        "text": "Current deployment configuration is not creating storage resources for FSLogix.",
                                        "style": "Info"
                                    }
                                },
                                {
                                    "name": "resourceNamingStorageInfo2",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": "[not(steps('storage').storageAppAttach.appAttachStorageDeployment)]",
                                    "options": {
                                        "text": "Current deployment configuration is not creating storage resources for App Attach.",
                                        "style": "Info"
                                    }
                                },
                                {
                                    "name": "resourceNamingStorageInfo3",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": "[not(steps('sessionHosts').deploySessionHosts)]",
                                    "options": {
                                        "text": "Current deployment configuration is not creating storage resources.",
                                        "style": "Info"
                                    }
                                },
                                {
                                    "name": "storageObjectsRgCustomName",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Resource group",
                                    "visible": "[or(equals(steps('storage').storageFslogix.fslogixDeployment, true), equals(steps('storage').storageAppAttach.appAttachStorageDeployment, true))]",
                                    "toolTip": "Azure Virtual Desktop storage resources (Storage account, file shares, files private endpoints, temporary domain join VM) resource group custom name.",
                                    "placeholder": "Example: rg-avd-app1-dev-use2-storage",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,90}$",
                                        "validationMessage": "Value must be 1-90 characters."
                                    }
                                },
                                {
                                    "name": "storageAccountPrefixCustomName",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Storage account prefix",
                                    "visible": "[or(equals(steps('storage').storageFslogix.fslogixDeployment, true), equals(steps('storage').storageAppAttach.appAttachStorageDeployment, true))]",
                                    "toolTip": "Azure Virtual Desktop storage account prefix custom name.",
                                    "placeholder": "Example: st",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,2}$",
                                        "validationMessage": "Value must be 1-2 characters."
                                    }
                                },
                                {
                                    "name": "fslogixFileShareCustomName",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "FSLogix Profile container file share",
                                    "visible": "[steps('storage').storageFslogix.fslogixDeployment]",
                                    "toolTip": "Azure Virtual Desktop fslogix storage account profile container file share prefix custom name.",
                                    "placeholder": "Example: fslogix-pc-app1-dev-use2-001",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,64}$",
                                        "validationMessage": "Value must be 1-64 characters."
                                    }
                                },
                                {
                                    "name": "appAttachFileShareCustomName",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "App Attach container file share",
                                    "visible": "[steps('storage').storageAppAttach.appAttachStorageDeployment]",
                                    "toolTip": "Azure Virtual Desktop App Attach storage account container file share prefix custom name.",
                                    "placeholder": "Example: appa-app1-dev-use2-001",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,64}$",
                                        "validationMessage": "Value must be 1-64 characters."
                                    }
                                }
                            ]
                        },
                        {
                            "name": "resourceNamingNetwork",
                            "type": "Microsoft.Common.Section",
                            "label": "Network naming:",
                            "visible": "[steps('resourceNaming').resourceNamingSelection]",
                            "elements": [
                                {
                                    "name": "resourceNamingNetworkInfo",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": "[not(steps('network').createAvdVirtualNetwork)]",
                                    "options": {
                                        "text": "Current deployment configuration is not creating network resources.",
                                        "style": "Info"
                                    }
                                },
                                {
                                    "name": "networkObjectsRgCustomName",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Resource group",
                                    "visible": "[steps('network').createAvdVirtualNetwork]",
                                    "toolTip": "Azure Virtual Desktop network resources (vNet, NSG, Route table) resource group custom name.",
                                    "placeholder": "Example: rg-avd-app1-dev-use2-network",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,90}$",
                                        "validationMessage": "Value must be 1-90 characters."
                                    }
                                },
                                {
                                    "name": "virtualNetworkCustomName",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Virtual network",
                                    "visible": "[steps('network').createAvdVirtualNetwork]",
                                    "toolTip": "Azure Virtual Desktop virtual network custom name.",
                                    "placeholder": "Example: vnet-app1-dev-use2-001",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,64}$",
                                        "validationMessage": "Value must be 1-64 characters."
                                    }
                                },
                                {
                                    "name": "virtualNetworkAvdSubnetCustomName",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Azure Virtual Desktop Subnet",
                                    "visible": "[steps('network').createAvdVirtualNetwork]",
                                    "toolTip": "Azure Virtual Desktop virtual network subnet custom name.",
                                    "placeholder": "Example: snet-avd-app1-dev-use2-001",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,80}$",
                                        "validationMessage": "Value must be 1-80 characters."
                                    }
                                },
                                {
                                    "name": "avdNetworkSecurityGroupCustomName",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Azure Virtual Desktop Network security group",
                                    "visible": "[steps('network').createAvdVirtualNetwork]",
                                    "toolTip": "Azure Virtual Desktop network security group custom name.",
                                    "placeholder": "Example: nsg-avd-app1-dev-use2-001",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,80}$",
                                        "validationMessage": "Value must be 1-80 characters."
                                    }
                                },
                                {
                                    "name": "avdRouteTableCustomName",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Azure Virtual Desktop Route table",
                                    "visible": "[steps('network').createAvdVirtualNetwork]",
                                    "toolTip": "Azure Virtual Desktop route table custom name.",
                                    "placeholder": "Example: route-avd-app1-dev-use2-001",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,80}$",
                                        "validationMessage": "Value must be 1-80 characters."
                                    }
                                },
                                {
                                    "name": "virtualNetworkPrivateEndpointSubnetCustomName",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Private endpoint subnet",
                                    "visible": "[steps('network').createAvdVirtualNetwork]",
                                    "toolTip": "Azure Virtual Desktop virtual network subnet custom name.",
                                    "placeholder": "Example: snet-pe-app1-dev-use2-001",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,80}$",
                                        "validationMessage": "Value must be 1-80 characters."
                                    }
                                },
                                {
                                    "name": "privateEndpointNetworkSecurityGroupCustomName",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Private endpoint network security group",
                                    "visible": "[steps('network').createAvdVirtualNetwork]",
                                    "toolTip": "Private endpoint network security group custom name.",
                                    "placeholder": "Example: nsg-pe-app1-dev-use2-001",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,80}$",
                                        "validationMessage": "Value must be 1-80 characters."
                                    }
                                },
                                {
                                    "name": "privateEndpointRouteTableCustomName",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Private endpoint route table",
                                    "visible": "[steps('network').createAvdVirtualNetwork]",
                                    "toolTip": "Private endpoint route table custom name.",
                                    "placeholder": "Example: route-pe-app1-dev-use2-001",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,80}$",
                                        "validationMessage": "Value must be 1-80 characters."
                                    }
                                }
                            ]
                        },
                        {
                            "name": "resourceNamingMonitoring",
                            "type": "Microsoft.Common.Section",
                            "visible": "[steps('resourceNaming').resourceNamingSelection]",
                            "label": "Monitoring naming:",
                            "elements": [
                                {
                                    "name": "resourceNamingMonitoringInfo",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": "[not(steps('monitoring').deployMonitoring)]",
                                    "options": {
                                        "text": "Current deployment configuration is not creating monitoring resources.",
                                        "style": "Info"
                                    }
                                },
                                {
                                    "name": "monitoringObjectsRgCustomName",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Resource group",
                                    "visible": "[and(equals(steps('resourceNaming').resourceNamingSelection, true), equals(steps('monitoring').deployMonitoring, true))]",
                                    "toolTip": "Azure Virtual Desktop monitoring resources (log analytics workspace) resource group custom name.",
                                    "placeholder": "Example: rg-avd-dev-use2-monitoring",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,90}$",
                                        "validationMessage": "Value must be 1-90 characters."
                                    }
                                },
                                {
                                    "name": "monitoringLogAnalyticsWorkspaceName",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Log analytics workspace name",
                                    "visible": "[and(equals(steps('resourceNaming').resourceNamingSelection, true), equals(steps('monitoring').deployMonitoring, true), equals(steps('monitoring').deployMonitoringAlaWorkspace, true))]",
                                    "toolTip": "Azure Virtual Desktop monitoring log analytics workspace custom name.",
                                    "placeholder": "Example: log-avd-dev-use2",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,90}$",
                                        "validationMessage": "Value must be 1-90 characters."
                                    }
                                }
                            ]
                        },
                        {
                            "name": "resourceNamingZeroTrust",
                            "type": "Microsoft.Common.Section",
                            "label": "Zero Trust naming:",
                            "visible": "[steps('resourceNaming').resourceNamingSelection]",
                            "elements": [
                                {
                                    "name": "resourceNamingZeroTrustInfo",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": "[not(steps('sessionHosts').sessionHostsSettingsSection.sessionHostDiskZeroTrust)]",
                                    "options": {
                                        "text": "Current deployment configuration is not creating zero trust resources.",
                                        "style": "Info"
                                    }
                                },
                                {
                                    "name": "zeroTrustObjectsDiskEncryptionSetCustomName",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Disk encryption set",
                                    "visible": "[and(steps('resourceNaming').resourceNamingSelection, steps('sessionHosts').sessionHostsSettingsSection.sessionHostDiskZeroTrust)]",
                                    "toolTip": "Disk encryption set resource for double encryption of session host disks.",
                                    "placeholder": "Example: des-zt",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,6}$",
                                        "validationMessage": "Value must be 1-90 characters."
                                    }
                                },
                                {
                                    "name": "zeroTrustObjectsKeyVaultCustomPrefix",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Key vault prefix",
                                    "visible": "[and(steps('resourceNaming').resourceNamingSelection, steps('sessionHosts').sessionHostsSettingsSection.sessionHostDiskZeroTrust)]",
                                    "toolTip": "Key Vault that stores the encryption key for disk encryption.",
                                    "placeholder": "Example: kv-key",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,6}$",
                                        "validationMessage": "Value must be 1-90 characters."
                                    }
                                },
                                {
                                    "name": "zeroTrustObjectsManagedIdentityCustomName",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "User assigned identity",
                                    "visible": "[and(steps('resourceNaming').resourceNamingSelection, steps('sessionHosts').sessionHostsSettingsSection.sessionHostDiskZeroTrust)]",
                                    "toolTip": "User assigned identity that enables server-side encryption and disables network access.",
                                    "placeholder": "Example: id-zt",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,5}$",
                                        "validationMessage": "Value must be 1-90 characters."
                                    }
                                }
                            ]
                        },
                        {
                            "name": "resourceNamingInfo2",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": "[steps('resourceNaming').resourceNamingSelection]",
                            "options": {
                                "text": "It is recommended to follow Microsoft Cloud Adoption Framework (CAF) naming convention.",
                                "uri": "https://docs.microsoft.com/azure/cloud-adoption-framework/ready/azure-best-practices/resource-naming",
                                "style": "Info"
                            }
                        }
                    ]
                },
                {
                    "name": "resourceTagging",
                    "label": "Resource tagging",
                    "type": "Microsoft.Common.Section",
                    "visible": true,
                    "elements": [
                        {
                            "name": "resourceTaggingSelection",
                            "type": "Microsoft.Common.CheckBox",
                            "visible": true,
                            "label": "Create resource tags",
                            "defaultValue": false,
                            "toolTip": "When selected, the information provided will be used to create tags on resources and resource groups."
                        },
                        {
                            "name": "resourceTaggingParentCostInfo",
                            "type": "Microsoft.Common.InfoBox",
                            "options": {
                                "text": "By default, the following tags will be created: <br/> - Parent resource cost management tag (cm-resource-parent): reports all resources cost to the host pool (ResourceID). <br/> - Environment (Environment): environment selected during deployment (Dev/Test/prod). <br/> - Service Workload (ServiceWorkload): defaults to Azure Virtual Desktop. <br/> - Creation time (CreationTimeUTC): deployment time in UTC. <br/> - Domain Name (DomainName): identity service domain name (applied only to compute and storage). <br/> - Identity service provider (IdentityServiceProvider): identity provider selected (ADDS/EntraDS/EntraID).",
                                "uri": "https://learn.microsoft.com/azure/virtual-desktop/tag-virtual-desktop-resources#use-the-cm-resource-parent-tag-to-automatically-group-costs-by-host-pool",
                                "style": "Info"
                            }
                        },
                        {
                            "name": "resourceTags",
                            "type": "Microsoft.Common.Section",
                            "label": "Resources tags:",
                            "visible": "[steps('resourceTagging').resourceTaggingSelection]",
                            "elements": [
                                {
                                    "name": "tagsWorkloadName",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Workload name:",
                                    "toolTip": "This input will be the value of a tag named WorkloadName.",
                                    "placeholder": "Example: Contoso-Workload",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,256}$",
                                        "validationMessage": "Value must be 1-256 characters."
                                    }
                                },
                                {
                                    "name": "tagsWorkloadType",
                                    "type": "Microsoft.Common.DropDown",
                                    "label": "Workload type:",
                                    "filter": true,
                                    "defaultValue": "Light",
                                    "toolTip": "This input will be the value of a tag named WorkloadType, reference to the size of the VM for your workloads.",
                                    "constraints": {
                                        "required": true,
                                        "allowedValues": [
                                            {
                                                "label": "Light",
                                                "description": "",
                                                "value": "Light"
                                            },
                                            {
                                                "label": "Medium",
                                                "description": "",
                                                "value": "Medium"
                                            },
                                            {
                                                "label": "High",
                                                "description": "",
                                                "value": "High"
                                            },
                                            {
                                                "label": "Power",
                                                "description": "",
                                                "value": "POwer"
                                            }
                                        ]
                                    }
                                },
                                {
                                    "name": "tagsDataClassificationTag",
                                    "type": "Microsoft.Common.DropDown",
                                    "label": "Data classification:",
                                    "filter": true,
                                    "defaultValue": "Non-business",
                                    "toolTip": "This input will be the value of a tag named DataClassification, reference to the sensitivity of data hosted.",
                                    "constraints": {
                                        "required": true,
                                        "allowedValues": [
                                            {
                                                "label": "Non-business",
                                                "description": "",
                                                "value": "Non-business"
                                            },
                                            {
                                                "label": "Public",
                                                "description": "",
                                                "value": "Public"
                                            },
                                            {
                                                "label": "General",
                                                "description": "",
                                                "value": "General"
                                            },
                                            {
                                                "label": "Confidential",
                                                "description": "",
                                                "value": "Confidential"
                                            },
                                            {
                                                "label": "Highly-confidential",
                                                "description": "",
                                                "value": "Highly-confidential"
                                            }
                                        ]
                                    }
                                },
                                {
                                    "name": "tagsDepartmentTag",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Department:",
                                    "toolTip": "This input will be the value of a tag named Department, reference the department that owns the deployment.",
                                    "placeholder": "Example: Contoso-AVD",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,256}$",
                                        "validationMessage": "Value must be 1-256 characters."
                                    }
                                },
                                {
                                    "name": "tagsCriticalityTag",
                                    "type": "Microsoft.Common.DropDown",
                                    "label": "Workload criticality:",
                                    "filter": true,
                                    "defaultValue": "Low",
                                    "toolTip": "This input will be the value of a tag named Criticality, reference to the criticality of the workload.",
                                    "constraints": {
                                        "required": true,
                                        "allowedValues": [
                                            {
                                                "label": "Low",
                                                "description": "",
                                                "value": "Low"
                                            },
                                            {
                                                "label": "Medium",
                                                "description": "",
                                                "value": "Medium"
                                            },
                                            {
                                                "label": "High",
                                                "description": "",
                                                "value": "High"
                                            },
                                            {
                                                "label": "Mission-critical",
                                                "description": "",
                                                "value": "Mission-critical"
                                            },
                                            {
                                                "label": "Custom",
                                                "description": "",
                                                "value": "Custom"
                                            }
                                        ]
                                    }
                                },
                                {
                                    "name": "tagsCustomWorkloadCriticality",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Custom workload criticality:",
                                    "visible": "[equals(steps('resourceTagging').resourceTags.tagsCriticalityTag, 'Custom')]",
                                    "toolTip": "This input will be the value of a tag named Criticality, reference to a custom criticality for the workload.",
                                    "placeholder": "Example: Contoso-Criticality",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,256}$",
                                        "validationMessage": "Value must be 1-256 characters."
                                    }
                                },
                                {
                                    "name": "tagsApplicationNameTag",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Application name:",
                                    "toolTip": "This input will be the value of a tag named ApplicationName, reference details about the application.",
                                    "placeholder": "Example: Contoso-App",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,256}$",
                                        "validationMessage": "Value must be 1-256 characters."
                                    }
                                },
                                {
                                    "name": "tagsWorkloadSlaTag",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Workload SLA:",
                                    "toolTip": "This input will be the value of a tag named ServiceClass, reference to the service level agreement level of the worload.",
                                    "placeholder": "Example: Contoso-SLA",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,256}$",
                                        "validationMessage": "Value must be 1-256 characters."
                                    }
                                },
                                {
                                    "name": "tagsOpsTeamTag",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Operations team:",
                                    "toolTip": "This input will be the value of a tag named OpsTeam, reference to the team accountable for day-to-day operations.",
                                    "placeholder": "Example: workload-admins@Contoso.com",
                                    "constraints": {
                                        "required": true
                                    }
                                },
                                {
                                    "name": "tagsOwnerTag",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Owner:",
                                    "toolTip": "This input will be the value of a tag named Owner, reference to the organizational owner of the Azure Virtual Desktop deployment.",
                                    "placeholder": "Example: workload-owner@Contoso.com",
                                    "constraints": {
                                        "required": true
                                    }
                                },
                                {
                                    "name": "tagsCostCenterTag",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Cost center:",
                                    "toolTip": "This input will be the value of a tag named CostCenter, reference to the cost center of owner team.",
                                    "placeholder": "Example: Contoso-CC",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,256}$",
                                        "validationMessage": "Value must be 1-256 characters."
                                    }
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        "outputs": {
            "parameters": {
                "deploymentPrefix": "[steps('basics').deploymentSpecs.deploymentPrefix]",
                "deploymentEnvironment": "[steps('basics').deploymentSpecs.deploymentEnvironment]",
                "diskZeroTrust": "[steps('sessionHosts').sessionHostsSettingsSection.sessionHostDiskZeroTrust]",
                "avdManagementPlaneLocation": "[steps('basics').resourceScope.location.name]",
                "avdSessionHostLocation": "[if(equals(steps('sessionHosts').deploySessionHosts, true), steps('sessionHosts').sessionHostsRegionSection.sessionHostsRegion, steps('basics').resourceScope.location.name)]",
                "avdWorkloadSubsId": "[steps('basics').resourceScope.subscription.subscriptionId]",
                "avdHostPoolType": "[steps('managementPlane').managementPlaneHostPoolSettings.hostPoolType]",
                "hostPoolPreferredAppGroupType": "[if(equals(steps('managementPlane').managementPlaneHostPoolSettings.hostPoolType, 'Pooled'), steps('managementPlane').managementPlaneAppGroupOptions.preferredAppGroupType, 'Desktop')]",
                "avdHostPoolLoadBalancerType": "[steps('managementPlane').managementPlaneHostPoolSettings.loadBalancerType]",
                "hostPoolMaxSessions": "[if(equals(steps('managementPlane').managementPlaneHostPoolSettings.hostPoolType, 'Pooled'), steps('managementPlane').managementPlaneHostPoolSettings.maxSessions, 1)]",
                "avdPersonalAssignType": "[if(equals(steps('managementPlane').managementPlaneHostPoolSettings.hostPoolType, 'Personal'), steps('managementPlane').managementPlaneHostPoolSettings.assignmentType, 'Automatic')]",
                "avdIdentityServiceProvider": "[steps('identity').identityDomainInformation.identityServiceProvider]",
                "createIntuneEnrollment": "[if(equals(steps('identity').identityDomainInformation.identityServiceProvider, 'EntraID'), steps('identity').identityDomainInformation.identityServiceProviderIntuneEnrollment, false)]",
                "identityDomainName": "[if(equals(steps('identity').identityDomainInformation.identityDomainName, ''), 'none', steps('identity').identityDomainInformation.identityDomainName)]",
                "identityDomainGuid": "[steps('identity').identityDomainInformation.identityDomainGuid]",
                "avdOuPath": "[if(equals(steps('identity').identityDomainInformation.identityServiceProvider, 'EntraID'), 'no', steps('sessionHosts').sessionHostsComputeStorageSection.identityDomainOuPath)]",
                "avdDomainJoinUserName": "[if(equals(steps('identity').identityDomainInformation.identityServiceProvider, 'EntraID'), 'no', steps('identity').identityDomainCredentials.identityDomainJoinUserName)]",
                "avdDomainJoinUserPassword": "[if(equals(steps('identity').identityDomainInformation.identityServiceProvider, 'EntraID'), 'no', steps('identity').identityDomainCredentials.identityDomainJoinUserPassword)]",
                "avdVmLocalUserName": "[steps('identity').identityLocalCredentials.identityLocalUserName]",
                "avdVmLocalUserPassword": "[steps('identity').identityLocalCredentials.identityLocalUserPassword.password]",
                "createAvdVnet": "[steps('network').createAvdVirtualNetwork]",
                "avdVnetworkAddressPrefixes": "[if(equals(steps('network').createAvdVirtualNetwork, true), steps('network').virtualNetworkSize, '10.10.1.0/24')]",
                "vNetworkAvdSubnetAddressPrefix": "[if(equals(steps('network').createAvdVirtualNetwork, true), steps('network').virtualNetworkAvdSubnetSize, '10.10.2.0/27')]",
                "vNetworkPrivateEndpointSubnetAddressPrefix": "[if(and(equals(steps('network').createAvdVirtualNetwork, true), equals(steps('network').deployPrivateEndpointKeyvaultStorage, true)), steps('network').virtualNetworkPrivateEndpointSubnetSize, '10.10.1.0/27')]",
                "customDnsIps": "[if(equals(steps('network').createAvdVirtualNetwork, true), steps('network').virtualNetworkDns, '')]",
                "existingHubVnetResourceId": "[if(equals(steps('network').createAvdVirtualNetwork, true), steps('network').hubVirtualNetworkPeering.existingHubVirtualNetwork, '')]",
                "vNetworkGatewayOnHub": "[if(equals(steps('network').createAvdVirtualNetwork, true), steps('network').hubVirtualNetworkPeering.hubVirtualNetworkGateway, false)]",
                "existingVnetAvdSubnetResourceId": "[if(equals(steps('network').createAvdVirtualNetwork, false), steps('network').virtualNetworkAvdSubnetSelectorName, 'no')]",
                "existingVnetPrivateEndpointSubnetResourceId": "[if(equals(steps('network').createAvdVirtualNetwork, false), steps('network').virtualNetworkPrivateEndpointSubnetSelectorName, 'no')]",
                "avdDeploySessionHosts": "[steps('sessionHosts').deploySessionHosts]",
                "avdStartVmOnConnect": "[steps('managementPlane').managementPlaneHostPoolScaling.startVmOnConnect]",
                "avdDeployScalingPlan": "[if(contains(steps('basics').resourceScope.location.name, 'china'), false, steps('managementPlane').managementPlaneHostPoolScaling.scalingPlan)]",
                "avdEnterpriseAppObjectId": "[first(map(steps('managementPlane').managementPlaneHostPoolScaling.avdEnterpriseApplication.value, (item) => item.id))]",
                "availabilityZonesCompute": "[if(equals(steps('sessionHosts').deploySessionHosts, true), steps('sessionHosts').sessionHostsRegionSection.sessionHostsAvailabilitySettings, false)]",
                "zoneRedundantStorage": "[if(or(steps('storage').storageFslogix.fslogixDeployment, steps('storage').storageAppAttach.appAttachStorageDeployment), steps('storage').storageGeneralSettings.storageGeneralSettingsZoneRedundancy, false)]",
                "avdDeploySessionHostsCount": "[if(equals(steps('sessionHosts').deploySessionHosts, true), steps('sessionHosts').sessionHostsSettingsSection.sessionHostsCount, 1)]",
                "useSharedImage": "[if(equals(steps('sessionHosts').deploySessionHosts, true), steps('sessionHosts').sessionHostsOsSection.sessionHostsImageSource, false)]",
                "avdOsImage": "[if(equals(steps('sessionHosts').sessionHostsOsSection.sessionHostsImageSource, false), steps('sessionHosts').sessionHostsOsSection.sessionHostsOsImage, 'win11_23h2')]",
                "securityType": "[if(and(or(contains(steps('sessionHosts').sessionHostsOsSection.sessionHostsOsImage, 'win11'), contains(steps('sessionHosts').sessionHostsOsSection.sessionHostsOsImage, 'g2')), empty(steps('sessionHosts').sessionHostsOsSection.sessionHostsComputeGalleryImage)), steps('sessionHosts').sessionHostsSecuritySection.securityType, 'Standard')]",
                "secureBootEnabled": "[if(and(or(contains(steps('sessionHosts').sessionHostsOsSection.sessionHostsOsImage, 'win11'), contains(steps('sessionHosts').sessionHostsOsSection.sessionHostsOsImage, 'g2')), empty(steps('sessionHosts').sessionHostsOsSection.sessionHostsComputeGalleryImage)), steps('sessionHosts').sessionHostsSecuritySection.secureBootEnabled, false)]",
                "vTpmEnabled": "[if(and(or(contains(steps('sessionHosts').sessionHostsOsSection.sessionHostsOsImage, 'win11'), contains(steps('sessionHosts').sessionHostsOsSection.sessionHostsOsImage, 'g2')), empty(steps('sessionHosts').sessionHostsOsSection.sessionHostsComputeGalleryImage)), steps('sessionHosts').sessionHostsSecuritySection.vTpmEnabled, false)]",
                "deployAntiMalwareExt": "[if(equals(steps('sessionHosts').deploySessionHosts, true), steps('sessionHosts').sessionHostsSecuritySection.enableAntiMalwareExt, true)]",
                "avdImageTemplateDefinitionId": "[if(equals(steps('sessionHosts').sessionHostsOsSection.sessionHostsImageSource, true), steps('sessionHosts').sessionHostsOsSection.sessionHostsComputeGalleryImage.id, 'no')]",
                "avdSessionHostDiskType": "[steps('sessionHosts').sessionHostsSettingsSection.sessionHostDiskType]",
                "enableAcceleratedNetworking": "[steps('sessionHosts').sessionHostsSettingsSection.acceleratedNetworking]",
                "avdSessionHostsSize": "[if(equals(steps('sessionHosts').deploySessionHosts, true), steps('sessionHosts').sessionHostsSettingsSection.sessionHostSize, 'Standard_D4ads_v5')]",
                "deployDDoSNetworkProtection": "[steps('network').deployDDoSNetworkProtection]",
                "deployPrivateEndpointKeyvaultStorage": "[steps('network').deployPrivateEndpointKeyvaultStorage]",
                "deployAvdPrivateLinkService": "[steps('network').deployAvdPrivateLinkService]",
                "hostPoolPublicNetworkAccess": "[if(equals(steps('network').deployAvdPrivateLinkService, true), steps('network').hostPoolPrivateEndpointNetworkAccessSelector, 'Enabled')]",
                "workspacePublicNetworkAccess": "[if(equals(steps('network').deployAvdPrivateLinkService, true), steps('network').workspacePrivateEndpointNetworkAccessSelector, 'Enabled')]",
                "createPrivateDnsZones": "[steps('network').virtualNetworkPrivateDnsZone]",
                "avdVnetPrivateDnsZoneFilesId": "[if(and(equals(steps('network').deployPrivateEndpointKeyvaultStorage, true), equals(steps('network').virtualNetworkPrivateDnsZone, false)), steps('network').virtualNetworkPrivateDnsZoneSelection.virtualNetworkPrivateDnsZoneFilesSelector.id, '')]",
                "avdVnetPrivateDnsZoneKeyvaultId": "[if(and(equals(steps('network').deployPrivateEndpointKeyvaultStorage, true), equals(steps('network').virtualNetworkPrivateDnsZone, false)), steps('network').virtualNetworkPrivateDnsZoneSelection.virtualNetworkPrivateDnsZoneKeyvaultSelector.id, '')]",
                "avdVnetPrivateDnsZoneDiscoveryResourceId": "[if(and(equals(steps('network').deployAvdPrivateLinkService, true), equals(steps('network').virtualNetworkPrivateDnsZone, false)), steps('network').virtualNetworkPrivateDnsZoneSelection.virtualNetworkPrivateDnsZoneAvdDiscoverySelector.id, '')]",
                "avdVnetPrivateDnsZoneConnectionResourceId": "[if(and(equals(steps('network').deployAvdPrivateLinkService, true), equals(steps('network').virtualNetworkPrivateDnsZone, false)), steps('network').virtualNetworkPrivateDnsZoneSelection.virtualNetworkPrivateDnsZoneAvdConnectionSelector.id, '')]",
                "createAvdFslogixDeployment": "[steps('storage').storageFslogix.fslogixDeployment]",
                "fslogixStoragePerformance": "[if(equals(steps('storage').storageFslogix.fslogixDeployment, true), steps('storage').storageFslogix.fslogixStorageAccountSku, 'Premium')]",
                "fslogixFileShareQuotaSize": "[if(equals(steps('storage').storageFslogix.fslogixDeployment, true), steps('storage').storageFslogix.sessionHostsFslogixFileShareQuota, 1 )]",
                "createAppAttachDeployment": "[if(equals(steps('storage').storageAppAttach.appAttachStorageDeployment, true), if(contains(steps('basics').resourceScope.location.name, 'china'), false, steps('storage').storageAppAttach.appAttachStorageDeployment), false)]",
                "appAttachStoragePerformance": "[if(equals(steps('storage').storageAppAttach.appAttachStorageDeployment, true), steps('storage').storageAppAttach.appAttachStorageAccountSku, 'Premium')]",
                "appAttachFileShareQuotaSize": "[if(equals(steps('storage').storageAppAttach.appAttachStorageDeployment, true), steps('storage').storageAppAttach.sessionHostsAppAttachFileShareQuota, 1 )]",
                "storageOuPath": "[if(or(steps('storage').storageFslogix.fslogixDeployment, steps('storage').storageAppAttach.appAttachStorageDeployment), steps('storage').storageGeneralSettings.identityDomainOuPathStorageExisting, '')]",
                "avdUseCustomNaming": "[steps('resourceNaming').resourceNamingSelection]",
                "avdServiceObjectsRgCustomName": "[if(equals(steps('resourceNaming').resourceNamingSelection, true), steps('resourceNaming').resourceNamingAvdManagementPlane.serviceObjectsRgCustomName, 'no')]",
                "avdNetworkObjectsRgCustomName": "[if(equals(steps('resourceNaming').resourceNamingSelection, true), steps('resourceNaming').resourceNamingNetwork.networkObjectsRgCustomName, 'no')]",
                "avdComputeObjectsRgCustomName": "[if(equals(steps('resourceNaming').resourceNamingSelection, true), steps('resourceNaming').resourceNamingCompute.computeObjectsRgCustomName, 'no')]",
                "avdStorageObjectsRgCustomName": "[if(equals(steps('resourceNaming').resourceNamingSelection, true), steps('resourceNaming').resourceNamingStorage.storageObjectsRgCustomName, 'no')]",
                "avdVnetworkCustomName": "[if(equals(steps('resourceNaming').resourceNamingSelection, true), steps('resourceNaming').resourceNamingNetwork.virtualNetworkCustomName, 'no')]",
                "avdVnetworkSubnetCustomName": "[if(equals(steps('resourceNaming').resourceNamingSelection, true), steps('resourceNaming').resourceNamingNetwork.virtualNetworkAvdSubnetCustomName, 'no')]",
                "avdNetworksecurityGroupCustomName": "[if(equals(steps('resourceNaming').resourceNamingSelection, true), steps('resourceNaming').resourceNamingNetwork.avdNetworkSecurityGroupCustomName, 'no')]",
                "avdRouteTableCustomName": "[if(equals(steps('resourceNaming').resourceNamingSelection, true), steps('resourceNaming').resourceNamingNetwork.avdRouteTableCustomName, 'no')]",
                "privateEndpointVnetworkSubnetCustomName": "[if(equals(steps('resourceNaming').resourceNamingSelection, true), steps('resourceNaming').resourceNamingNetwork.virtualNetworkPrivateEndpointSubnetCustomName, 'no')]",
                "privateEndpointNetworksecurityGroupCustomName": "[if(equals(steps('resourceNaming').resourceNamingSelection, true), steps('resourceNaming').resourceNamingNetwork.privateEndpointNetworkSecurityGroupCustomName, 'no')]",
                "privateEndpointRouteTableCustomName": "[if(equals(steps('resourceNaming').resourceNamingSelection, true), steps('resourceNaming').resourceNamingNetwork.privateEndpointRouteTableCustomName, 'no')]",
                "avdApplicationSecurityGroupCustomName": "[if(equals(steps('resourceNaming').resourceNamingSelection, true), steps('resourceNaming').resourceNamingCompute.applicationSecurityGroupCustomName, 'no')]",
                "avdWorkSpaceCustomName": "[if(equals(steps('resourceNaming').resourceNamingSelection, true), steps('resourceNaming').resourceNamingAvdManagementPlane.workSpaceCustomName, 'no')]",
                "avdWorkSpaceCustomFriendlyName": "[if(equals(steps('resourceNaming').resourceNamingSelection, true), steps('resourceNaming').resourceNamingAvdManagementPlane.workSpaceCustomFriendlyName, 'no')]",
                "avdHostPoolCustomName": "[if(equals(steps('resourceNaming').resourceNamingSelection, true), steps('resourceNaming').resourceNamingAvdManagementPlane.hostPoolCustomName, 'no')]",
                "avdHostPoolCustomFriendlyName": "[if(equals(steps('resourceNaming').resourceNamingSelection, true), steps('resourceNaming').resourceNamingAvdManagementPlane.hostPoolCustomFriendlyName, 'no')]",
                "avdScalingPlanCustomName": "[if(equals(steps('resourceNaming').resourceNamingSelection, true), steps('resourceNaming').resourceNamingAvdManagementPlane.scalingPlanCustomName, 'no')]",
                "avdApplicationGroupCustomName": "[if(equals(steps('resourceNaming').resourceNamingSelection, true), steps('resourceNaming').resourceNamingAvdManagementPlane.applicationGroupCustomName, 'no')]",
                "avdApplicationGroupCustomFriendlyName": "[if(equals(steps('resourceNaming').resourceNamingSelection, true), steps('resourceNaming').resourceNamingAvdManagementPlane.applicationGroupCustomFriendlyName, 'no')]",
                "avdSessionHostCustomNamePrefix": "[if(equals(steps('resourceNaming').resourceNamingSelection, true), steps('resourceNaming').resourceNamingCompute.sessionHostCustomNamePrefix, 'no')]",
                "storageAccountPrefixCustomName": "[if(equals(steps('resourceNaming').resourceNamingSelection, true), steps('resourceNaming').resourceNamingStorage.storageAccountPrefixCustomName, 'no')]",
                "fslogixFileShareCustomName": "[if(equals(steps('resourceNaming').resourceNamingSelection, true), steps('resourceNaming').resourceNamingStorage.fslogixFileShareCustomName, 'no')]",
                "appAttachFileShareCustomName": "[if(equals(steps('resourceNaming').resourceNamingSelection, true), steps('resourceNaming').resourceNamingStorage.appAttachFileShareCustomName, 'no')]",
                "avdWrklKvPrefixCustomName": "[if(equals(steps('resourceNaming').resourceNamingSelection, true), steps('resourceNaming').resourceNamingAvdManagementPlane.workloadKvCustomName, 'no')]",
                "createResourceTags": "[steps('resourceTagging').resourceTaggingSelection]",
                "workloadNameTag": "[if(equals(steps('resourceTagging').resourceTaggingSelection, true), steps('resourceTagging').resourceTags.tagsWorkloadName, 'no')]",
                "workloadTypeTag": "[if(equals(steps('resourceTagging').resourceTaggingSelection, true), steps('resourceTagging').resourceTags.tagsWorkloadType, 'Light')]",
                "dataClassificationTag": "[if(equals(steps('resourceTagging').resourceTaggingSelection, true), steps('resourceTagging').resourceTags.tagsDataClassificationTag, 'Non-business')]",
                "departmentTag": "[if(equals(steps('resourceTagging').resourceTaggingSelection, true), steps('resourceTagging').resourceTags.tagsDepartmentTag, 'no')]",
                "workloadCriticalityTag": "[if(equals(steps('resourceTagging').resourceTaggingSelection, true), steps('resourceTagging').resourceTags.tagsCriticalityTag, 'Low')]",
                "workloadCriticalityCustomValueTag": "[if(equals(steps('resourceTagging').resourceTags.tagsCriticalityTag, 'Custom'), steps('resourceTagging').resourceTags.tagsCustomWorkloadCriticality, 'Low')]",
                "applicationNameTag": "[if(equals(steps('resourceTagging').resourceTaggingSelection, true), steps('resourceTagging').resourceTags.tagsApplicationNameTag, 'no')]",
                "workloadSlaTag": "[if(equals(steps('resourceTagging').resourceTaggingSelection, true), steps('resourceTagging').resourceTags.tagsWorkloadSlaTag, 'no')]",
                "opsTeamTag": "[if(equals(steps('resourceTagging').resourceTaggingSelection, true), steps('resourceTagging').resourceTags.tagsOpsTeamTag, 'no')]",
                "ownerTag": "[if(equals(steps('resourceTagging').resourceTaggingSelection, true), steps('resourceTagging').resourceTags.tagsOwnerTag, 'no')]",
                "costCenterTag": "[if(equals(steps('resourceTagging').resourceTaggingSelection, true), steps('resourceTagging').resourceTags.tagsCostCenterTag, 'no')]",
                "securityPrincipalId": "[if(steps('identity').identityAvdAccess.identityAvdUserAccessGroupCheckBox, steps('identity').identityAvdAccess.identityAvdUserAccessGroupTextBox2, steps('identity').identityAvdAccess.identityAvdUserAccessGroupDropDown.id)]",
                "securityPrincipalName": "[if(steps('identity').identityAvdAccess.identityAvdUserAccessGroupCheckBox, steps('identity').identityAvdAccess.identityAvdUserAccessGroupTextBox1, steps('identity').identityAvdAccess.identityAvdUserAccessGroupDropDown.name)]",
                "avdDeployMonitoring": "[steps('monitoring').deployMonitoring]",
                "deployAlaWorkspace": "[if(equals(steps('monitoring').deployMonitoring, true), steps('monitoring').deployMonitoringAlaWorkspace, false)]",
                "avdAlaWorkspaceDataRetention": "[if(equals(steps('monitoring').deployMonitoringAlaWorkspace, true), steps('monitoring').deployMonitoringNewAlaWorkspaceRetention, 0)]",
                "alaExistingWorkspaceResourceId": "[if(equals(steps('monitoring').deployMonitoringAlaWorkspace, false), steps('monitoring').alaWorkspaceExistingWorkspacesSelection.id, 'no')]",
                "deployCustomPolicyMonitoring": "[if(equals(steps('monitoring').deployMonitoring, true), steps('monitoring').deployMonitoringPolicies, false)]",
                "avdMonitoringRgCustomName": "[if(equals(steps('resourceNaming').resourceNamingSelection, true), steps('resourceNaming').resourceNamingMonitoring.monitoringObjectsRgCustomName, 'no')]",
                "avdAlaWorkspaceCustomName": "[if(equals(steps('resourceNaming').resourceNamingSelection, true), steps('resourceNaming').resourceNamingMonitoring.monitoringLogAnalyticsWorkspaceName, 'no')]",
                "ztDiskEncryptionSetCustomNamePrefix": "[steps('resourceNaming').resourceNamingZeroTrust.zeroTrustObjectsDiskEncryptionSetCustomName]",
                "ztKvPrefixCustomName ": "[steps('resourceNaming').resourceNamingZeroTrust.zeroTrustObjectsKeyVaultCustomPrefix]",
                "ztManagedIdentityCustomName": "[steps('resourceNaming').resourceNamingZeroTrust.zeroTrustObjectsManagedIdentityCustomName]",
                "deployGpuPolicies": "[steps('sessionHosts').sessionHostsSettingsSection.gpuExtensionPolicy]",
                "enableDef": "[steps('identity').identiyEnableDefOptions.enableDef]",
                "enableDefForServers": "[if(equals(steps('identity').identiyEnableDefOptions.enableDef, true), steps('identity').identiyEnableDefOptions.enableDefForServers, false)]",
                "enableDefForStorage": "[if(equals(steps('identity').identiyEnableDefOptions.enableDef, true), steps('identity').identiyEnableDefOptions.enableDefForStorage, false)]",
                "enableDefForKeyVault": "[if(equals(steps('identity').identiyEnableDefOptions.enableDef, true), steps('identity').identiyEnableDefOptions.enableDefForKeyVault, false)]",
                "enableDefForArm": "[if(equals(steps('identity').identiyEnableDefOptions.enableDef, true), steps('identity').identiyEnableDefOptions.enableDefForArm, false)]"
            },
            "kind": "Subscription",
            "location": "[steps('basics').resourceScope.location.name]",
            "subscriptionId": "[steps('basics').resourceScope.subscription.id]"
        }
    }
}