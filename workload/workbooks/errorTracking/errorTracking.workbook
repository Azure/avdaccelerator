{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "crossComponentResources": [
          "value::all"
        ],
        "parameters": [
          {
            "id": "a36f0b3d-8826-4bec-95a9-70ec6cb77713",
            "version": "KqlParameterItem/1.0",
            "name": "Subscriptions",
            "type": 6,
            "isRequired": true,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "where type startswith 'Microsoft.DesktopVirtualization/'\r\n    | summarize Count = count() by subscriptionId\r\n    | order by Count desc\r\n    | extend Rank = row_number()\r\n    | project value = subscriptionId, label = subscriptionId, selected = Rank == 1",
            "crossComponentResources": [
              "value::all"
            ],
            "typeSettings": {
              "additionalResourceOptions": [
                "value::1",
                "value::10",
                "value::50",
                "value::all"
              ],
              "showDefault": false
            },
            "defaultValue": "value::10",
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources",
            "value": [
              "value::all"
            ]
          },
          {
            "id": "f4701e4b-6f1e-46af-9d9a-869df465a153",
            "version": "KqlParameterItem/1.0",
            "name": "TimeRange",
            "type": 4,
            "isRequired": true,
            "typeSettings": {
              "selectableValues": [
                {
                  "durationMs": 300000
                },
                {
                  "durationMs": 900000
                },
                {
                  "durationMs": 1800000
                },
                {
                  "durationMs": 3600000
                },
                {
                  "durationMs": 14400000
                },
                {
                  "durationMs": 43200000
                },
                {
                  "durationMs": 86400000
                },
                {
                  "durationMs": 172800000
                },
                {
                  "durationMs": 259200000
                },
                {
                  "durationMs": 604800000
                },
                {
                  "durationMs": 1209600000
                },
                {
                  "durationMs": 2419200000
                },
                {
                  "durationMs": 2592000000
                },
                {
                  "durationMs": 5184000000
                },
                {
                  "durationMs": 7776000000
                }
              ],
              "allowCustom": true
            },
            "value": {
              "durationMs": 172800000
            }
          },
          {
            "id": "c99821d9-c77f-4b71-8514-eab0ff5c1c7d",
            "version": "KqlParameterItem/1.0",
            "name": "Workspaces",
            "type": 5,
            "isRequired": true,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "resources | where type =~ 'microsoft.operationalinsights/workspaces'\r\n| distinct id",
            "crossComponentResources": [
              "value::all"
            ],
            "typeSettings": {
              "additionalResourceOptions": [
                "value::1",
                "value::5",
                "value::all"
              ],
              "showDefault": false
            },
            "defaultValue": "value::5",
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources",
            "value": [
              "value::all"
            ]
          },
          {
            "id": "998eb7b0-964c-4e24-b254-2e6ed77eeb0f",
            "version": "KqlParameterItem/1.0",
            "name": "Top",
            "label": "Top Errors",
            "type": 2,
            "isRequired": true,
            "typeSettings": {
              "additionalResourceOptions": []
            },
            "jsonData": "[\r\n { \"value\": \"10\", \"label\": \"10\"},\r\n { \"value\": \"20\", \"label\": \"20\", \"selected\":true },\r\n { \"value\": \"30\", \"label\": \"30\"},\r\n { \"value\": \"40\", \"label\": \"40\"},\r\n { \"value\": \"50\", \"label\": \"50\"},\r\n { \"value\": \"60\", \"label\": \"60\"},\r\n { \"value\": \"70\", \"label\": \"70\"},\r\n { \"value\": \"80\", \"label\": \"80\"},\r\n { \"value\": \"90\", \"label\": \"90\"},\r\n { \"value\": \"100\", \"label\": \"100\"}\r\n]",
            "timeContext": {
              "durationMs": 0
            },
            "timeContextFromParameter": "TimeRange",
            "value": "30"
          }
        ],
        "style": "pills",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources"
      },
      "name": "parameters - 8"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "d84e9ed8-78b4-4266-83de-70e0df606b01",
            "version": "KqlParameterItem/1.0",
            "name": "help",
            "label": "Show Help",
            "type": 2,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "jsonData": "[\r\n { \"label\": \"Yes\", \"value\": \"yes\"},\r\n { \"label\": \"No\", \"value\": \"no\", \"selected\":true },\r\n {\"label\": \"Change Log\", \"value\": \"Change Log\"}\r\n]",
            "timeContext": {
              "durationMs": 86400000
            }
          }
        ],
        "style": "above",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "name": "parameters - 10"
    },
    {
      "type": 1,
      "content": {
        "json": "## AVD Error Troubleshooting\r\n\r\nThis workbook is designed to help find errors, trends, users experiencing many errors etc. \r\n\r\n### Tabs\r\nEach tab breaks the workbook into specific sections, each with their own goal.\r\n\r\n#### Overview \r\nHigh level view of errors, errors by region, errors by top 5 users, code symbolic, & Hostpool. As well as alerts found in AVD related subscriptions*\r\n\r\nIt is possible alerts unrelated to AVD show up, as alerts can be setup and homed in any Subscription. Further refinement may be needed on finding alerts related to only AVD resources.\r\n\r\n#### User Performance\r\nDisplays metrics related to User Profile size, Profile load time, logon time, RTT Metrics.\r\n\r\n#### Errors\r\nOffers three experiences. One is \"guided\" where by the user can select the specific error source, hostpool etc. All tiles are selectable and change the subsequent queries.\r\n\r\nThe second option is \"search\" which allows a user to search the logs by a CorrelationID or a Username and then displays information for that user, and all the logs for that CorrelationId session or User, depending on what was entered into the text box.\r\n\r\nThe third option also allows entering a username or CorrelationId, but it is not required. It allows parameter selection of WVD logs and then creates a dynamic list of session hosts based on the error(s) selected and brings in the Event logs for those session hosts.",
        "style": "success"
      },
      "conditionalVisibility": {
        "parameterName": "help",
        "comparison": "isEqualTo",
        "value": "yes"
      },
      "name": "text - 12"
    },
    {
      "type": 11,
      "content": {
        "version": "LinkItem/1.0",
        "style": "tabs",
        "links": [
          {
            "id": "268bb2a7-2741-49eb-9bd9-3f39f6125bf3",
            "cellValue": "tab",
            "linkTarget": "parameter",
            "linkLabel": "Overview",
            "subTarget": "inventory",
            "style": "link"
          },
          {
            "id": "960e8a31-2d71-4f5e-9b4c-78c079b94583",
            "cellValue": "tab",
            "linkTarget": "parameter",
            "linkLabel": "User Performance",
            "subTarget": "user",
            "style": "link"
          },
          {
            "id": "1bc33fa0-1a45-4dc5-afa7-68416d86e9af",
            "cellValue": "tab",
            "linkTarget": "parameter",
            "linkLabel": "Errors",
            "subTarget": "logs",
            "style": "link"
          }
        ]
      },
      "name": "links - 2"
    },
    {
      "type": 1,
      "content": {
        "json": "## How to Use the Errors Tab\r\n\r\nThe errors tab offers the ability to do a guided search of logs. Search provides the ability to search by a CorrelationId OR a User.",
        "style": "success"
      },
      "conditionalVisibilities": [
        {
          "parameterName": "tab",
          "comparison": "isEqualTo",
          "value": "logs"
        },
        {
          "parameterName": "help",
          "comparison": "isEqualTo",
          "value": "yes"
        }
      ],
      "name": "text - 8"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "e9a159aa-9ca1-4d54-8f40-71953f987274",
            "version": "KqlParameterItem/1.0",
            "name": "errors",
            "label": "View Errors by:",
            "type": 2,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "jsonData": "[{\"label\":\"Guided\",\"value\":\"guided\"},\r\n{\"label\":\"search\",\"value\":\"search\"},\r\n{\"label\":\"Event\",\"value\":\"event\"}]",
            "timeContext": {
              "durationMs": 86400000
            },
            "value": "event"
          }
        ],
        "style": "above",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "conditionalVisibility": {
        "parameterName": "tab",
        "comparison": "isEqualTo",
        "value": "logs"
      },
      "name": "parameters - 9"
    },
    {
      "type": 1,
      "content": {
        "json": "## Guided Log Search\r\n\r\nEverything on the guided view is clickable. For example, selecting an Error by Source, will adjust the Errors by Hostpools, and Errors by Gateway Regions view, as well as the Top Errors by User and Top Errors by Sessionhosts.\r\n\r\nYou can also click on a Hostpool and or a Gateway Region and this will subsequently adjust the queries beneath them. Like the Top Errors by User and Top Errors by Sessionhosts.\r\n\r\nFinally you can click on UserNames or Sessionhosts and that will load the logs view below.",
        "style": "success"
      },
      "conditionalVisibilities": [
        {
          "parameterName": "tab",
          "comparison": "isEqualTo",
          "value": "logs"
        },
        {
          "parameterName": "help",
          "comparison": "isEqualTo",
          "value": "yes"
        },
        {
          "parameterName": "errors",
          "comparison": "isEqualTo",
          "value": "guided"
        }
      ],
      "name": "text - 9"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "crossComponentResources": [
                "{Workspaces}"
              ],
              "parameters": [
                {
                  "id": "bae136ae-c1c9-45c8-936e-18b70adbe5b3",
                  "version": "KqlParameterItem/1.0",
                  "name": "searchBy",
                  "label": "Enter CorrelationId or UserName",
                  "type": 1,
                  "description": "Search by CorrelationId or UserName",
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "value": ""
                },
                {
                  "id": "7150044f-7ed1-4121-9867-5710f7a0cac1",
                  "version": "KqlParameterItem/1.0",
                  "name": "userMatch",
                  "type": 1,
                  "query": "WVDConnections\r\n| where UserName contains '{searchBy}' or CorrelationId contains \"{searchBy}\"\r\n| project UserName\r\n| distinct UserName\r\n| extend Lowercased=tolower(UserName)\r\n| sort by Lowercased asc\r\n| project Label=UserName, Value=UserName, Selected=(row_number()==1)",
                  "crossComponentResources": [
                    "{Workspaces}"
                  ],
                  "isHiddenWhenLocked": true,
                  "timeContext": {
                    "durationMs": 0
                  },
                  "timeContextFromParameter": "TimeRange",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                },
                {
                  "version": "KqlParameterItem/1.0",
                  "name": "resultCorrelationId",
                  "type": 1,
                  "query": "WVDConnections\r\n| where isnotempty(\"{searchBy}\")\r\n| project UserName, CorrelationId\r\n| where CorrelationId =~ '{searchBy}'\r\n| distinct CorrelationId",
                  "crossComponentResources": [
                    "{Workspaces}"
                  ],
                  "isHiddenWhenLocked": true,
                  "timeContext": {
                    "durationMs": 0
                  },
                  "timeContextFromParameter": "TimeRange",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces",
                  "id": "53a1b64a-4568-4aab-a81f-e1138bec6cd3"
                }
              ],
              "style": "above",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "parameters - 0"
          },
          {
            "type": 1,
            "content": {
              "json": "Enter a CorrelationId or UserName",
              "style": "info"
            },
            "customWidth": "20",
            "name": "text - 5",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "crossComponentResources": [
                "{Workspaces}"
              ],
              "parameters": [
                {
                  "id": "96bb3cff-fb2f-4ba1-86fe-d833822b7f81",
                  "version": "KqlParameterItem/1.0",
                  "name": "wvdprofile",
                  "type": 1,
                  "query": "    WVDCheckpoints\r\n        | where UserName =~ \"{userMatch}\"\r\n        | where¬†(Name==\"ProfileLoggedOff\" or Name==\"ODFCLoggedOff\")¬†and¬†(Source==\"RDAgent\"¬†or¬†Source==\"FSLogix\")\r\n        | extend HostPool=_ResourceId, ProfileType=iff(Name==\"ProfileLoggedOff\",\"Profile\",\"ODFC\")\r\n        | summarize arg_max(TimeGenerated, *) by UserName, _ResourceId, ProfileType\r\n        | extend VHDSizeOnDisk=todouble(replace_string(replace_string(tostring(Parameters.VHDSizeOnDisk),\",\",\"\"),\".\",\"\")),\r\n                VHDFreeSpace=todouble(replace_string(tostring(Parameters.VHDFreeSpace),\",\",\".\")),\r\n                VHDMaxSize=todouble(replace_string(tostring(Parameters.MaxVHDSize),\",\",\".\"))\r\n        | where VHDSizeOnDisk!=\"\"\r\n        | project UserName, ProfileType, VHDSizeOnDisk, VHDFreeSpace, VHDMaxSize, Usage=100*(VHDMaxSize - VHDFreeSpace)/VHDMaxSize\r\n        |  extend bag = pack(\"UserName\",UserName,\"ProfileType\",ProfileType, \"VHD Size On Disk\",VHDSizeOnDisk,\"VHD Free Space\",VHDFreeSpace,\"VHD Max Size\", VHDMaxSize,\"Usage\", Usage)\r\n    | summarize tostring(makelist(bag))",
                  "crossComponentResources": [
                    "{Workspaces}"
                  ],
                  "isHiddenWhenLocked": true,
                  "timeContext": {
                    "durationMs": 2592000000
                  },
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "parameters - 7"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let GetDaysInTimeRange = (Period:timespan) {\r\n    // Get the number of days in the period, note the period MUST be longer than 1 day, and in full days\r\n    max_of(toint(round(Period/1d, 0)), 1);\r\n};\r\nlet GetTimespanAverage = (Time:timespan, Period:timespan) {\r\n    // Get the number of days in the period, note the period MUST be longer than 1 day, and in full days\r\n    let Days = GetDaysInTimeRange(Period);\r\n    // Total hours is the number of days*24, plus the hours\r\n    let TotalHours = toint(format_timespan(Time, \"d\")) * 24 + toint(format_timespan(Time, \"H\"));\r\n    // Calculate the average hours\r\n    let AvgHours = TotalHours / Days;\r\n    // We're rounding down for the average, figure out fractional hours left \r\n    let MinuteResidue = toint(((1.0*TotalHours/Days) - AvgHours) * 60);\r\n    // Total minutes is the number of minutes plus the residue from above\r\n    let TotalMinutes = toint(format_timespan(Time, \"m\")) + MinuteResidue;\r\n    // Calculate average minutes\r\n    let AvgMinutes =  toint(round(todouble(TotalMinutes) / Days));\r\n    // Pad with zero if necessary\r\n    let MinuteStr = iif(AvgMinutes < 10, strcat(\"0\", AvgMinutes), tostring(AvgMinutes));\r\n    let Result = strcat(\"~ \", AvgHours, \":\", MinuteStr, \" h\");\r\n    iif(Time/1s > 0, Result, '');\r\n};\r\nlet ProbeRange = range ProbeDay from {TimeRange:start} to {TimeRange:end} step 1d | extend JoinKey=1;\r\nWVDConnections\r\n| where UserName == \"{userMatch}\"\r\n| as UserConnections\r\n| where State == \"Started\" and TimeGenerated <= {TimeRange:end}\r\n| extend StartTime = TimeGenerated\r\n| join kind=rightouter\r\n(\r\n    UserConnections\r\n    | where State == \"Completed\"\r\n    | extend EndTime = TimeGenerated\r\n) on CorrelationId\r\n| extend StartTime = min_of(coalesce(StartTime, {TimeRange:start}), EndTime), UserName=coalesce(UserName,UserName1) // If the start time has fallen out of retention, it should not be set to after the EndTime\r\n| where StartTime between ({TimeRange:start} .. {TimeRange:end}) or // Connections starting in our date range\r\n        EndTime   between ({TimeRange:start} .. {TimeRange:end}) or // Connections ending in our date range\r\n        (StartTime <= {TimeRange:start} and EndTime >= {TimeRange:end}) // Connections that started before and ended after the range\r\n| extend EndTime=min_of(EndTime, {TimeRange:end})-1s, StartTime=max_of(StartTime,{TimeRange:start})+1s // Crop connections to within the report boundary\r\n| extend Duration = EndTime-StartTime\r\n| sort by ClientType asc // Sort for Clients string to be homogenous\r\n| as UserUsage\r\n| join kind=leftouter\r\n(\r\n    WVDCheckpoints\r\n    | where (Name == \"LaunchExecutable\" and Parameters.connectionStage == \"RdpShellAppExecuted\") or Name==\"RdpShellAppExecuted\"\r\n    | project CorrelationId, Parameters=tostring(Parameters.filename)\r\n) on CorrelationId\r\n| summarize AppsToStartConnection=dcount(ResourceAlias),\r\n            AppsUsed=dcount(Parameters),\r\n            Connections=dcount(CorrelationId),\r\n            Time=sum(Duration),\r\n            ClientCount=dcount(ClientType)\r\n            by UserName\r\n| join kind=leftouter \r\n(\r\n    // Count days with usage\r\n    UserUsage\r\n    | extend JoinKey = 1\r\n    | join kind=fullouter ProbeRange on JoinKey\r\n    | make-series ConnectedToday=dcountif(CorrelationId, bin(ProbeDay, 1d) == bin(StartTime, 1d) or \r\n                                                bin(ProbeDay, 1d) == bin(EndTime, 1d) or \r\n                                                bin(ProbeDay, 1d) between (bin(StartTime, 1d)..bin(EndTime, 1d)))\r\n                on ProbeDay from {TimeRange:start} to {TimeRange:end} step 1d by UserName\r\n    | mv-expand ProbeDay to typeof(datetime), ConnectedToday to typeof(int)\r\n    | summarize Days=countif(ConnectedToday > 0) by UserName\r\n) on UserName\r\n| join kind = leftouter(WVDErrors | where UserName == \"{userMatch}\" | summarize Errors = dcountif(CorrelationId, isnotempty(CodeSymbolic)) by UserName) on UserName\r\n| project\r\n    ['Days in time range']=GetDaysInTimeRange({TimeRange:end} - {TimeRange:start}),\r\n    ['Days with usage']=coalesce(Days, 0),\r\n    ['Apps to start connection']=coalesce(AppsToStartConnection, 0),\r\n    ['Apps used']=coalesce(AppsUsed, 0),\r\n    ['Connection count']=coalesce(Connections, 0),\r\n    ['Connection time']=strcat(\"~ \", toint(format_timespan(Time, 'd'))*24+toint(format_timespan(Time, 'H')), \":\", format_timespan(Time, 'mm'), \" h\"),\r\n    Errors,\r\n    ['Average daily time']=GetTimespanAverage(Time,{TimeRange:end} - {TimeRange:start}),\r\n    ['Client count']=coalesce(ClientCount, 0)\r\n| evaluate narrow()\r\n| project Metric=replace(@\"\\[|'|\\]\", \"\", Column), Value",
              "size": 3,
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspaces}"
              ],
              "visualization": "tiles",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "Metric",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "Value",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  }
                },
                "showBorder": true
              }
            },
            "customWidth": "50",
            "name": "query - 2",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let newSessions = true;\r\nlet wvdProfile = materialize(datatable(row:string)['{wvdprofile}']\r\n| project row = todynamic(row)\r\n| mv-expand row\r\n| evaluate bag_unpack(row));\r\nWVDConnections\r\n| as ConnectionData\r\n| where State == \"Started\"\r\n| where UserName =~ \"{userMatch}\"\r\n| join kind = leftsemi\r\n(\r\n    // Only include connections that actually reached the host to prevent short (failed) attempts from skewing the data\r\n    WVDCheckpoints\r\n    | where Source == \"RDStack\" and Name == \"RdpStackConnectionEstablished\"\r\n) on CorrelationId\r\n| join kind = inner\r\n(\r\n    WVDCheckpoints // new session\r\n    | where newSessions\r\n    | where Name =~ \"ShellReady\" or\r\n    ( Name =~ \"LaunchExecutable\" and Parameters.connectionStage == \"RdpShellAppExecuted\" or Name=~\"RdpShellAppExecuted\")\r\n    | project ProductiveTime=TimeGenerated, CorrelationId\r\n    | summarize ProductiveTime=min(ProductiveTime) by CorrelationId\r\n    | union ( \r\n        ConnectionData // existent Sessions\r\n        | where not(newSessions)\r\n        | where State == \"Connected\"\r\n        | project ProductiveTime=TimeGenerated, CorrelationId\r\n        )\r\n) on CorrelationId\r\n| join kind = leftouter\r\n(  \r\n    WVDCheckpoints\r\n    | where Name =~ \"OnCredentialsAcquisitionCompleted\"\r\n    | project CorrelationId, credaquire = Parameters.DurationMS\r\n) on CorrelationId\r\n| join kind = leftouter\r\n(  \r\n    WVDCheckpoints\r\n    | where Name =~ \"SSOTokenRetrieval\" or Name == \"ODFCLoggedOn\" or Name == \"ProfileLoggedOn\"\r\n    | project CorrelationId, LoadTime = Parameters.DurationMS, Name\r\n) on CorrelationId\r\n| summarize AvgLogonTime = avgif(((ProductiveTime - TimeGenerated) / 1s - (coalesce(credaquire,0)/1000) - (coalesce(LoadTime,0)/1000)),Name == \"SSOTokenRetrieval\"),\r\n            AvgProfileTime = avgif(((ProductiveTime - TimeGenerated) / 1s - (coalesce(LoadTime,0)/1000)),Name == \"ODFCLoggedOn\" or Name == \"ProfileLoggedOn\")\r\n        by UserName\r\n| project UserName, AvgLogonTime, AvgProfileTime\r\n | join kind = leftouter (wvdProfile) on UserName\r\n| project-away UserName1\r\n\r\n",
              "size": 3,
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspaces}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "UserName",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "AvgLogonTime",
                    "formatter": 4,
                    "formatOptions": {
                      "min": 0,
                      "max": 600,
                      "palette": "greenRed"
                    },
                    "numberFormat": {
                      "unit": 24,
                      "options": {
                        "style": "decimal"
                      }
                    }
                  },
                  {
                    "columnMatch": "AvgProfileTime",
                    "formatter": 4,
                    "formatOptions": {
                      "min": 0,
                      "max": 600,
                      "palette": "greenRed"
                    },
                    "numberFormat": {
                      "unit": 24,
                      "options": {
                        "style": "decimal"
                      }
                    }
                  },
                  {
                    "columnMatch": "ProfileType",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "VHD Size On Disk",
                    "formatter": 0,
                    "numberFormat": {
                      "unit": 2,
                      "options": {
                        "style": "decimal"
                      }
                    }
                  },
                  {
                    "columnMatch": "VHD Free Space",
                    "formatter": 0,
                    "numberFormat": {
                      "unit": 5,
                      "options": {
                        "style": "decimal"
                      }
                    }
                  },
                  {
                    "columnMatch": "VHD Max Size",
                    "formatter": 0,
                    "numberFormat": {
                      "unit": 5,
                      "options": {
                        "style": "decimal"
                      }
                    }
                  },
                  {
                    "columnMatch": "Usage",
                    "formatter": 8,
                    "formatOptions": {
                      "min": 0,
                      "max": 100,
                      "palette": "greenRed"
                    },
                    "numberFormat": {
                      "unit": 1,
                      "options": {
                        "style": "decimal"
                      }
                    }
                  },
                  {
                    "columnMatch": "AverageLogonTime",
                    "formatter": 4,
                    "formatOptions": {
                      "min": 0,
                      "max": 600,
                      "palette": "greenRed"
                    },
                    "numberFormat": {
                      "unit": 24,
                      "options": {
                        "style": "decimal"
                      }
                    }
                  },
                  {
                    "columnMatch": "AverageProfileLoad",
                    "formatter": 0,
                    "numberFormat": {
                      "unit": 24,
                      "options": {
                        "style": "decimal"
                      }
                    }
                  }
                ],
                "hierarchySettings": {
                  "treeType": 1,
                  "groupBy": [
                    "UserName"
                  ],
                  "expandTopLevel": true,
                  "finalBy": "ProfileType"
                }
              }
            },
            "customWidth": "50",
            "name": "query - 1",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "(WVDConnections\r\n| union WVDFeeds\r\n| union WVDCheckpoints\r\n| union WVDErrors ) \r\n| where (column_ifexists(\"CorrelationId\",\"*\")==\"*\" or 'searchBy'==\"\" or column_ifexists(\"CorrelationId\",\"\") in~ ('' '{searchBy}')) \r\n    or (column_ifexists(\"UserName\",\"*\")==\"*\" or '{searchBy}'==\"\" or column_ifexists(\"UserName\",\"\") in~ ('' '{searchBy}'))\r\n//| where UserName =~ '{searchBy}'\r\n      //  or CorrelationId =~ '{searchBy}'\r\n| sort by TimeGenerated desc\r\n| extend Details = pack_all()\r\n| project CorrelationId, TimeGenerated, UserName, Source, Name, Message, CodeSymbolic, Operation, Details\r\n\r\n",
              "size": 2,
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspaces}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "CorrelationId",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "TimeGenerated",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Details",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "CellDetails",
                      "linkLabel": "üîç View Details",
                      "linkIsContextBlade": true
                    }
                  },
                  {
                    "columnMatch": "TenantId",
                    "formatter": 5
                  }
                ],
                "rowLimit": 10000,
                "filter": true,
                "hierarchySettings": {
                  "treeType": 1,
                  "groupBy": [
                    "CorrelationId"
                  ],
                  "expandTopLevel": true,
                  "finalBy": "TimeGenerated"
                }
              },
              "sortBy": []
            },
            "name": "query - 3",
            "styleSettings": {
              "showBorder": true
            }
          }
        ]
      },
      "conditionalVisibilities": [
        {
          "parameterName": "errors",
          "comparison": "isEqualTo",
          "value": "search"
        },
        {
          "parameterName": "tab",
          "comparison": "isEqualTo",
          "value": "logs"
        }
      ],
      "name": "group - Errors - Search"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "WVDErrors \r\n| make-series errorsSeries=dcountif(CorrelationId, isnotempty(CodeSymbolic)) on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain}\r\n| extend Errors = array_sum(errorsSeries), TotalErrors = \"TotalErrors\"\r\n\r\n",
              "size": 3,
              "title": "Total Errors",
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspaces}"
              ],
              "visualization": "tiles",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "TotalErrors",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "Errors",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "blue"
                  }
                },
                "secondaryContent": {
                  "columnMatch": "errorsSeries",
                  "formatter": 9,
                  "formatOptions": {
                    "palette": "greenRed"
                  }
                },
                "showBorder": true
              }
            },
            "customWidth": "15",
            "name": "query - 3",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "arg(\"\").resources\r\n| where type =~ 'microsoft.desktopvirtualization/hostpools'\r\n| project Hostpool = tolower(id), location\r\n| join kind = leftouter(WVDErrors | extend Hostpool = tolower(_ResourceId)) on Hostpool\r\n| summarize errors=dcountif(CorrelationId, isnotempty(CodeSymbolic)) by location\r\n\r\n",
              "size": 2,
              "title": "Errors by Region",
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspaces}"
              ],
              "visualization": "map",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "TotalErrors",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "Errors",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "blue"
                  }
                },
                "secondaryContent": {
                  "columnMatch": "count_",
                  "formatter": 9,
                  "formatOptions": {
                    "palette": "greenRed"
                  }
                },
                "showBorder": true
              },
              "mapSettings": {
                "locInfo": "AzureLoc",
                "locInfoColumn": "location",
                "sizeSettings": "errors",
                "sizeAggregation": "Sum",
                "labelSettings": "location",
                "legendMetric": "errors",
                "legendAggregation": "Sum",
                "itemColorSettings": {
                  "nodeColorField": "errors",
                  "colorAggregation": "Sum",
                  "type": "heatmap",
                  "heatmapPalette": "greenRed"
                }
              }
            },
            "customWidth": "85",
            "name": "query - 3 - Copy",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "WVDErrors\r\n| summarize errors=dcountif(CorrelationId, isnotempty(CodeSymbolic)) by UserName\r\n| top 5 by errors",
              "size": 3,
              "title": "Top 5 Errors by User",
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspaces}"
              ],
              "visualization": "tiles",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "UserName",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "errors",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "style": "decimal",
                      "maximumFractionDigits": 2,
                      "maximumSignificantDigits": 3
                    }
                  }
                },
                "showBorder": true,
                "sortCriteriaField": "count_",
                "sortOrderField": 2
              }
            },
            "name": "query - 2",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "WVDErrors\r\n| summarize count() by CodeSymbolic\r\n| top 5 by count_",
              "size": 3,
              "title": "Top 5 Errors by CodeSymbolic",
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspaces}"
              ],
              "visualization": "tiles",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "CodeSymbolic",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "count_",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "maximumSignificantDigits": 3,
                      "maximumFractionDigits": 2
                    }
                  }
                },
                "showBorder": true,
                "sortCriteriaField": "count_",
                "sortOrderField": 2
              }
            },
            "name": "query - 2 - Copy",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "WVDErrors\r\n| summarize errors=dcountif(CorrelationId, isnotempty(CodeSymbolic)) by _ResourceId\r\n| top 5 by errors",
              "size": 4,
              "title": "Top 5 Errors by Hostpool",
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspaces}"
              ],
              "visualization": "tiles",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "_ResourceId",
                  "formatter": 13,
                  "formatOptions": {
                    "linkTarget": null,
                    "showIcon": true
                  }
                },
                "leftContent": {
                  "columnMatch": "errors",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "style": "decimal",
                      "maximumFractionDigits": 2,
                      "maximumSignificantDigits": 3
                    }
                  }
                },
                "showBorder": true,
                "sortCriteriaField": "count_",
                "sortOrderField": 2
              }
            },
            "name": "query - 2 - Copy - Copy",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "alertsmanagementresources\r\n| extend FireTime = todatetime(properties.essentials.startDateTime), \r\n         Severity = tostring(properties.essentials.severity), \r\n         MonitorCondition = tostring(properties.essentials.monitorCondition), \r\n         AlertTarget = tostring(properties.essentials.targetResourceType), \r\n         MonitorService = tostring(properties.essentials.monitorService)\r\n| where FireTime {TimeRange}\r\n| extend AlertTarget = case(\r\n        MonitorService == 'ActivityLog Administrative', 'ActivityLog',\r\n        AlertTarget == 'microsoft.insights/components', 'App Insights',\r\n        AlertTarget == 'microsoft.operationalinsights/workspaces', 'Log Analytics', \r\n        AlertTarget)\r\n| summarize Sev0 = countif(Severity == \"Sev0\"), \r\n            Sev1 = countif(Severity == \"Sev1\"), \r\n            Sev2 = countif(Severity == \"Sev2\"), \r\n            Sev3 = countif(Severity == \"Sev3\"), \r\n            Sev4 = countif(Severity == \"Sev4\"),\r\n            Resolved = countif(MonitorCondition == \"Resolved\"),\r\n            Fired = countif(MonitorCondition == \"Fired\"),\r\n            Total = count()\r\n| extend Chart = pack_all()\r\n| project Chart\r\n| mv-expand bagexpansion = array Chart\r\n| project tostring(name = Chart[0]), todouble(val = Chart[1])\r\n| sort by val desc\r\n| sort by name desc",
              "size": 3,
              "title": "Alerts in AVD Related Subscriptions",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "visualization": "tiles",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "name",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "val",
                  "formatter": 12,
                  "formatOptions": {
                    "min": 0,
                    "palette": "greenRed"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "style": "decimal",
                      "maximumFractionDigits": 2,
                      "maximumSignificantDigits": 3
                    }
                  }
                },
                "showBorder": true,
                "sortCriteriaField": "val",
                "sortOrderField": 2
              }
            },
            "name": "query - 11",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "alertsmanagementresources\r\n| extend FireTime = todatetime(properties.essentials.startDateTime), \r\n         Severity = tostring(properties.essentials.severity), \r\n         MonitorCondition = tostring(properties.essentials.monitorCondition), \r\n         AlertTarget = tostring(properties.essentials.targetResourceType), \r\n         MonitorService = tostring(properties.essentials.monitorService)\r\n| where FireTime {TimeRange}\r\n| extend AlertTarget = case(\r\n        MonitorService == 'ActivityLog Administrative', 'ActivityLog',\r\n        AlertTarget == 'microsoft.insights/components', 'App Insights',\r\n        AlertTarget == 'microsoft.operationalinsights/workspaces', 'Log Analytics', \r\n        AlertTarget)\r\n| summarize Sev0 = countif(Severity == \"Sev0\"), \r\n            Sev1 = countif(Severity == \"Sev1\"), \r\n            Sev2 = countif(Severity == \"Sev2\"), \r\n            Sev3 = countif(Severity == \"Sev3\"), \r\n            Sev4 = countif(Severity == \"Sev4\"),\r\n            Resolved = countif(MonitorCondition == \"Resolved\"),\r\n            Fired = countif(MonitorCondition == \"Fired\"),\r\n            Total = count() by subscriptionId\r\n| sort by Fired desc",
              "size": 3,
              "title": "Alerts by Subscription",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "$gen_group",
                    "formatter": 15,
                    "formatOptions": {
                      "linkTarget": null,
                      "showIcon": true
                    }
                  },
                  {
                    "columnMatch": "Group",
                    "formatter": 15,
                    "formatOptions": {
                      "linkTarget": null,
                      "showIcon": true
                    }
                  },
                  {
                    "columnMatch": "subscriptionId",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Total",
                    "formatter": 22,
                    "formatOptions": {
                      "compositeBarSettings": {
                        "labelText": "Total Alerts",
                        "columnSettings": [
                          {
                            "columnName": "Sev0",
                            "color": "redBright"
                          },
                          {
                            "columnName": "Sev1",
                            "color": "orange"
                          },
                          {
                            "columnName": "Sev2",
                            "color": "yellow"
                          },
                          {
                            "columnName": "Sev3",
                            "color": "blue"
                          },
                          {
                            "columnName": "Sev4",
                            "color": "blueDark"
                          }
                        ]
                      }
                    }
                  }
                ],
                "hierarchySettings": {
                  "treeType": 1,
                  "groupBy": [
                    "subscriptionId"
                  ],
                  "expandTopLevel": true,
                  "finalBy": "Total"
                },
                "sortBy": [
                  {
                    "itemKey": "Fired",
                    "sortOrder": 2
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "Fired",
                  "sortOrder": 2
                }
              ],
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "name",
                  "formatter": 18,
                  "formatOptions": {
                    "thresholdsOptions": "icons",
                    "thresholdsGrid": [
                      {
                        "operator": "==",
                        "thresholdValue": "Total",
                        "representation": "Alert",
                        "text": "{0}{1}"
                      },
                      {
                        "operator": "==",
                        "thresholdValue": "Fired",
                        "representation": "Fired",
                        "text": "{0}{1}"
                      },
                      {
                        "operator": "==",
                        "thresholdValue": "Resolved",
                        "representation": "Resolved",
                        "text": "{0}{1}"
                      },
                      {
                        "operator": "==",
                        "thresholdValue": "Sev4",
                        "representation": "Sev4",
                        "text": "{0}{1}"
                      },
                      {
                        "operator": "==",
                        "thresholdValue": "Sev3",
                        "representation": "Sev3",
                        "text": "{0}{1}"
                      },
                      {
                        "operator": "==",
                        "thresholdValue": "Sev2",
                        "representation": "Sev2",
                        "text": "{0}{1}"
                      },
                      {
                        "operator": "==",
                        "thresholdValue": "Sev1",
                        "representation": "Sev1",
                        "text": "{0}{1}"
                      },
                      {
                        "operator": "==",
                        "thresholdValue": "Sev0",
                        "representation": "Sev0",
                        "text": "{0}{1}"
                      },
                      {
                        "operator": "Default",
                        "thresholdValue": null,
                        "representation": "cancelled",
                        "text": "{0}{1}"
                      }
                    ]
                  }
                },
                "leftContent": {
                  "columnMatch": "val",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "blue"
                  }
                },
                "showBorder": true
              },
              "graphSettings": {
                "type": 0
              }
            },
            "name": "query - 0 - Copy",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "alertsmanagementresources\r\n| extend FireTime = todatetime(properties.essentials.startDateTime), \r\n         LastModifiedTime = todatetime(properties.essentials.lastModifiedDateTime),\r\n         Severity = tostring(properties.essentials.severity), \r\n         MonitorCondition = tostring(properties.essentials.monitorCondition), \r\n         AlertTarget = tostring(properties.essentials.targetResourceType), \r\n         MonitorService = tostring(properties.essentials.monitorService),\r\n         ResolvedTime = todatetime(properties.essentials.monitorConditionResolvedDateTime)\r\n| where FireTime {TimeRange}\r\n| extend AlertTarget = case(\r\n                MonitorService == 'ActivityLog Administrative', 'ActivityLog',\r\n                AlertTarget == 'microsoft.insights/components', 'App Insights',\r\n                AlertTarget == 'microsoft.operationalinsights/workspaces', 'Log Analytics', \r\n                AlertTarget)            \r\n| mv-expand Condition = properties.context.context.condition.allOf\r\n| extend SignalLogic = case(\r\n                MonitorService == \"VM Insights - Health\", strcat(\"VM Health for \", properties.essentials.targetResourceName, \" Changed from \", properties.context.monitorStateBeforeAlertCreated, \" to \", properties.context.monitorStateWhenAlertCreated),\r\n                AlertTarget == \"ActivityLog\", strcat(\"When the Activity Log has Category = \", properties.context.context.activityLog.properties.eventCategory, \" and Signal name = \", properties.context.context.activityLog.properties.message),\r\n                MonitorService == \"Smart Detector\", strcat(properties.SmartDetectorName, \" Detected failure rate of \", properties.DetectedFailureRate, \" above normal failure rate of \", properties.context.NormalFailureRate),\r\n                MonitorService == \"Log Analytics\", strcat(\"Alert when \", properties.context.AlertType, \" is \", properties.context.AlertThresholdOperator, \" threshold \", properties.context.AlertThresholdValue),\r\n                MonitorService == \"ActivityLog Autoscale\", strcat(properties.context.context.activityLog.operationName, \" from \", properties.context.context.activityLog.properties.oldInstancesCount, \" to \", properties.context.context.activityLog.properties.newInstancesCount),\r\n                strcat(\"Alert when metric \", Condition.metricName, Condition.timeAggregation, \" is \", Condition.operator, \" threshold \", Condition.threshold)),\r\n         Query = case(\r\n                 MonitorService == \"Log Alerts V2\", tostring(Condition.searchQuery),\r\n                 MonitorService == \"Log Analytics\", tostring(properties.context.SearchQuery), \"N/A\"),\r\n         MetricValue = iff(MonitorService == \"Log Analytics\", toint(properties.context.ResultCount), toint(Condition.metricValue)),\r\n         AffectedResource = iff(AlertTarget == \"ActivityLog\", properties.context.context.activityLog.subscriptionId, tostring(properties.essentials.targetResourceName))\r\n| extend OpenTime = iff(MonitorCondition == \"Resolved\", datetime_diff('minute', ResolvedTime, FireTime), datetime_diff('minute', now(), FireTime)),\r\n         Details = pack_all()\r\n| project name, AlertTarget, id, subscriptionId, AffectedResource, MonitorCondition, FireTime, LastModifiedTime, OpenTime, SignalLogic, Query, MetricValue, Details",
              "size": 2,
              "showAnalytics": true,
              "title": "Detailed Alert view for Selected Timerange",
              "noDataMessage": "No Alerts in the Assigned Time Range",
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "$gen_group",
                    "formatter": 15,
                    "formatOptions": {
                      "linkTarget": "OpenBlade",
                      "linkIsContextBlade": true,
                      "showIcon": true,
                      "bladeOpenContext": {
                        "bladeName": "AlertDetailsTemplateBlade",
                        "extensionName": "Microsoft_Azure_Monitoring",
                        "bladeParameters": [
                          {
                            "name": "alertId",
                            "source": "column",
                            "value": "id"
                          },
                          {
                            "name": "alertName",
                            "source": "column",
                            "value": "name"
                          },
                          {
                            "name": "invokedFrom",
                            "source": "static",
                            "value": "Workbooks"
                          }
                        ]
                      }
                    }
                  },
                  {
                    "columnMatch": "name",
                    "formatter": 5,
                    "formatOptions": {
                      "linkTarget": "OpenBlade",
                      "linkIsContextBlade": true,
                      "bladeOpenContext": {
                        "bladeName": "AlertDetailsTemplateBlade",
                        "extensionName": "Microsoft_Azure_Monitoring",
                        "bladeParameters": [
                          {
                            "name": "alertId",
                            "source": "column",
                            "value": "id"
                          },
                          {
                            "name": "alertName",
                            "source": "column",
                            "value": "name"
                          },
                          {
                            "name": "invokedFrom",
                            "source": "static",
                            "value": "Workbooks"
                          }
                        ]
                      }
                    },
                    "tooltipFormat": {
                      "tooltip": "View alert details"
                    }
                  },
                  {
                    "columnMatch": "id",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "subscriptionId",
                    "formatter": 5,
                    "formatOptions": {
                      "linkTarget": "OpenBlade",
                      "linkIsContextBlade": true,
                      "bladeOpenContext": {
                        "bladeName": "AlertDetailsTemplateBlade",
                        "extensionName": "Microsoft_Azure_Monitoring",
                        "bladeParameters": [
                          {
                            "name": "alertId",
                            "source": "column",
                            "value": "id"
                          },
                          {
                            "name": "alertName",
                            "source": "column",
                            "value": "name"
                          },
                          {
                            "name": "invokedFrom",
                            "source": "static",
                            "value": "Workbooks"
                          }
                        ]
                      }
                    }
                  },
                  {
                    "columnMatch": "MonitorCondition",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Fired",
                          "representation": "2",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Resolved",
                          "representation": "success",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "success",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "FireTime",
                    "formatter": 6
                  },
                  {
                    "columnMatch": "LastModifiedTime",
                    "formatter": 6
                  },
                  {
                    "columnMatch": "OpenTime",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "greenRed"
                    },
                    "numberFormat": {
                      "unit": 25,
                      "options": {
                        "style": "decimal"
                      }
                    }
                  },
                  {
                    "columnMatch": "Details",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "CellDetails",
                      "linkLabel": "üîç View Details",
                      "linkIsContextBlade": true
                    }
                  },
                  {
                    "columnMatch": "Group",
                    "formatter": 15,
                    "formatOptions": {
                      "linkTarget": "OpenBlade",
                      "linkIsContextBlade": true,
                      "showIcon": true,
                      "bladeOpenContext": {
                        "bladeName": "AlertDetailsTemplateBlade",
                        "extensionName": "Microsoft_Azure_Monitoring",
                        "bladeParameters": [
                          {
                            "name": "alertId",
                            "source": "column",
                            "value": "id"
                          },
                          {
                            "name": "alertName",
                            "source": "column",
                            "value": "name"
                          },
                          {
                            "name": "invokedFrom",
                            "source": "static",
                            "value": "Workbooks"
                          }
                        ]
                      }
                    }
                  }
                ],
                "rowLimit": 10000,
                "filter": true,
                "hierarchySettings": {
                  "treeType": 1,
                  "groupBy": [
                    "subscriptionId"
                  ],
                  "expandTopLevel": true,
                  "finalBy": "name"
                }
              },
              "sortBy": [],
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "name",
                  "formatter": 18,
                  "formatOptions": {
                    "thresholdsOptions": "icons",
                    "thresholdsGrid": [
                      {
                        "operator": "==",
                        "thresholdValue": "Total",
                        "representation": "Alert",
                        "text": "{0}{1}"
                      },
                      {
                        "operator": "==",
                        "thresholdValue": "Fired",
                        "representation": "Fired",
                        "text": "{0}{1}"
                      },
                      {
                        "operator": "==",
                        "thresholdValue": "Resolved",
                        "representation": "Resolved",
                        "text": "{0}{1}"
                      },
                      {
                        "operator": "==",
                        "thresholdValue": "Sev4",
                        "representation": "Sev4",
                        "text": "{0}{1}"
                      },
                      {
                        "operator": "==",
                        "thresholdValue": "Sev3",
                        "representation": "Sev3",
                        "text": "{0}{1}"
                      },
                      {
                        "operator": "==",
                        "thresholdValue": "Sev2",
                        "representation": "Sev2",
                        "text": "{0}{1}"
                      },
                      {
                        "operator": "==",
                        "thresholdValue": "Sev1",
                        "representation": "Sev1",
                        "text": "{0}{1}"
                      },
                      {
                        "operator": "==",
                        "thresholdValue": "Sev0",
                        "representation": "Sev0",
                        "text": "{0}{1}"
                      },
                      {
                        "operator": "Default",
                        "thresholdValue": null,
                        "representation": "cancelled",
                        "text": "{0}{1}"
                      }
                    ]
                  }
                },
                "leftContent": {
                  "columnMatch": "val",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "blue"
                  }
                },
                "showBorder": true
              },
              "graphSettings": {
                "type": 0
              }
            },
            "showPin": true,
            "name": "query - 1",
            "styleSettings": {
              "showBorder": true
            }
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "tab",
        "comparison": "isEqualTo",
        "value": "inventory"
      },
      "name": "group - Overview"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "WVDErrors\r\n//| join kind=leftouter(WVDConnections) on CorrelationId\r\n| summarize FSLogix = dcountif(CorrelationId,Source == \"FSLogix\"), \r\n            RDStack = dcountif(CorrelationId,Source == \"RDStack\"),\r\n            Client = dcountif(CorrelationId,Source == \"Client\"), \r\n            RDGateway = dcountif(CorrelationId,Source == \"RDGateway\"),\r\n            Diagnostics = dcountif(CorrelationId,Source == \"Diagnostics\"), \r\n            RDBroker = dcountif(CorrelationId,Source == \"RDBroker\"),\r\n            RAIL = dcountif(CorrelationId,Source == \"RAIL\"), \r\n            RDWeb = dcountif(CorrelationId,Source == \"RDWeb\"),\r\n            RDAgent = dcountif(CorrelationId,Source== \"RDAgent\"),\r\n            Total = count()\r\n            | evaluate narrow()",
              "size": 3,
              "title": "AVD Errors by Source",
              "timeContextFromParameter": "TimeRange",
              "exportFieldName": "Column",
              "exportParameterName": "fssource",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspaces}"
              ],
              "visualization": "tiles",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "Column",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "Value",
                  "formatter": 12,
                  "formatOptions": {
                    "min": 0,
                    "palette": "greenRed"
                  }
                },
                "showBorder": true,
                "sortCriteriaField": "Column",
                "sortOrderField": 2
              }
            },
            "conditionalVisibility": {
              "parameterName": "tab",
              "comparison": "isEqualTo",
              "value": "logs"
            },
            "name": "query - AVD Errors",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "crossComponentResources": [
                "{Workspaces}"
              ],
              "parameters": [
                {
                  "id": "1eaf8cdc-4273-482a-9b36-c8f09bc0def8",
                  "version": "KqlParameterItem/1.0",
                  "name": "source",
                  "type": 1,
                  "query": "print temp = '{fssource}'",
                  "crossComponentResources": [
                    "{Workspaces}"
                  ],
                  "isHiddenWhenLocked": true,
                  "timeContext": {
                    "durationMs": 0
                  },
                  "timeContextFromParameter": "TimeRange",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "parameters - 10"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "WVDErrors\r\n| extend HostPool=_ResourceId\r\n| where (column_ifexists(\"Source\",\"*\")==\"*\" or '{source}'==\"\" or column_ifexists(\"Source\",\"\") in ('' '{source}')) \r\n| summarize Errors=dcountif(CorrelationId, isnotempty(CodeSymbolic)) by HostPool\r\n| top {Top} by Errors",
              "size": 3,
              "title": "AVD Errors Top {Top} Hostpools ",
              "timeContextFromParameter": "TimeRange",
              "exportedParameters": [
                {
                  "fieldName": "HostPool",
                  "parameterName": "fshostpool",
                  "parameterType": 5
                }
              ],
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspaces}"
              ],
              "visualization": "tiles",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "HostPool",
                  "formatter": 13,
                  "formatOptions": {
                    "linkTarget": null,
                    "showIcon": true
                  }
                },
                "leftContent": {
                  "columnMatch": "Errors",
                  "formatter": 12,
                  "formatOptions": {
                    "min": 0,
                    "palette": "greenRed"
                  }
                },
                "showBorder": true,
                "sortCriteriaField": "Column",
                "sortOrderField": 2
              }
            },
            "customWidth": "50",
            "name": "query - AVD Errors by Hostpool",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "WVDErrors\r\n| join (WVDConnections) on CorrelationId\r\n| where (column_ifexists(\"Source\",\"*\")==\"*\" or '{source}'==\"\" or column_ifexists(\"Source\",\"\") in ('' '{source}')) \r\n| summarize Errors=dcountif(CorrelationId, isnotempty(CodeSymbolic)) by GatewayRegion\r\n| top {Top} by Errors",
              "size": 3,
              "title": "AVD Errors by {Top} Gateway Regions",
              "timeContextFromParameter": "TimeRange",
              "exportFieldName": "GatewayRegion",
              "exportParameterName": "fsgateway",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspaces}"
              ],
              "visualization": "tiles",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "GatewayRegion",
                  "formatter": 13,
                  "formatOptions": {
                    "linkTarget": null,
                    "showIcon": true
                  }
                },
                "leftContent": {
                  "columnMatch": "Errors",
                  "formatter": 12,
                  "formatOptions": {
                    "min": 0,
                    "palette": "greenRed"
                  }
                },
                "showBorder": true,
                "sortCriteriaField": "Column",
                "sortOrderField": 2
              }
            },
            "customWidth": "50",
            "name": "query - AVD Errors by GatewayRegion- Copy",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "crossComponentResources": [
                "{Workspaces}"
              ],
              "parameters": [
                {
                  "id": "c11f889a-cc53-4705-ba93-fbc6216e11c7",
                  "version": "KqlParameterItem/1.0",
                  "name": "gateway",
                  "type": 1,
                  "query": "print temp = '{fsgateway}'",
                  "crossComponentResources": [
                    "{Workspaces}"
                  ],
                  "isHiddenWhenLocked": true,
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                },
                {
                  "id": "4cf3a161-5068-4675-b178-ad63fc5bb24d",
                  "version": "KqlParameterItem/1.0",
                  "name": "hostpool",
                  "type": 5,
                  "query": "print test = '{fshostpool}'",
                  "crossComponentResources": [
                    "{Workspaces}"
                  ],
                  "isHiddenWhenLocked": true,
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::1"
                    ],
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "defaultValue": "value::1",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "parameters - 10"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "WVDErrors\r\n| join kind=leftouter(WVDConnections) on CorrelationId\r\n| extend HostPool=_ResourceId\r\n| where (column_ifexists(\"Source\",\"*\")==\"*\" or '{source}'==\"\" or column_ifexists(\"Source\",\"\") in ('' '{source}')) \r\n    and (column_ifexists(\"GatewayRegion\",\"*\")==\"*\" or \"{gateway}\"==\"\" or column_ifexists(\"GatewayRegion\",\"\") in ('' \"{gateway}\"))\r\n    and (column_ifexists(\"Hostpool\",\"*\")==\"*\" or \"{hostpool}\"==\"\" or column_ifexists(\"hostpool\",\"\") in ('' \"{hostpool}\"))\r\n| summarize Errors=dcountif(CorrelationId,isnotempty(CorrelationId)), arg_max(TimeGenerated, CorrelationId, SessionHostName) by UserName\r\n| top {Top} by Errors\r\n| sort by Errors desc\r\n\r\n",
              "size": 0,
              "title": "Top {Top} Users by Errors",
              "timeContextFromParameter": "TimeRange",
              "exportedParameters": [
                {
                  "fieldName": "UserName",
                  "parameterName": "user"
                },
                {
                  "fieldName": "SesionHostName",
                  "parameterName": "sessionhost",
                  "parameterType": 1
                },
                {
                  "fieldName": "CorrelationId",
                  "parameterName": "correlationid",
                  "parameterType": 1
                }
              ],
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspaces}"
              ],
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Errors",
                    "formatter": 8,
                    "formatOptions": {
                      "min": 0,
                      "max": 300,
                      "palette": "greenRed"
                    }
                  },
                  {
                    "columnMatch": "TimeGenerated",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "CorrelationId",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "SessionHostName",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Details",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "CellDetails",
                      "linkLabel": "üîç View Details",
                      "linkIsContextBlade": true
                    }
                  }
                ],
                "rowLimit": 10000,
                "filter": true
              },
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "HostPool"
                },
                "leftContent": {
                  "columnMatch": "count_",
                  "formatter": 12,
                  "formatOptions": {
                    "min": 0,
                    "palette": "greenRed"
                  }
                },
                "showBorder": true,
                "sortCriteriaField": "Column",
                "sortOrderField": 2
              }
            },
            "customWidth": "50",
            "name": "query - Top 20 Users by Errors",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "WVDErrors\r\n| join kind=leftouter(WVDConnections) on CorrelationId\r\n| extend HostPool=_ResourceId\r\n| where (column_ifexists(\"Source\",\"*\")==\"*\" or '{source}'==\"\" or column_ifexists(\"Source\",\"\") in ('' '{source}')) \r\n    and (column_ifexists(\"GatewayRegion\",\"*\")==\"*\" or \"{gateway}\"==\"\" or column_ifexists(\"GatewayRegion\",\"\") in ('' \"{gateway}\"))\r\n    and (column_ifexists(\"Hostpool\",\"*\")==\"*\" or \"{hostpool}\"==\"\" or column_ifexists(\"hostpool\",\"\") in ('' \"{hostpool}\"))\r\n| summarize Errors=dcountif(CorrelationId,isnotempty(CorrelationId)) by SessionHostName\r\n| top {Top} by Errors\r\n| sort by Errors desc\r\n",
              "size": 0,
              "title": "Top {Top} Session Hosts by Errors",
              "timeContextFromParameter": "TimeRange",
              "exportedParameters": [
                {
                  "fieldName": "UserName",
                  "parameterName": "username",
                  "parameterType": 1
                },
                {
                  "fieldName": "SessionHostName",
                  "parameterName": "host",
                  "parameterType": 1
                },
                {
                  "fieldName": "CorrelationId",
                  "parameterName": "correlation",
                  "parameterType": 1
                }
              ],
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspaces}"
              ],
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Errors",
                    "formatter": 8,
                    "formatOptions": {
                      "min": 0,
                      "max": 300,
                      "palette": "greenRed"
                    }
                  },
                  {
                    "columnMatch": "Details",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "CellDetails",
                      "linkLabel": "üîç View Details",
                      "linkIsContextBlade": true
                    }
                  }
                ],
                "rowLimit": 10000,
                "filter": true
              },
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "HostPool"
                },
                "leftContent": {
                  "columnMatch": "count_",
                  "formatter": 12,
                  "formatOptions": {
                    "min": 0,
                    "palette": "greenRed"
                  }
                },
                "showBorder": true,
                "sortCriteriaField": "Column",
                "sortOrderField": 2
              }
            },
            "customWidth": "50",
            "name": "query - Top 20 Session Hosts by Errors",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "crossComponentResources": [
                "{Workspaces}"
              ],
              "parameters": [
                {
                  "id": "e471fe21-cd7c-462f-a5cd-09796c33a110",
                  "version": "KqlParameterItem/1.0",
                  "name": "sessionhosts",
                  "type": 2,
                  "multiSelect": true,
                  "quote": "'",
                  "delimiter": ",",
                  "query": "WVDErrors\r\n| where UserName == '{user}'\r\n| join kind=leftouter(WVDConnections) on CorrelationId\r\n| distinct SessionHostName\r\n| where SessionHostName != \"<>\"",
                  "crossComponentResources": [
                    "{Workspaces}"
                  ],
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::all"
                    ],
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 0
                  },
                  "timeContextFromParameter": "TimeRange",
                  "defaultValue": "value::all",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                },
                {
                  "id": "dde86f84-90fc-4cfb-bf86-894bde672a55",
                  "version": "KqlParameterItem/1.0",
                  "name": "EventLog",
                  "type": 2,
                  "multiSelect": true,
                  "quote": "'",
                  "delimiter": ",",
                  "query": "Event\r\n| where EventLog == \"Microsoft-Windows-TerminalServices-LocalSessionManager/Operational\" \r\n    or EventLog == \"Microsoft-FSLogix-Apps/Admin\"\r\n    or EventLog == \"Application\" and EventLevelName == \"Error\" or EventLevelName == \"Warning\"\r\n    or EventLog == \"Microsoft-Windows-TerminalServices-RemoteConnectionManager/Admin\"\r\n    or EventLog == \"System\" and EventLevelName == \"Error\" or EventLevelName == \"Warning\"\r\n    or EventLog == \"Microsoft-FSLogix-Apps/Operational\"\r\n| distinct EventLog",
                  "crossComponentResources": [
                    "{Workspaces}"
                  ],
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::1",
                      "value::all"
                    ]
                  },
                  "timeContext": {
                    "durationMs": 0
                  },
                  "timeContextFromParameter": "TimeRange",
                  "defaultValue": "value::all",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                },
                {
                  "id": "c5c7ce92-ada7-4e65-b087-4fab3ee17887",
                  "version": "KqlParameterItem/1.0",
                  "name": "EventSource",
                  "type": 2,
                  "multiSelect": true,
                  "quote": "'",
                  "delimiter": ",",
                  "query": "Event\r\n| extend Source = strcat_array(split(Source, \"\\\\\"), \"-\")\r\n| extend Source = strcat_array(split(Source, \"&\"), \"-\")\r\n| distinct Source",
                  "crossComponentResources": [
                    "{Workspaces}"
                  ],
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::all"
                    ]
                  },
                  "timeContext": {
                    "durationMs": 0
                  },
                  "timeContextFromParameter": "TimeRange",
                  "defaultValue": "value::all",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                },
                {
                  "id": "9d5b591e-84cb-46f9-8a23-4f733d270912",
                  "version": "KqlParameterItem/1.0",
                  "name": "EventLevel",
                  "type": 2,
                  "multiSelect": true,
                  "quote": "'",
                  "delimiter": ",",
                  "query": "Event | distinct EventLevelName",
                  "crossComponentResources": [
                    "{Workspaces}"
                  ],
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::all"
                    ]
                  },
                  "timeContext": {
                    "durationMs": 0
                  },
                  "timeContextFromParameter": "TimeRange",
                  "defaultValue": "value::all",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                },
                {
                  "id": "5669537c-3952-4e59-886a-591616e8c5e6",
                  "version": "KqlParameterItem/1.0",
                  "name": "username",
                  "type": 1,
                  "query": "WVDErrors\r\n| where UserName == '{user}'\r\n| distinct UserName",
                  "crossComponentResources": [
                    "{Workspaces}"
                  ],
                  "isHiddenWhenLocked": true,
                  "timeContext": {
                    "durationMs": 0
                  },
                  "timeContextFromParameter": "TimeRange",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                },
                {
                  "id": "0c6c8904-8e68-4dea-8a45-f6709036f05a",
                  "version": "KqlParameterItem/1.0",
                  "name": "Start",
                  "type": 2,
                  "query": "WVDConnections\r\n| where CorrelationId == \"{correlationid}\"\r\n| summarize min(TimeGenerated)",
                  "crossComponentResources": [
                    "{Workspaces}"
                  ],
                  "isHiddenWhenLocked": true,
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::1"
                    ],
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "timeContextFromParameter": "TimeRange",
                  "defaultValue": "value::1",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                },
                {
                  "id": "f79cedfe-5fd2-4aa0-ae4a-bf29a4421e9c",
                  "version": "KqlParameterItem/1.0",
                  "name": "End",
                  "type": 1,
                  "query": "WVDConnections\r\n| where CorrelationId == \"{correlationid}\"\r\n| summarize max(TimeGenerated)",
                  "crossComponentResources": [
                    "{Workspaces}"
                  ],
                  "isHiddenWhenLocked": true,
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "timeContextFromParameter": "TimeRange",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "parameters - 4"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "union\r\n(Event\r\n| extend SessionHostName = Computer\r\n| where (column_ifexists(\"SessionHostName\",\"*\")==\"*\" or '{sessionhosts}'==\"\" or column_ifexists(\"SessionHostName\",\"\") in ('' '{sessionhosts}')) \r\n| extend Source = strcat_array(split(Source, \"\\\\\"), \"-\")\r\n| extend Source = strcat_array(split(Source, \"&\"), \"-\")\r\n| where EventLog in ({EventLog}) \r\n    and Source in ({EventSource}) \r\n    and EventLevelName in ({EventLevel})\r\n| project-away TenantId, MG, ManagementGroupName\r\n| sort by TimeGenerated desc ),\r\n(WVDErrors\r\n| join (WVDConnections | where (column_ifexists(\"SessionHostName\",\"*\")==\"*\" or '{sessionhosts}'==\"\" or column_ifexists(\"SessionHostName\",\"\") in ('' '{sessionhosts}')) \r\n|project CorrelationId, SessionHostName) on CorrelationId\r\n| extend HostPool = _ResourceId\r\n| project-away _ResourceId, TenantId, CorrelationId1) \r\n| extend ['EventMessage - Message'] = coalesce(RenderedDescription, Message),\r\n        ['EventLevel - Activity'] = coalesce(EventLevelName, ActivityType),\r\n        ['EventID - CorrelationId'] = coalesce(tostring(EventID), tostring(CorrelationId))\r\n| extend Details = pack_all()\r\n| project SessionHostName, TimeGenerated, Source, ['EventMessage - Message'],['EventLevel - Activity'], UserName, CodeSymbolic, Operation, ['EventID - CorrelationId'], Details\r\n",
              "size": 2,
              "timeContextFromParameter": "TimeRange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspaces}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "SessionHostName",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "TimeGenerated",
                    "formatter": 5
                  }
                ],
                "rowLimit": 10000,
                "filter": true,
                "hierarchySettings": {
                  "treeType": 1,
                  "groupBy": [
                    "SessionHostName"
                  ],
                  "expandTopLevel": true,
                  "finalBy": "TimeGenerated"
                }
              }
            },
            "name": "query - 4"
          }
        ]
      },
      "conditionalVisibilities": [
        {
          "parameterName": "errors",
          "comparison": "isEqualTo",
          "value": "guided"
        },
        {
          "parameterName": "tab",
          "comparison": "isEqualTo",
          "value": "logs"
        }
      ],
      "name": "group - Errors - Guided",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "tabs",
              "links": [
                {
                  "id": "62ce23d8-8074-466a-81e1-e09e4fd7e59e",
                  "cellValue": "userTab",
                  "linkTarget": "parameter",
                  "linkLabel": "FSLogix",
                  "subTarget": "fslogix",
                  "style": "link"
                },
                {
                  "id": "7b27696d-1541-4cc4-8468-f1456273dd72",
                  "cellValue": "userTab",
                  "linkTarget": "parameter",
                  "linkLabel": "RTT Metrics",
                  "subTarget": "rtt",
                  "style": "link"
                },
                {
                  "id": "07fa89af-bc32-49e7-ad3f-855672e5a88c",
                  "cellValue": "userTab",
                  "linkTarget": "parameter",
                  "linkLabel": "Logon Times",
                  "subTarget": "logon",
                  "style": "link"
                }
              ]
            },
            "name": "links - 1"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "fabef721-7bd9-4783-ab40-4d088fb54b72",
                  "version": "KqlParameterItem/1.0",
                  "name": "fslog",
                  "label": "Load Time or Storage",
                  "type": 10,
                  "typeSettings": {
                    "additionalResourceOptions": []
                  },
                  "jsonData": "[{\"value\":\"load\",\"label\":\"Profile Load Time\",\"selected\":true},\r\n{\"value\":\"storage\",\"label\":\"Profile Size\"}]",
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "value": "storage"
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "conditionalVisibility": {
              "parameterName": "userTab",
              "comparison": "isEqualTo",
              "value": "fslogix"
            },
            "name": "parameters - FSLogix Parameter"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "WVDConnectionNetworkData \r\n| extend HostPool=_ResourceId \r\n| where TimeGenerated {TimeRange}\r\n| join kind=inner (WVDConnections\r\n        | where TimeGenerated {TimeRange} and State ==\"Connected\" and UserName !=\"\" \r\n)  on CorrelationId\r\n| extend ShortPath=iff(UdpUse==1,\"Private\",iff(UdpUse==2,\"Public\",\"\"))\r\n| summarize [\"Avg. RTT\"]=avg(EstRoundTripTimeInMs),[\"Max. RTT\"]=max(EstRoundTripTimeInMs),\r\n            [\"P90 RTT\"]=percentile(EstRoundTripTimeInMs,90),\r\n            [\"Avg. Bandwidth\"]=avg(EstAvailableBandwidthKBps),\r\n            [\"Max. Bandwidth\"]=max(EstAvailableBandwidthKBps),\r\n            [\"P90 Bandwidth\"]=percentile(EstAvailableBandwidthKBps,90) by UserName, ShortPath\r\n| order by [\"Avg. RTT\"] desc\r\n",
              "size": 0,
              "title": "RTT and estimated available Bandwidth by User",
              "timeContextFromParameter": "TimeRange",
              "exportFieldName": "UserName",
              "exportParameterName": "Select_SourceNetwork_A_UserName",
              "showExportToExcel": true,
              "exportToExcelOptions": "all",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspaces}"
              ],
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Avg. RTT",
                    "formatter": 8,
                    "formatOptions": {
                      "min": 20,
                      "max": 200,
                      "palette": "greenRed"
                    },
                    "numberFormat": {
                      "unit": 23,
                      "options": {
                        "style": "decimal",
                        "maximumFractionDigits": 0
                      }
                    }
                  },
                  {
                    "columnMatch": "Max. RTT",
                    "formatter": 8,
                    "formatOptions": {
                      "min": 20,
                      "max": 200,
                      "palette": "greenRed"
                    },
                    "numberFormat": {
                      "unit": 23,
                      "options": {
                        "style": "decimal",
                        "maximumFractionDigits": 0
                      }
                    }
                  },
                  {
                    "columnMatch": "P90 RTT",
                    "formatter": 8,
                    "formatOptions": {
                      "min": 20,
                      "max": 200,
                      "palette": "greenRed"
                    },
                    "numberFormat": {
                      "unit": 23,
                      "options": {
                        "style": "decimal",
                        "maximumFractionDigits": 0
                      }
                    }
                  },
                  {
                    "columnMatch": "Avg. Bandwidth",
                    "formatter": 4,
                    "formatOptions": {
                      "palette": "blue",
                      "customColumnWidthSetting": "150px"
                    },
                    "numberFormat": {
                      "unit": 12,
                      "options": {
                        "style": "decimal",
                        "minimumFractionDigits": 1,
                        "maximumFractionDigits": 1
                      }
                    }
                  },
                  {
                    "columnMatch": "Max. Bandwidth",
                    "formatter": 4,
                    "formatOptions": {
                      "palette": "blue",
                      "customColumnWidthSetting": "150px"
                    },
                    "numberFormat": {
                      "unit": 12,
                      "options": {
                        "style": "decimal",
                        "minimumFractionDigits": 1,
                        "maximumFractionDigits": 1
                      }
                    }
                  },
                  {
                    "columnMatch": "P90 Bandwidth",
                    "formatter": 4,
                    "formatOptions": {
                      "palette": "blue",
                      "customColumnWidthSetting": "150px"
                    },
                    "numberFormat": {
                      "unit": 12,
                      "options": {
                        "style": "decimal",
                        "minimumFractionDigits": 1,
                        "maximumFractionDigits": 1
                      }
                    }
                  }
                ],
                "rowLimit": 1000,
                "filter": true,
                "sortBy": [
                  {
                    "itemKey": "$gen_heatmap_Avg. RTT_2",
                    "sortOrder": 2
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "$gen_heatmap_Avg. RTT_2",
                  "sortOrder": 2
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "userTab",
              "comparison": "isEqualTo",
              "value": "rtt"
            },
            "showPin": false,
            "name": "query - 13 - Copy - Copy - Copy"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "WVDConnectionNetworkData \r\n| extend HostPool=_ResourceId\r\n| where TimeGenerated {TimeRange} \r\n| join kind=inner  (WVDConnections\r\n        | where TimeGenerated {TimeRange} and State ==\"Connected\" ) \r\n        on CorrelationId \r\n| extend IPSegmentC=strcat(split(ClientSideIPAddress,\".\")[0],\".\",split(ClientSideIPAddress,\".\")[1],\".\",split(ClientSideIPAddress,\".\")[2])\r\n| extend ShortPath=iff(UdpUse==1,\"Private\",iff(UdpUse==2,\"Public\",\"\"))\r\n| summarize [\"Avg. RTT\"]=avg(EstRoundTripTimeInMs),\r\n            [\"Max. RTT\"]=max(EstRoundTripTimeInMs),\r\n            [\"P90 RTT\"]=percentile(EstRoundTripTimeInMs,90),\r\n            [\"Avg. Bandwidth\"]=avg(EstAvailableBandwidthKBps),\r\n            [\"Max. Bandwidth\"]=max(EstAvailableBandwidthKBps),\r\n            [\"P90 Bandwidth\"]=percentile(EstAvailableBandwidthKBps,90) by IPSegmentC, ShortPath\r\n| order by [\"Avg. RTT\"] desc\r\n",
              "size": 0,
              "title": "RTT and estimated available Bandwidth per User by IP segment (class C)",
              "timeContextFromParameter": "TimeRange",
              "exportFieldName": "IPSegmentC",
              "exportParameterName": "Select_SourceNetwork_B_IPSegment",
              "showExportToExcel": true,
              "exportToExcelOptions": "all",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspaces}"
              ],
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Avg. RTT",
                    "formatter": 8,
                    "formatOptions": {
                      "min": 20,
                      "max": 200,
                      "palette": "greenRed"
                    },
                    "numberFormat": {
                      "unit": 23,
                      "options": {
                        "style": "decimal",
                        "maximumFractionDigits": 0
                      }
                    }
                  },
                  {
                    "columnMatch": "Max. RTT",
                    "formatter": 8,
                    "formatOptions": {
                      "min": 20,
                      "max": 200,
                      "palette": "greenRed"
                    },
                    "numberFormat": {
                      "unit": 23,
                      "options": {
                        "style": "decimal",
                        "maximumFractionDigits": 0
                      }
                    }
                  },
                  {
                    "columnMatch": "P90 RTT",
                    "formatter": 8,
                    "formatOptions": {
                      "min": 20,
                      "max": 200,
                      "palette": "greenRed"
                    },
                    "numberFormat": {
                      "unit": 23,
                      "options": {
                        "style": "decimal",
                        "maximumFractionDigits": 0
                      }
                    }
                  },
                  {
                    "columnMatch": "Avg. Bandwidth",
                    "formatter": 4,
                    "formatOptions": {
                      "palette": "blue",
                      "customColumnWidthSetting": "150px"
                    },
                    "numberFormat": {
                      "unit": 12,
                      "options": {
                        "style": "decimal",
                        "minimumFractionDigits": 1,
                        "maximumFractionDigits": 1
                      }
                    }
                  },
                  {
                    "columnMatch": "Max. Bandwidth",
                    "formatter": 4,
                    "formatOptions": {
                      "palette": "blue",
                      "customColumnWidthSetting": "150px"
                    },
                    "numberFormat": {
                      "unit": 12,
                      "options": {
                        "style": "decimal",
                        "minimumFractionDigits": 1,
                        "maximumFractionDigits": 1
                      }
                    }
                  },
                  {
                    "columnMatch": "P90 Bandwidth",
                    "formatter": 4,
                    "formatOptions": {
                      "palette": "blue",
                      "customColumnWidthSetting": "150px"
                    },
                    "numberFormat": {
                      "unit": 12,
                      "options": {
                        "style": "decimal",
                        "minimumFractionDigits": 1,
                        "maximumFractionDigits": 1
                      }
                    }
                  }
                ],
                "rowLimit": 1000,
                "filter": true
              },
              "sortBy": []
            },
            "conditionalVisibility": {
              "parameterName": "userTab",
              "comparison": "isEqualTo",
              "value": "rtt"
            },
            "name": "query - 13 - Copy - Copy - Copy - Copyx"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "WVDCheckpoints \r\n| where¬†(Name==\"ProfileLoggedOff\" or Name==\"ODFCLoggedOff\")¬†and¬†(Source==\"RDAgent\"¬†or¬†Source==\"FSLogix\")¬†and¬†TimeGenerated>ago(360d)\r\n| extend HostPool=_ResourceId, ProfileType=iff(Name==\"ProfileLoggedOff\",\"Profile\",\"ODFC\")\r\n| summarize arg_max(TimeGenerated, *) by UserName, _ResourceId, ProfileType\r\n| extend [\"VHD Size On Disk\"]=todouble(replace_string(replace_string(tostring(Parameters.VHDSizeOnDisk),\",\",\"\"),\".\",\"\")),[\"VHD Free Space\"]=todouble(replace_string(tostring(Parameters.VHDFreeSpace),\",\",\".\")),[\"VHD Max Size\"]=todouble(replace_string(tostring(Parameters.MaxVHDSize),\",\",\".\"))\r\n| where [\"VHD Size On Disk\"]!=\"\"\r\n| project HostPool, UserName, TimeStamp=TimeGenerated,ProfileType, [\"VHD Size On Disk\"], [\"VHD Free Space\"], [\"VHD Max Size\"], Usage=100*([\"VHD Max Size\"]-[\"VHD Free Space\"])/[\"VHD Max Size\"]\r\n| order by [\"Usage\"] desc\r\n| where Usage > 70",
              "size": 3,
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspaces}"
              ],
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "VHD Size On Disk",
                    "formatter": 0,
                    "numberFormat": {
                      "unit": 36,
                      "options": {
                        "style": "decimal"
                      }
                    }
                  },
                  {
                    "columnMatch": "VHD Free Space",
                    "formatter": 0,
                    "numberFormat": {
                      "unit": 39,
                      "options": {
                        "style": "decimal"
                      }
                    }
                  },
                  {
                    "columnMatch": "VHD Max Size",
                    "formatter": 0,
                    "numberFormat": {
                      "unit": 39,
                      "options": {
                        "style": "decimal"
                      }
                    }
                  },
                  {
                    "columnMatch": "Usage",
                    "formatter": 4,
                    "formatOptions": {
                      "min": 0,
                      "max": 100,
                      "palette": "greenRed"
                    },
                    "numberFormat": {
                      "unit": 1,
                      "options": {
                        "style": "decimal",
                        "minimumFractionDigits": 1,
                        "maximumFractionDigits": 1
                      }
                    }
                  },
                  {
                    "columnMatch": "Group",
                    "formatter": 1
                  },
                  {
                    "columnMatch": "Used",
                    "formatter": 0,
                    "numberFormat": {
                      "unit": 1,
                      "options": {
                        "style": "decimal"
                      }
                    }
                  }
                ],
                "rowLimit": 1000,
                "filter": true
              },
              "sortBy": []
            },
            "conditionalVisibilities": [
              {
                "parameterName": "userTab",
                "comparison": "isEqualTo",
                "value": "fslogix"
              },
              {
                "parameterName": "fslog",
                "comparison": "isEqualTo",
                "value": "storage"
              }
            ],
            "name": "query - 0"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let newSessions = true;\r\nWVDConnections\r\n| as ConnectionData\r\n| where State == \"Started\"\r\n| join kind = leftsemi\r\n(\r\n    // Only include connections that actually reached the host to prevent short (failed) attempts from skewing the data\r\n    WVDCheckpoints\r\n    | where Source == \"RDStack\" and Name == \"RdpStackConnectionEstablished\"\r\n) on CorrelationId\r\n| join kind=leftsemi // remove connections that do not have LogonDelay as we cannot show details\r\n(    WVDCheckpoints\r\n    | where Name == \"LogonDelay\"\r\n    | extend LogonType = tostring(Parameters.LogonType)\r\n    | where (newSessions and LogonType == \"DirectSession\") or (not(newSessions) and LogonType ==\"TemporarySession\")\r\n    | project LogonDelay= TimeGenerated, CorrelationId\r\n) on CorrelationId \r\n| join kind = leftsemi\r\n(\r\n    WVDCheckpoints\r\n    | where Name == \"LoadBalancedNewConnection\"\r\n    | extend LoadBalanceOutcome=Parameters.LoadBalanceOutcome\r\n    | where (newSessions and LoadBalanceOutcome == \"NewSession\") or (not(newSessions) and LoadBalanceOutcome in ('Disconnected', 'Active'))\r\n) on CorrelationId\r\n| join kind = inner\r\n(\r\n    WVDCheckpoints // new session\r\n    | where newSessions\r\n    | where Name =~ \"ShellReady\" or\r\n    ( Name =~ \"LaunchExecutable\" and Parameters.connectionStage == \"RdpShellAppExecuted\" or Name=~\"RdpShellAppExecuted\")\r\n    | project ProductiveTime=TimeGenerated, CorrelationId\r\n    | summarize ProductiveTime=min(ProductiveTime) by CorrelationId\r\n    | union ( \r\n        ConnectionData // existent Sessions\r\n        | where not(newSessions)\r\n        | where State == \"Connected\"\r\n        | project ProductiveTime=TimeGenerated, CorrelationId\r\n        )\r\n) on CorrelationId\r\n| join kind = leftouter\r\n(  \r\n    WVDCheckpoints\r\n    | where Name =~ \"OnCredentialsAcquisitionCompleted\"\r\n    | project CorrelationId, credaquire = Parameters.DurationMS\r\n    //OnCredentialsAcquisitionCompleted\t2021-09-13T16:48:50.4440000Z\tClient\t{\"CredentialType\":\"SavedPassword\",\"DurationMS\":\"9\",\"Success\":\"True\"}\r\n) on CorrelationId\r\n| join kind = leftouter\r\n(  \r\n    WVDCheckpoints\r\n    | where Name =~ \"SSOTokenRetrieval\"\r\n    | project CorrelationId, ssotokeretrieval = Parameters.DurationMS\r\n) on CorrelationId\r\n| extend LogonTime = (ProductiveTime - TimeGenerated) / 1s - (coalesce(credaquire,0)/1000) - (coalesce(ssotokeretrieval,0)/1000)\r\n| make-series Trend=avg(LogonTime) on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by GatewayRegion\r\n| extend AvgLoad = array_sum(Trend) / array_length(Trend)\r\n| top 10 by AvgLoad",
              "size": 3,
              "title": "Top 10 Logon Times by Gateway Region",
              "timeContextFromParameter": "TimeRange",
              "exportFieldName": "GatewayRegion",
              "exportParameterName": "logongate",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspaces}"
              ],
              "visualization": "tiles",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "GatewayRegion",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "AvgLoad",
                  "formatter": 12,
                  "formatOptions": {
                    "min": 0,
                    "palette": "greenRed"
                  },
                  "numberFormat": {
                    "unit": 24,
                    "options": {
                      "style": "decimal",
                      "maximumFractionDigits": 2,
                      "maximumSignificantDigits": 3
                    }
                  }
                },
                "secondaryContent": {
                  "columnMatch": "Trend",
                  "formatter": 9,
                  "formatOptions": {
                    "min": 0,
                    "palette": "greenRed"
                  },
                  "numberFormat": {
                    "unit": 24,
                    "options": {
                      "style": "decimal"
                    }
                  }
                },
                "showBorder": true,
                "sortCriteriaField": "ProfileLoad",
                "sortOrderField": 2,
                "size": "auto"
              }
            },
            "customWidth": "50",
            "conditionalVisibility": {
              "parameterName": "userTab",
              "comparison": "isEqualTo",
              "value": "logon"
            },
            "name": "query - 5",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "WVDConnections\r\n| as ConnectionData\r\n| where State == \"Started\"\r\n| join kind = leftsemi\r\n(\r\n    // Only include connections that actually reached the host to prevent short (failed) attempts from skewing the data\r\n    WVDCheckpoints\r\n    | where Source == \"RDStack\" and Name =~ \"RdpStackConnectionEstablished\"\r\n) on CorrelationId\r\n| join kind = inner\r\n(\r\n    WVDCheckpoints\r\n    | where Name =~ \"LoadBalancedNewConnection\"\r\n    | extend LoadBalanceOutcome=Parameters.LoadBalanceOutcome\r\n    | project CorrelationId, ConnectionBackground=case(LoadBalanceOutcome == \"NewSession\", \"New session\", LoadBalanceOutcome in (\"Active\", \"Disconnected\", \"Pending\"), \"Existing session\", LoadBalanceOutcome)\r\n) on CorrelationId\r\n| join kind = inner\r\n(\r\n    WVDCheckpoints // new session\r\n    | where Name =~ \"ShellReady\" or (Name =~ \"LaunchExecutable\" and Parameters.connectionStage == \"RdpShellAppExecuted\") or Name=~\"RdpShellAppExecuted\"\r\n    | project TimeNewSessions=TimeGenerated, CorrelationId\r\n    | summarize TimeNewSessions=min(TimeNewSessions) by CorrelationId\r\n) on CorrelationId\r\n| join kind = inner ( \r\n        ConnectionData // existent Sessions\r\n        | where State == \"Connected\"\r\n        | project TimeConnected=TimeGenerated, CorrelationId\r\n) on CorrelationId\r\n| extend ProductiveTime = iff(ConnectionBackground==\"New session\",TimeNewSessions, TimeConnected)\r\n| join kind = leftouter\r\n(  \r\n        WVDCheckpoints\r\n    | where Name == \"ODFCLoggedOn\" or Name == \"ProfileLoggedOn\"\r\n    | project CorrelationId, LoadTime = Parameters.DurationMS   \r\n) on CorrelationId\r\n| extend LogonTime = (ProductiveTime - TimeGenerated) / 1s - (coalesce(LoadTime,0)/1000)\r\n| make-series Trend=avg(LogonTime) on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by _ResourceId\r\n| extend AvgLoad = array_sum(Trend) / array_length(Trend)\r\n| top 10 by AvgLoad\r\n",
              "size": 3,
              "title": "Top 10 Logon Times by Hostpool",
              "timeContextFromParameter": "TimeRange",
              "exportedParameters": [
                {
                  "fieldName": "_ResourceId",
                  "parameterName": "logonhostpool",
                  "parameterType": 5
                }
              ],
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspaces}"
              ],
              "visualization": "tiles",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "_ResourceId",
                  "formatter": 13,
                  "formatOptions": {
                    "linkTarget": null,
                    "showIcon": true
                  }
                },
                "leftContent": {
                  "columnMatch": "AvgLoad",
                  "formatter": 12,
                  "formatOptions": {
                    "min": 0,
                    "palette": "greenRed"
                  },
                  "numberFormat": {
                    "unit": 24,
                    "options": {
                      "style": "decimal",
                      "maximumFractionDigits": 2,
                      "maximumSignificantDigits": 3
                    }
                  }
                },
                "secondaryContent": {
                  "columnMatch": "Trend",
                  "formatter": 9,
                  "formatOptions": {
                    "min": 0,
                    "palette": "greenRed"
                  },
                  "numberFormat": {
                    "unit": 24,
                    "options": {
                      "style": "decimal"
                    }
                  }
                },
                "showBorder": true,
                "sortCriteriaField": "AvgLoad",
                "sortOrderField": 2
              }
            },
            "customWidth": "50",
            "conditionalVisibility": {
              "parameterName": "userTab",
              "comparison": "isEqualTo",
              "value": "logon"
            },
            "name": "query - 5 - Copy",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "crossComponentResources": [
                "{Workspaces}"
              ],
              "parameters": [
                {
                  "id": "1e1b362d-7ec5-493e-b10b-792dea866aa2",
                  "version": "KqlParameterItem/1.0",
                  "name": "logonGateway",
                  "type": 1,
                  "query": "WVDConnections\r\n| distinct GatewayRegion\r\n| where GatewayRegion == \"{logongate}\"",
                  "crossComponentResources": [
                    "{Workspaces}"
                  ],
                  "isHiddenWhenLocked": true,
                  "timeContext": {
                    "durationMs": 0
                  },
                  "timeContextFromParameter": "TimeRange",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                },
                {
                  "id": "4a70f420-d53d-4c1f-8862-2efa754c1cef",
                  "version": "KqlParameterItem/1.0",
                  "name": "logonHostpool",
                  "type": 5,
                  "query": "WVDConnections\r\n| where _ResourceId in~ (\"{logonhostpool}\") or \"*\" in~ (\"{logonhostpool}\")\r\n| distinct _ResourceId",
                  "crossComponentResources": [
                    "{Workspaces}"
                  ],
                  "isHiddenWhenLocked": true,
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::1"
                    ],
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 0
                  },
                  "timeContextFromParameter": "TimeRange",
                  "defaultValue": "value::1",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "parameters - 9"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let newSessions = true;\r\nWVDConnections\r\n| as ConnectionData\r\n| where State == \"Started\"\r\n| join kind = leftsemi\r\n(\r\n    // Only include connections that actually reached the host to prevent short (failed) attempts from skewing the data\r\n    WVDCheckpoints\r\n    | where Source == \"RDStack\" and Name == \"RdpStackConnectionEstablished\"\r\n) on CorrelationId\r\n| join kind=leftsemi // remove connections that do not have LogonDelay as we cannot show details\r\n(    WVDCheckpoints\r\n    | where Name == \"LogonDelay\"\r\n    | extend LogonType = tostring(Parameters.LogonType)\r\n    | where (newSessions and LogonType == \"DirectSession\") or (not(newSessions) and LogonType ==\"TemporarySession\")\r\n    | project LogonDelay= TimeGenerated, CorrelationId\r\n) on CorrelationId \r\n| where (column_ifexists(\"GatewayRegion\",\"*\")==\"*\" or \"{logonGateway}\"==\"\" or column_ifexists(\"GatewayRegion\",\"\") in ('' '{logonGateway}')) and (column_ifexists(\"_ResourceId\",\"*\")==\"*\" or \"{logonHostpool}\"==\"\" or column_ifexists(\"_ResourceId\",\"\") in ('' \"{logonHostpool}\"))\r\n| join kind = leftsemi\r\n(\r\n    WVDCheckpoints\r\n    | where Name == \"LoadBalancedNewConnection\"\r\n    | extend LoadBalanceOutcome=Parameters.LoadBalanceOutcome\r\n    | where (newSessions and LoadBalanceOutcome == \"NewSession\") or (not(newSessions) and LoadBalanceOutcome in ('Disconnected', 'Active'))\r\n) on CorrelationId\r\n| join kind = inner\r\n(\r\n    WVDCheckpoints // new session\r\n    | where newSessions\r\n    | where Name =~ \"ShellReady\" or\r\n    ( Name =~ \"LaunchExecutable\" and Parameters.connectionStage == \"RdpShellAppExecuted\" or Name=~\"RdpShellAppExecuted\")\r\n    | project ProductiveTime=TimeGenerated, CorrelationId\r\n    | summarize ProductiveTime=min(ProductiveTime) by CorrelationId\r\n    | union ( \r\n        ConnectionData // existent Sessions\r\n        | where not(newSessions)\r\n        | where State == \"Connected\"\r\n        | project ProductiveTime=TimeGenerated, CorrelationId\r\n        )\r\n) on CorrelationId\r\n| join kind = leftouter\r\n(  \r\n    WVDCheckpoints\r\n    | where Name =~ \"OnCredentialsAcquisitionCompleted\"\r\n    | project CorrelationId, credaquire = Parameters.DurationMS\r\n    //OnCredentialsAcquisitionCompleted\t2021-09-13T16:48:50.4440000Z\tClient\t{\"CredentialType\":\"SavedPassword\",\"DurationMS\":\"9\",\"Success\":\"True\"}\r\n) on CorrelationId\r\n| join kind = leftouter\r\n(  \r\n    WVDCheckpoints\r\n    | where Name =~ \"SSOTokenRetrieval\"\r\n    | project CorrelationId, ssotokeretrieval = Parameters.DurationMS\r\n) on CorrelationId\r\n| extend ProductiveTime = (ProductiveTime - TimeGenerated) / 1s - (coalesce(credaquire,0)/1000) - (coalesce(ssotokeretrieval,0)/1000)\r\n| where ProductiveTime >= 0\r\n| summarize (['Median Logon Time'], p10, p90)=percentiles(ProductiveTime, 50, 10, 90), arg_max(TimeGenerated, CorrelationId, _ResourceId, GatewayRegion) by UserName\r\n| top {Top} by ['Median Logon Time'] desc\r\n| project UserName, GatewayRegion, ['Median Logon Time'], p10, p90, TimeGenerated, CorrelationId, _ResourceId",
              "size": 2,
              "timeContextFromParameter": "TimeRange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspaces}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Median",
                    "formatter": 8,
                    "formatOptions": {
                      "min": 0,
                      "palette": "greenRed"
                    },
                    "numberFormat": {
                      "unit": 24,
                      "options": {
                        "style": "decimal"
                      }
                    }
                  },
                  {
                    "columnMatch": "p10",
                    "formatter": 3,
                    "formatOptions": {
                      "min": 0,
                      "palette": "greenRed"
                    },
                    "numberFormat": {
                      "unit": 24,
                      "options": {
                        "style": "decimal"
                      }
                    }
                  },
                  {
                    "columnMatch": "p90",
                    "formatter": 3,
                    "formatOptions": {
                      "min": 0,
                      "palette": "greenRed"
                    },
                    "numberFormat": {
                      "unit": 24,
                      "options": {
                        "style": "decimal"
                      }
                    }
                  },
                  {
                    "columnMatch": "TimeGenerated",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "CorrelationId",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "_ResourceId",
                    "formatter": 5
                  }
                ],
                "filter": true
              }
            },
            "conditionalVisibility": {
              "parameterName": "userTab",
              "comparison": "isEqualTo",
              "value": "logon"
            },
            "name": "query - 5",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "WVDConnections\r\n| as ConnectionData\r\n| where State == \"Started\"\r\n| join kind = leftsemi\r\n(\r\n    // Only include connections that actually reached the host to prevent short (failed) attempts from skewing the data\r\n    WVDCheckpoints\r\n    | where Source == \"RDStack\" and Name =~ \"RdpStackConnectionEstablished\"\r\n) on CorrelationId\r\n| join kind = inner\r\n(\r\n    WVDCheckpoints\r\n    | where Name =~ \"LoadBalancedNewConnection\"\r\n    | extend LoadBalanceOutcome=Parameters.LoadBalanceOutcome\r\n    | project CorrelationId, ConnectionBackground=case(LoadBalanceOutcome == \"NewSession\", \"New session\", LoadBalanceOutcome in (\"Active\", \"Disconnected\", \"Pending\"), \"Existing session\", LoadBalanceOutcome)\r\n) on CorrelationId\r\n| join kind = inner\r\n(\r\n    WVDCheckpoints // new session\r\n    | where Name =~ \"ShellReady\" or (Name =~ \"LaunchExecutable\" and Parameters.connectionStage == \"RdpShellAppExecuted\") or Name=~\"RdpShellAppExecuted\"\r\n    | project TimeNewSessions=TimeGenerated, CorrelationId\r\n    | summarize TimeNewSessions=min(TimeNewSessions) by CorrelationId\r\n) on CorrelationId\r\n| join kind = inner ( \r\n        ConnectionData // existent Sessions\r\n        | where State == \"Connected\"\r\n        | project TimeConnected=TimeGenerated, CorrelationId\r\n) on CorrelationId\r\n| extend ProductiveTime = iff(ConnectionBackground==\"New session\",TimeNewSessions, TimeConnected)\r\n| join kind = leftouter\r\n(  \r\n    //OnCredentialsAcquisitionCompleted\t2021-09-13T16:48:50.4440000Z\tClient\t{\"CredentialType\":\"SavedPassword\",\"DurationMS\":\"9\",\"Success\":\"True\"}\r\n        WVDCheckpoints\r\n    | where Name == \"ODFCLoggedOn\" or Name == \"ProfileLoggedOn\"\r\n    | project CorrelationId, LoadTime = Parameters.DurationMS   \r\n) on CorrelationId\r\n| extend ProfileLoad = (ProductiveTime - TimeGenerated) / 1s - (coalesce(LoadTime,0)/1000)\r\n| make-series Trend=avg(ProfileLoad) on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by GatewayRegion\r\n| extend AvgLoad = array_sum(Trend) / array_length(Trend)\r\n| top 10 by AvgLoad",
                    "size": 3,
                    "title": "Top 10 Profile Load Times by Gateway Region",
                    "timeContextFromParameter": "TimeRange",
                    "exportFieldName": "GatewayRegion",
                    "exportParameterName": "fsGateway",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspaces}"
                    ],
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "GatewayRegion",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "AvgLoad",
                        "formatter": 12,
                        "formatOptions": {
                          "min": 0,
                          "palette": "greenRed"
                        },
                        "numberFormat": {
                          "unit": 24,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 2,
                            "maximumSignificantDigits": 3
                          }
                        }
                      },
                      "secondaryContent": {
                        "columnMatch": "Trend",
                        "formatter": 9,
                        "formatOptions": {
                          "min": 0,
                          "palette": "greenRed"
                        },
                        "numberFormat": {
                          "unit": 24,
                          "options": {
                            "style": "decimal"
                          }
                        }
                      },
                      "showBorder": true,
                      "sortCriteriaField": "ProfileLoad",
                      "sortOrderField": 2,
                      "size": "auto"
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 5",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "WVDConnections\r\n| as ConnectionData\r\n| where State == \"Started\"\r\n| join kind = leftsemi\r\n(\r\n    // Only include connections that actually reached the host to prevent short (failed) attempts from skewing the data\r\n    WVDCheckpoints\r\n    | where Source == \"RDStack\" and Name =~ \"RdpStackConnectionEstablished\"\r\n) on CorrelationId\r\n| join kind = inner\r\n(\r\n    WVDCheckpoints\r\n    | where Name =~ \"LoadBalancedNewConnection\"\r\n    | extend LoadBalanceOutcome=Parameters.LoadBalanceOutcome\r\n    | project CorrelationId, ConnectionBackground=case(LoadBalanceOutcome == \"NewSession\", \"New session\", LoadBalanceOutcome in (\"Active\", \"Disconnected\", \"Pending\"), \"Existing session\", LoadBalanceOutcome)\r\n) on CorrelationId\r\n| join kind = inner\r\n(\r\n    WVDCheckpoints // new session\r\n    | where Name =~ \"ShellReady\" or (Name =~ \"LaunchExecutable\" and Parameters.connectionStage == \"RdpShellAppExecuted\") or Name=~\"RdpShellAppExecuted\"\r\n    | project TimeNewSessions=TimeGenerated, CorrelationId\r\n    | summarize TimeNewSessions=min(TimeNewSessions) by CorrelationId\r\n) on CorrelationId\r\n| join kind = inner ( \r\n        ConnectionData // existent Sessions\r\n        | where State == \"Connected\"\r\n        | project TimeConnected=TimeGenerated, CorrelationId\r\n) on CorrelationId\r\n| extend ProductiveTime = iff(ConnectionBackground==\"New session\",TimeNewSessions, TimeConnected)\r\n| join kind = leftouter\r\n(  \r\n    //OnCredentialsAcquisitionCompleted\t2021-09-13T16:48:50.4440000Z\tClient\t{\"CredentialType\":\"SavedPassword\",\"DurationMS\":\"9\",\"Success\":\"True\"}\r\n        WVDCheckpoints\r\n    | where Name == \"ODFCLoggedOn\" or Name == \"ProfileLoggedOn\"\r\n    | project CorrelationId, LoadTime = Parameters.DurationMS   \r\n) on CorrelationId\r\n| extend ProductiveTime = (ProductiveTime - TimeGenerated) / 1s - (coalesce(LoadTime,0)/1000)\r\n| make-series ProfileLoad = avg(ProductiveTime) on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by _ResourceId\r\n| extend LoadTime = array_sum(ProfileLoad) / array_length(ProfileLoad)\r\n| top 10 by LoadTime desc",
                    "size": 3,
                    "title": "Top 10 Profile Load Times by Hostpool",
                    "timeContextFromParameter": "TimeRange",
                    "exportedParameters": [
                      {
                        "fieldName": "_ResourceId",
                        "parameterName": "fsHostPool",
                        "parameterType": 5
                      }
                    ],
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspaces}"
                    ],
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "_ResourceId",
                        "formatter": 13,
                        "formatOptions": {
                          "linkTarget": null,
                          "showIcon": true
                        }
                      },
                      "leftContent": {
                        "columnMatch": "LoadTime",
                        "formatter": 12,
                        "formatOptions": {
                          "min": 0,
                          "palette": "greenRed"
                        },
                        "numberFormat": {
                          "unit": 24,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 2,
                            "maximumSignificantDigits": 3
                          }
                        }
                      },
                      "secondaryContent": {
                        "columnMatch": "ProfileLoad",
                        "formatter": 9,
                        "formatOptions": {
                          "min": 0,
                          "palette": "greenRed"
                        },
                        "numberFormat": {
                          "unit": 24,
                          "options": {
                            "style": "decimal"
                          }
                        }
                      },
                      "showBorder": true,
                      "sortCriteriaField": "LoadTime",
                      "sortOrderField": 2
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 5 - Copy",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "crossComponentResources": [
                      "{Workspaces}"
                    ],
                    "parameters": [
                      {
                        "id": "500927d6-bb7e-431f-8813-1a30d65525c6",
                        "version": "KqlParameterItem/1.0",
                        "name": "fshostpool",
                        "type": 5,
                        "query": "WVDConnections\r\n| where _ResourceId in~ ('{fsHostPool}') or \"*\" in~ ('{fsHostPool}')\r\n| distinct _ResourceId\r\n        ",
                        "crossComponentResources": [
                          "{Workspaces}"
                        ],
                        "isHiddenWhenLocked": true,
                        "typeSettings": {
                          "additionalResourceOptions": [
                            "value::1"
                          ],
                          "showDefault": false
                        },
                        "timeContext": {
                          "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange",
                        "defaultValue": "value::1",
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      },
                      {
                        "id": "a0de8d85-f4a8-48a4-ae70-cef59f3d35a0",
                        "version": "KqlParameterItem/1.0",
                        "name": "fsgate",
                        "type": 1,
                        "query": "WVDConnections\r\n| where GatewayRegion in ('{fsGateway}') or '*' in ('{fsGateway}')\r\n| distinct GatewayRegion",
                        "crossComponentResources": [
                          "{Workspaces}"
                        ],
                        "isHiddenWhenLocked": true,
                        "timeContext": {
                          "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange",
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "name": "parameters - 3"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "WVDConnections\r\n| as ConnectionData\r\n| where State == \"Started\"\r\n| join kind = leftsemi\r\n(\r\n    // Only include connections that actually reached the host to prevent short (failed) attempts from skewing the data\r\n    WVDCheckpoints\r\n    | where Source == \"RDStack\" and Name =~ \"RdpStackConnectionEstablished\"\r\n) on CorrelationId\r\n| where (column_ifexists(\"GatewayRegion\",\"*\")==\"*\" or \"{fsgate}\"==\"\" or column_ifexists(\"GatewayRegion\",\"\") in ('' '{fsgate}')) \r\n    and (column_ifexists(\"_ResourceId\",\"*\")==\"*\" or \"{fshostpool}\"==\"\" or column_ifexists(\"_ResourceId\",\"\") in ('' '{fshostpool}'))\r\n| join kind = inner\r\n(\r\n    WVDCheckpoints\r\n    | where Name =~ \"LoadBalancedNewConnection\"\r\n    | extend LoadBalanceOutcome=Parameters.LoadBalanceOutcome\r\n    | project CorrelationId, ConnectionBackground=case(LoadBalanceOutcome == \"NewSession\", \"New session\", LoadBalanceOutcome in (\"Active\", \"Disconnected\", \"Pending\"), \"Existing session\", LoadBalanceOutcome)\r\n) on CorrelationId\r\n| join kind = inner\r\n(\r\n    WVDCheckpoints // new session\r\n    | where Name =~ \"ShellReady\" or (Name =~ \"LaunchExecutable\" and Parameters.connectionStage == \"RdpShellAppExecuted\") or Name=~\"RdpShellAppExecuted\"\r\n    | project TimeNewSessions=TimeGenerated, CorrelationId\r\n    | summarize TimeNewSessions=min(TimeNewSessions) by CorrelationId\r\n) on CorrelationId\r\n| join kind = inner ( \r\n        ConnectionData // existent Sessions\r\n        | where State == \"Connected\"\r\n        | project TimeConnected=TimeGenerated, CorrelationId\r\n) on CorrelationId\r\n| extend ProductiveTime = iff(ConnectionBackground==\"New session\",TimeNewSessions, TimeConnected)\r\n| join kind = leftouter\r\n(  \r\n        WVDCheckpoints\r\n    | where Name == \"ODFCLoggedOn\" or Name == \"ProfileLoggedOn\"\r\n    | project CorrelationId, LoadTime = Parameters.DurationMS   \r\n) on CorrelationId\r\n| extend ProductiveTime = (ProductiveTime - TimeGenerated) / 1s - (coalesce(LoadTime,0)/1000)\r\n| summarize (['Median Profile Load Time'], p10, p90)=percentiles(ProductiveTime, 50, 10, 90), arg_max(TimeGenerated, CorrelationId, _ResourceId, GatewayRegion) by UserName\r\n| top {Top} by ['Median Profile Load Time'] desc\r\n| project UserName, GatewayRegion, ['Median Profile Load Time'], p10, p90, TimeGenerated, CorrelationId, _ResourceId\r\n\r\n\r\n",
                    "size": 2,
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspaces}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Median Profile Load Time",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 0,
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 24,
                            "options": {
                              "style": "decimal"
                            }
                          }
                        },
                        {
                          "columnMatch": "p10",
                          "formatter": 3,
                          "formatOptions": {
                            "min": 0,
                            "palette": "greenRed"
                          }
                        },
                        {
                          "columnMatch": "p90",
                          "formatter": 3,
                          "formatOptions": {
                            "min": 0,
                            "palette": "greenRed"
                          }
                        },
                        {
                          "columnMatch": "TimeGenerated",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "CorrelationId",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "_ResourceId",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "ProfileLoad",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 0,
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 24,
                            "options": {
                              "style": "decimal"
                            }
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "name": "query - 2"
                }
              ]
            },
            "conditionalVisibilities": [
              {
                "parameterName": "fslog",
                "comparison": "isEqualTo",
                "value": "load"
              },
              {
                "parameterName": "userTab",
                "comparison": "isEqualTo",
                "value": "fslogix"
              }
            ],
            "name": "group - FSLogix Profile Load Time",
            "styleSettings": {
              "showBorder": true
            }
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "tab",
        "comparison": "isEqualTo",
        "value": "user"
      },
      "name": "group - User Performance"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "crossComponentResources": [
                "{Workspaces}"
              ],
              "parameters": [
                {
                  "id": "4545696d-7a5d-4ffa-b9fd-c7ad3c9c7507",
                  "version": "KqlParameterItem/1.0",
                  "name": "UserName",
                  "type": 1,
                  "timeContext": {
                    "durationMs": 0
                  },
                  "timeContextFromParameter": "TimeRange",
                  "value": ""
                },
                {
                  "id": "3303d516-bb39-4dfd-9707-4ccebb6c444c",
                  "version": "KqlParameterItem/1.0",
                  "name": "userMatch",
                  "type": 2,
                  "query": "WVDErrors\r\n| where isnotempty(\"{UserName}\")\r\n| project UserName\r\n| where UserName has \"@\" and tolower(UserName) contains \"{UserName}\"\r\n| distinct UserName\r\n| extend Lowercased=tolower(UserName)\r\n| sort by Lowercased asc\r\n| project Label=UserName, Value=UserName, Selected=(row_number()==1)",
                  "crossComponentResources": [
                    "{Workspaces}"
                  ],
                  "typeSettings": {
                    "additionalResourceOptions": []
                  },
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces",
                  "value": null
                },
                {
                  "id": "9079923b-1a18-4186-892e-66452e45a838",
                  "version": "KqlParameterItem/1.0",
                  "name": "CorrelationId",
                  "type": 1,
                  "timeContext": {
                    "durationMs": 0
                  },
                  "timeContextFromParameter": "TimeRange",
                  "value": ""
                },
                {
                  "id": "b95c1f9e-48ae-42b2-839e-d170085b240b",
                  "version": "KqlParameterItem/1.0",
                  "name": "WVDSource",
                  "type": 2,
                  "multiSelect": true,
                  "quote": "'",
                  "delimiter": ",",
                  "query": "WVDErrors \r\n| where (column_ifexists(\"UserName\",\"*\")==\"*\" or '{userMatch}'==\"\" or column_ifexists(\"UserName\",\"\") in ('' '{userMatch}')) and (column_ifexists(\"CorrelationId\",\"*\")==\"*\" or '{CorrelationId}'==\"\" or column_ifexists(\"CorrelationId\",\"\") in ('' '{CorrelationId}'))  \r\n| distinct Source",
                  "crossComponentResources": [
                    "{Workspaces}"
                  ],
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::all"
                    ],
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "defaultValue": "value::all",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                },
                {
                  "id": "7e38eeaf-0286-451c-a1cf-5e0da59c097c",
                  "version": "KqlParameterItem/1.0",
                  "name": "WVDOperation",
                  "type": 2,
                  "multiSelect": true,
                  "quote": "'",
                  "delimiter": ",",
                  "query": "WVDErrors \r\n| where (column_ifexists(\"UserName\",\"*\")==\"*\" or '{userMatch}'==\"\" or column_ifexists(\"UserName\",\"\") in ('' '{userMatch}')) and (column_ifexists(\"CorrelationId\",\"*\")==\"*\" or '{CorrelationId}'==\"\" or column_ifexists(\"CorrelationId\",\"\") in ('' '{CorrelationId}'))\r\n| distinct Operation",
                  "crossComponentResources": [
                    "{Workspaces}"
                  ],
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::all"
                    ],
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "defaultValue": "value::all",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                },
                {
                  "id": "a619375b-4c17-485e-b868-65d3905f0350",
                  "version": "KqlParameterItem/1.0",
                  "name": "WVDActivity",
                  "type": 2,
                  "multiSelect": true,
                  "quote": "'",
                  "delimiter": ",",
                  "query": "WVDErrors \r\n| where (column_ifexists(\"UserName\",\"*\")==\"*\" or '{userMatch}'==\"\" or column_ifexists(\"UserName\",\"\") in ('' '{userMatch}')) and (column_ifexists(\"CorrelationId\",\"*\")==\"*\" or '{CorrelationId}'==\"\" or column_ifexists(\"CorrelationId\",\"\") in ('' '{CorrelationId}'))\r\n| distinct ActivityType",
                  "crossComponentResources": [
                    "{Workspaces}"
                  ],
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::all"
                    ],
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 0
                  },
                  "timeContextFromParameter": "TimeRange",
                  "defaultValue": "value::all",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                },
                {
                  "id": "ea5f17ce-bfa5-4cae-974c-53fb7b615896",
                  "version": "KqlParameterItem/1.0",
                  "name": "WVDCodeSymbolic",
                  "type": 2,
                  "multiSelect": true,
                  "quote": "'",
                  "delimiter": ",",
                  "query": "WVDErrors \r\n| where (column_ifexists(\"UserName\",\"*\")==\"*\" or '{userMatch}'==\"\" or column_ifexists(\"UserName\",\"\") in ('' '{userMatch}')) and (column_ifexists(\"CorrelationId\",\"*\")==\"*\" or '{CorrelationId}'==\"\" or column_ifexists(\"CorrelationId\",\"\") in ('' '{CorrelationId}'))\r\n| distinct CodeSymbolic",
                  "crossComponentResources": [
                    "{Workspaces}"
                  ],
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::all"
                    ],
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 0
                  },
                  "timeContextFromParameter": "TimeRange",
                  "defaultValue": "value::all",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                },
                {
                  "id": "a31b37c8-790c-4ef0-aaee-d0350514b04f",
                  "version": "KqlParameterItem/1.0",
                  "name": "SessionHosts",
                  "type": 2,
                  "multiSelect": true,
                  "quote": "'",
                  "delimiter": ",",
                  "query": "WVDErrors\r\n| where ActivityType in ({WVDActivity}) \r\n    and Operation in ({WVDOperation}) \r\n    and CodeSymbolic in ({WVDCodeSymbolic})\r\n    and Source in ({WVDSource})\r\n| join (WVDConnections | project CorrelationId, SessionHostName) on CorrelationId\r\n| distinct SessionHostName",
                  "crossComponentResources": [
                    "{Workspaces}"
                  ],
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::all"
                    ],
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 0
                  },
                  "timeContextFromParameter": "TimeRange",
                  "defaultValue": "value::all",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                }
              ],
              "style": "above",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "parameters - 1"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "crossComponentResources": [
                "{Workspaces}"
              ],
              "parameters": [
                {
                  "id": "43101cd8-deaf-471d-8d22-85d1ea005505",
                  "version": "KqlParameterItem/1.0",
                  "name": "eventlog",
                  "label": "Event Log",
                  "type": 2,
                  "multiSelect": true,
                  "quote": "'",
                  "delimiter": ",",
                  "query": "Event\r\n| where Computer in ({SessionHosts})\r\n| distinct EventLog",
                  "crossComponentResources": [
                    "{Workspaces}"
                  ],
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::all"
                    ],
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "defaultValue": "value::all",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                },
                {
                  "id": "fff48d01-0037-43f3-a584-000e385ba90f",
                  "version": "KqlParameterItem/1.0",
                  "name": "eventsource",
                  "label": "Event Source",
                  "type": 2,
                  "multiSelect": true,
                  "quote": "'",
                  "delimiter": ",",
                  "query": "Event\r\n| where Computer in ({SessionHosts})\r\n| extend Source = strcat_array(split(Source, \"\\\\\"), \"-\")\r\n| extend Source = strcat_array(split(Source, \"&\"), \"-\")\r\n| distinct Source",
                  "crossComponentResources": [
                    "{Workspaces}"
                  ],
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::all"
                    ],
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "defaultValue": "value::all",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                },
                {
                  "id": "0051f2b1-7d49-4bec-b8f3-05a910cc5ff3",
                  "version": "KqlParameterItem/1.0",
                  "name": "eventlevelname",
                  "label": "Event Level",
                  "type": 2,
                  "multiSelect": true,
                  "quote": "'",
                  "delimiter": ",",
                  "query": "Event\r\n| where Computer in ({SessionHosts})\r\n| distinct EventLevelName",
                  "crossComponentResources": [
                    "{Workspaces}"
                  ],
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::all"
                    ],
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "defaultValue": "value::all",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "parameters - 2"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "union\r\n(Event\r\n| extend SessionHostName = Computer\r\n| where SessionHostName in ({SessionHosts})\r\n| extend Source = strcat_array(split(Source, \"\\\\\"), \"-\")\r\n| extend Source = strcat_array(split(Source, \"&\"), \"-\")\r\n| where EventLog in ({eventlog}) \r\n    and Source in ({eventsource}) \r\n    and EventLevelName in ({eventlevelname})\r\n| project-away TenantId, MG, ManagementGroupName\r\n| sort by TimeGenerated desc ),\r\n(WVDErrors\r\n| where ActivityType in ({WVDActivity}) \r\n    and Operation in ({WVDOperation}) \r\n    and CodeSymbolic in ({WVDCodeSymbolic})\r\n    and Source in ({WVDSource})\r\n| join (WVDConnections | where SessionHostName in ({SessionHosts}) or \"*\" in ({SessionHosts}) |project CorrelationId, SessionHostName) on CorrelationId\r\n| extend HostPool = _ResourceId\r\n| project-away _ResourceId, TenantId, CorrelationId1) \r\n| extend ['EventMessage - Message'] = coalesce(RenderedDescription, Message),\r\n        ['EventLevel - Activity'] = coalesce(EventLevelName, ActivityType),\r\n        ['EventID - CorrelationId'] = coalesce(tostring(EventID), tostring(CorrelationId))\r\n| extend Details = pack_all()\r\n| project SessionHostName, TimeGenerated, Source, ['EventMessage - Message'],['EventLevel - Activity'], UserName, CodeSymbolic, Operation, ['EventID - CorrelationId'], Details\r\n\r\n\r\n",
              "size": 2,
              "timeContextFromParameter": "TimeRange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspaces}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "SessionHostName",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "TimeGenerated",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Details",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "CellDetails",
                      "linkLabel": "üîç View Details",
                      "linkIsContextBlade": true
                    }
                  }
                ],
                "rowLimit": 10000,
                "filter": true,
                "hierarchySettings": {
                  "treeType": 1,
                  "groupBy": [
                    "SessionHostName"
                  ],
                  "expandTopLevel": true,
                  "finalBy": "TimeGenerated"
                }
              }
            },
            "name": "query - 0"
          }
        ]
      },
      "conditionalVisibilities": [
        {
          "parameterName": "tab",
          "comparison": "isEqualTo",
          "value": "logs"
        },
        {
          "parameterName": "errors",
          "comparison": "isEqualTo",
          "value": "event"
        }
      ],
      "name": "group - 11"
    }
  ],
  "fallbackResourceIds": [
    "Azure Monitor"
  ],
  "fromTemplateId": "community-Workbooks/byork/avderrortracking",
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}